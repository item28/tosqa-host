(function() {
  var findPin, ng, prepareData;

  ng = angular.module('myApp');

  ng.directive('circuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        defs: '=',
        data: '='
      },
      link: function(scope, elem, attr) {
        var diag, dragInfo, dragWire, gadgetDrag, gadgets, lastg, pinDrag, redraw, svg, wireUnderCursor, wires;
        svg = d3.select(elem[0]).append('svg').attr({
          height: "60%"
        });
        diag = d3.svg.diagonal().projection(function(d) {
          return [d.y, d.x];
        });
        lastg = gadgets = wires = null;
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          this.parentNode.appendChild(this);
          return d3.event.sourceEvent.stopPropagation();
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
          return wires.filter(function(w) {
            return w.source.g === d || w.target.g === d;
          }).each(function(d) {
            d.source = findPin(d.from, scope.data.gadgets);
            return d.target = findPin(d.to, scope.data.gadgets);
          }).attr({
            d: diag
          });
        }).on('dragend', function(d) {
          return console.log('save gadget', d);
        });
        dragInfo = {};
        dragWire = svg.append('path').datum(dragInfo).attr({
          id: 'drag'
        });
        wireUnderCursor = null;
        pinDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          this.parentNode.appendChild(this);
          d3.event.sourceEvent.stopPropagation();
          dragInfo.from = d.pin;
          delete dragInfo.to;
          return dragInfo.source = findPin(d.pin, scope.data.gadgets);
        }).on('drag', function(d) {
          var mx, my, orig, _ref;
          _ref = d3.mouse(this), mx = _ref[0], my = _ref[1];
          orig = dragInfo.source;
          dragInfo.target = {
            x: orig.x + my - d.y,
            y: orig.y + mx - d.x
          };
          return dragWire.attr({
            "class": 'drawing',
            fill: 'none',
            d: diag
          });
        }).on('dragend', function(d) {
          var nw;
          dragWire.classed('drawing', false);
          if (dragInfo.to) {
            nw = {
              from: dragInfo.from,
              to: dragInfo.to
            };
            if (nw.from !== nw.to) {
              console.log('add wire', nw);
              scope.data.wires.push(nw);
            }
            return redraw();
          }
        });
        redraw = function() {
          var g, p, pins;
          lastg = prepareData(scope.defs, scope.data);
          gadgets = svg.selectAll('.gadget').data(scope.data.gadgets, function(d) {
            return d.id;
          });
          wires = svg.selectAll('.wire').data(scope.data.wires);
          g = gadgets.enter().append('g').call(gadgetDrag).attr({
            "class": 'gadget'
          });
          g.append('rect').each(function(d) {
            d.def = scope.defs[d.type];
            d.hw = d.def.width / 2;
            d.hh = d.def.height / 2;
            return d3.select(this).attr({
              "class": 'outline',
              x: 0.5 - d.hw,
              y: 0.5 - d.hh,
              width: 2 * d.hw,
              height: 2 * d.hh
            });
          }).style({
            fill: function(d) {
              return d.def.shade;
            }
          });
          g.append('text').text(function(d) {
            return d.title;
          }).attr({
            "class": 'title',
            y: function(d) {
              return 12 - d.hh;
            }
          });
          g.append('text').text(function(d) {
            return d.def.name;
          }).attr({
            "class": 'type',
            y: function(d) {
              return -4 + d.hh;
            }
          });
          g.append('text').text(function(d) {
            return d.def.icon;
          }).attr({
            "class": 'iconfont',
            x: 0,
            y: 0
          });
          gadgets.exit().remove();
          pins = gadgets.selectAll('.pin').data(function(d) {
            var p, _i, _len, _ref, _results;
            _ref = d.def.pins;
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              p = _ref[_i];
              _results.push({
                x: p.x,
                y: p.y,
                name: p.name,
                dir: p.dir,
                pin: "" + d.id + "." + p.name
              });
            }
            return _results;
          });
          p = pins.enter();
          p.append('circle').attr({
            "class": 'pin',
            cx: (function(d) {
              return d.x + .5;
            }),
            cy: (function(d) {
              return d.y + .5;
            }),
            r: 3
          });
          p.append('circle').call(pinDrag).attr({
            "class": 'hit',
            cx: (function(d) {
              return d.x + .5;
            }),
            cy: (function(d) {
              return d.y + .5;
            }),
            r: 7
          }).on('mouseup', function(d) {
            return dragInfo.to = d.pin;
          });
          p.append('text').text(function(d) {
            return d.name;
          }).attr({
            "class": function(d) {
              return d.dir;
            },
            x: function(d) {
              if (d.dir === 'in') {
                return d.x + 10;
              } else {
                return d.x - 10;
              }
            },
            y: function(d) {
              return d.y + 5;
            }
          });
          pins.exit().remove();
          wires.enter().insert('path', 'g').attr({
            "class": 'wire',
            fill: 'none',
            d: diag
          }).on('mouseenter', function(d) {
            return wireUnderCursor = d;
          }).on('mouseleave', function(d) {
            return wireUnderCursor = null;
          });
          wires.exit().remove();
          return gadgets.attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
        };
        redraw();
        return svg.on('mousedown', function() {
          var i, w, x, y, _ref, _ref1;
          if (wireUnderCursor) {
            console.log('delete wire', wireUnderCursor);
            _ref = scope.data.wires;
            for (i in _ref) {
              w = _ref[i];
              if (!(w === wireUnderCursor)) {
                continue;
              }
              scope.data.wires.splice(i, 1);
              break;
            }
          } else {
            _ref1 = d3.mouse(this), x = _ref1[0], y = _ref1[1];
            ng = {
              id: "g" + (++lastg),
              x: x | 0,
              y: y | 0,
              title: 'Gadget Two',
              type: 'Pipe'
            };
            console.log("add gadget", ng);
            scope.data.gadgets.push(ng);
          }
          return redraw();
        });
      }
    };
  });

  findPin = function(name, gdata) {
    var g, gid, p, pname, _i, _j, _len, _len1, _ref, _ref1;
    _ref = name.split('.'), gid = _ref[0], pname = _ref[1];
    for (_i = 0, _len = gdata.length; _i < _len; _i++) {
      g = gdata[_i];
      if (gid === g.id) {
        _ref1 = g.def.pins;
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          p = _ref1[_j];
          if (pname === p.name) {
            return {
              y: g.x + p.x + .5,
              x: g.y + p.y + .5,
              g: g,
              p: p
            };
          }
        }
      }
    }
  };

  prepareData = function(gdefs, gdata) {
    var d, ins, n, outs, p, seq, step, yIn, yOut, _i, _j, _k, _l, _len, _len1, _len2, _len3, _ref, _ref1, _ref2, _ref3;
    for (n in gdefs) {
      d = gdefs[n];
      d.name || (d.name = n);
      ins = 0;
      _ref = d.pins;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        p = _ref[_i];
        p.x = d.width / 2;
        if (p.dir === 'in') {
          p.x = -p.x;
          ++ins;
        }
      }
      outs = d.pins.length - ins;
      step = 16;
      yIn = -(ins - 1) * step / 2;
      yOut = -(outs - 1) * step / 2;
      _ref1 = d.pins;
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        p = _ref1[_j];
        if (p.dir === 'in') {
          p.y = yIn;
          yIn += step;
        } else {
          p.y = yOut;
          yOut += step;
        }
      }
      d.height = 30 + step * (ins > outs ? ins : outs);
    }
    seq = '';
    _ref2 = gdata.gadgets;
    for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
      d = _ref2[_k];
      if (/^g\d+$/.test(d.id) && d.id > seq) {
        seq = d.id;
      }
      d.def = gdefs[d.type];
      d.hw = d.def.width / 2;
      d.hh = d.def.height / 2;
    }
    _ref3 = gdata.wires;
    for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {
      d = _ref3[_l];
      d.source = findPin(d.from, gdata.gadgets);
      d.target = findPin(d.to, gdata.gadgets);
    }
    return seq.slice(1) | 0;
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSx3QkFBQTs7QUFBQSxFQUFBLEVBQUEsR0FBSyxPQUFPLENBQUMsTUFBUixDQUFlLE9BQWYsQ0FBTCxDQUFBOztBQUFBLEVBRUEsRUFBRSxDQUFDLFNBQUgsQ0FBYSxlQUFiLEVBQThCLFNBQUEsR0FBQTtXQUM1QjtBQUFBLE1BQUEsUUFBQSxFQUFVLEdBQVY7QUFBQSxNQUVBLEtBQUEsRUFDRTtBQUFBLFFBQUEsSUFBQSxFQUFNLEdBQU47QUFBQSxRQUNBLElBQUEsRUFBTSxHQUROO09BSEY7QUFBQSxNQU1BLElBQUEsRUFBTSxTQUFDLEtBQUQsRUFBUSxJQUFSLEVBQWMsSUFBZCxHQUFBO0FBQ0osWUFBQSxrR0FBQTtBQUFBLFFBQUEsR0FBQSxHQUFNLEVBQUUsQ0FBQyxNQUFILENBQVUsSUFBSyxDQUFBLENBQUEsQ0FBZixDQUFrQixDQUFDLE1BQW5CLENBQTBCLEtBQTFCLENBQ0osQ0FBQyxJQURHLENBQ0U7QUFBQSxVQUFBLE1BQUEsRUFBUSxLQUFSO1NBREYsQ0FBTixDQUFBO0FBQUEsUUFFQSxJQUFBLEdBQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFQLENBQUEsQ0FDTCxDQUFDLFVBREksQ0FDTyxTQUFDLENBQUQsR0FBQTtpQkFBTyxDQUFDLENBQUMsQ0FBQyxDQUFILEVBQU0sQ0FBQyxDQUFDLENBQVIsRUFBUDtRQUFBLENBRFAsQ0FGUCxDQUFBO0FBQUEsUUFLQSxLQUFBLEdBQVEsT0FBQSxHQUFVLEtBQUEsR0FBUSxJQUwxQixDQUFBO0FBQUEsUUFPQSxVQUFBLEdBQWEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFaLENBQUEsQ0FDWCxDQUFDLE1BRFUsQ0FDSCxNQURHLENBRVgsQ0FBQyxFQUZVLENBRVAsV0FGTyxFQUVNLFNBQUMsQ0FBRCxHQUFBO0FBQ2YsVUFBQSxJQUFDLENBQUEsVUFBVSxD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bnQiOlsibmcgPSBhbmd1bGFyLm1vZHVsZSAnbXlBcHAnXG5cbm5nLmRpcmVjdGl2ZSAnY2lyY3VpdEVkaXRvcicsIC0+XG4gIHJlc3RyaWN0OiAnRSdcbiAgXG4gIHNjb3BlOlxuICAgIGRlZnM6ICc9J1xuICAgIGRhdGE6ICc9J1xuICAgIFxuICBsaW5rOiAoc2NvcGUsIGVsZW0sIGF0dHIpIC0+ICAgIFxuICAgIHN2ZyA9IGQzLnNlbGVjdChlbGVtWzBdKS5hcHBlbmQgJ3N2ZydcbiAgICAgIC5hdHRyIGhlaWdodDogXCI2MCVcIlxuICAgIGRpYWcgPSBkMy5zdmcuZGlhZ29uYWwoKVxuICAgICAgLnByb2plY3Rpb24gKGQpIC0+IFtkLnksIGQueF0gIyB1bmRvIHRoZSB4L3kgcmV2ZXJzYWwgZnJvbSBmaW5kUGluXG4gICAgXG4gICAgbGFzdGcgPSBnYWRnZXRzID0gd2lyZXMgPSBudWxsXG4gICAgXG4gICAgZ2FkZ2V0RHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgLm9yaWdpbiBPYmplY3RcbiAgICAgIC5vbiAnZHJhZ3N0YXJ0JywgKGQpIC0+XG4gICAgICAgIEBwYXJlbnROb2RlLmFwcGVuZENoaWxkIEAgIyBtb3ZlIHRvIGZyb250XG4gICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICAub24gJ2RyYWcnLCAoZCkgLT5cbiAgICAgICAgZC54ID0gZDMuZXZlbnQueCB8IDAgIyBzdGF5IG9uIGludCBjb29yZGluYXRlc1xuICAgICAgICBkLnkgPSBkMy5ldmVudC55IHwgMCAjIHN0YXkgb24gaW50IGNvb3JkaW5hdGVzXG4gICAgICAgIGQzLnNlbGVjdChAKS5hdHRyIHRyYW5zZm9ybTogKGQpIC0+IFwidHJhbnNsYXRlKCN7ZC54fSwje2QueX0pXCJcbiAgICAgICAgIyByZWNhbGN1bGF0ZSBlbmRwb2ludHMgYW5kIHJlZHJhdyBhbGwgd2lyZXMgYXR0YWNoZWQgdG8gdGhpcyBnYWRnZXRcbiAgICAgICAgd2lyZXMuZmlsdGVyICh3KSAtPiB3LnNvdXJjZS5nIGlzIGQgb3Igdy50YXJnZXQuZyBpcyBkXG4gICAgICAgICAgLmVhY2ggKGQpIC0+XG4gICAgICAgICAgICBkLnNvdXJjZSA9IGZpbmRQaW4gZC5mcm9tLCBzY29wZS5kYXRhLmdhZGdldHNcbiAgICAgICAgICAgIGQudGFyZ2V0ID0gZmluZFBpbiBkLnRvLCBzY29wZS5kYXRhLmdhZGdldHNcbiAgICAgICAgICAuYXR0ciBkOiBkaWFnXG4gICAgICAub24gJ2RyYWdlbmQnLCAoZCkgLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ3NhdmUgZ2FkZ2V0JywgZCAjIFRPRE86IHNhdmUgdG8gc2VydmVyXG5cbiAgICBkcmFnSW5mbyA9IHt9XG4gICAgZHJhZ1dpcmUgPSBzdmcuYXBwZW5kKCdwYXRoJykuZGF0dW0oZHJhZ0luZm8pLmF0dHIgaWQ6ICdkcmFnJ1xuICAgIHdpcmVVbmRlckN1cnNvciA9IG51bGxcblxuICAgIHBpbkRyYWcgPSBkMy5iZWhhdmlvci5kcmFnKClcbiAgICAgIC5vcmlnaW4gT2JqZWN0XG4gICAgICAub24gJ2RyYWdzdGFydCcsIChkKSAtPlxuICAgICAgICBAcGFyZW50Tm9kZS5hcHBlbmRDaGlsZCBAICMgbW92ZSB0byBmcm9udFxuICAgICAgICBkMy5ldmVudC5zb3VyY2VFdmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICBkcmFnSW5mby5mcm9tID0gZC5waW5cbiAgICAgICAgZGVsZXRlIGRyYWdJbmZvLnRvXG4gICAgICAgIGRyYWdJbmZvLnNvdXJjZSA9IGZpbmRQaW4gZC5waW4sIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgLm9uICdkcmFnJywgKGQpIC0+XG4gICAgICAgIFtteCxteV0gPSBkMy5tb3VzZShAKVxuICAgICAgICBvcmlnID0gZHJhZ0luZm8uc291cmNlXG4gICAgICAgIGRyYWdJbmZvLnRhcmdldCA9IHg6IG9yaWcueCtteS1kLnksIHk6IG9yaWcueStteC1kLnggIyBmbGlwcGVkXG4gICAgICAgIGRyYWdXaXJlLmF0dHIgY2xhc3M6ICdkcmF3aW5nJywgZmlsbDogJ25vbmUnLCBkOiBkaWFnXG4gICAgICAub24gJ2RyYWdlbmQnLCAoZCkgLT5cbiAgICAgICAgZHJhZ1dpcmUuY2xhc3NlZCAnZHJhd2luZycsIGZhbHNlXG4gICAgICAgIGlmIGRyYWdJbmZvLnRvXG4gICAgICAgICAgbncgPSBmcm9tOiBkcmFnSW5mby5mcm9tLCB0bzogZHJhZ0luZm8udG9cbiAgICAgICAgICB1bmxlc3MgbncuZnJvbSBpcyBudy50b1xuICAgICAgICAgICAgY29uc29sZS5sb2cgJ2FkZCB3aXJlJywgbncgIyBUT0RPOiBzYXZlIHRvIHNlcnZlclxuICAgICAgICAgICAgc2NvcGUuZGF0YS53aXJlcy5wdXNoIG53XG4gICAgICAgICAgcmVkcmF3KClcblxuICAgIHJlZHJhdyA9IC0+XG4gICAgICBsYXN0ZyA9IHByZXBhcmVEYXRhIHNjb3BlLmRlZnMsIHNjb3BlLmRhdGFcbiAgICAgIGdhZGdldHMgPSBzdmcuc2VsZWN0QWxsKCcuZ2FkZ2V0JykuZGF0YSBzY29wZS5kYXRhLmdhZGdldHMsIChkKSAtPiBkLmlkXG4gICAgICB3aXJlcyA9IHN2Zy5zZWxlY3RBbGwoJy53aXJlJykuZGF0YSBzY29wZS5kYXRhLndpcmVzXG5cbiAgICAgIGcgPSBnYWRnZXRzLmVudGVyKCkuYXBwZW5kKCdnJykuY2FsbChnYWRnZXREcmFnKVxuICAgICAgICAuYXR0ciBjbGFzczogJ2dhZGdldCdcbiAgICAgIGcuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgLmVhY2ggKGQpIC0+XG4gICAgICAgICAgZC5kZWYgPSBzY29wZS5kZWZzW2QudHlwZV1cbiAgICAgICAgICBkLmh3ID0gZC5kZWYud2lkdGggLyAyXG4gICAgICAgICAgZC5oaCA9IGQuZGVmLmhlaWdodCAvIDJcbiAgICAgICAgICBkMy5zZWxlY3QoQCkuYXR0clxuICAgICAgICAgICAgY2xhc3M6ICdvdXRsaW5lJ1xuICAgICAgICAgICAgIyAxcHggbGluZXMgcmVuZGVyIHNoYXJwbHkgd2hlbiBvbiBhIDAuNXB4IG9mZnNldFxuICAgICAgICAgICAgeDogMC41IC0gZC5odywgeTogMC41IC0gZC5oaFxuICAgICAgICAgICAgd2lkdGg6IDIgKiBkLmh3LCBoZWlnaHQ6IDIgKiBkLmhoXG4gICAgICAgIC5zdHlsZSBmaWxsOiAoZCkgLT4gZC5kZWYuc2hhZGVcbiAgICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC50aXRsZVxuICAgICAgICAuYXR0ciBjbGFzczogJ3RpdGxlJywgeTogKGQpIC0+IDEyIC0gZC5oaFxuICAgICAgZy5hcHBlbmQoJ3RleHQnKS50ZXh0IChkKSAtPiBkLmRlZi5uYW1lXG4gICAgICAgIC5hdHRyIGNsYXNzOiAndHlwZScsIHk6IChkKSAtPiAtNCArIGQuaGhcbiAgICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC5kZWYuaWNvblxuICAgICAgICAuYXR0ciBjbGFzczogJ2ljb25mb250JywgeDogMCwgeTogMFxuICAgICAgZ2FkZ2V0cy5leGl0KCkucmVtb3ZlKClcbiAgICAgICAgXG4gICAgICBwaW5zID0gZ2FkZ2V0cy5zZWxlY3RBbGwoJy5waW4nKS5kYXRhIChkKSAtPlxuICAgICAgICBmb3IgcCBpbiBkLmRlZi5waW5zXG4gICAgICAgICAgeDogcC54LCB5OiBwLnksIG5hbWU6IHAubmFtZSwgZGlyOiBwLmRpciwgcGluOiBcIiN7ZC5pZH0uI3twLm5hbWV9XCJcbiAgICAgIHAgPSBwaW5zLmVudGVyKClcbiAgICAgIHAuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgICAuYXR0ciBjbGFzczogJ3BpbicsIGN4OiAoKGQpIC0+IGQueCsuNSksIGN5OiAoKGQpIC0+IGQueSsuNSksIHI6IDNcbiAgICAgIHAuYXBwZW5kKCdjaXJjbGUnKS5jYWxsKHBpbkRyYWcpXG4gICAgICAgIC5hdHRyIGNsYXNzOiAnaGl0JywgY3g6ICgoZCkgLT4gZC54Ky41KSwgY3k6ICgoZCkgLT4gZC55Ky41KSwgcjogN1xuICAgICAgICAub24gJ21vdXNldXAnLCAoZCkgLT4gZHJhZ0luZm8udG8gPSBkLnBpblxuICAgICAgcC5hcHBlbmQoJ3RleHQnKS50ZXh0IChkKSAtPiBkLm5hbWVcbiAgICAgICAgLmF0dHJcbiAgICAgICAgICBjbGFzczogKGQpIC0+IGQuZGlyXG4gICAgICAgICAgeDogKGQpIC0+IGlmIGQuZGlyIGlzICdpbicgdGhlbiBkLnggKyAxMCBlbHNlIGQueCAtIDEwXG4gICAgICAgICAgeTogKGQpIC0+IGQueSArIDVcbiAgICAgIHBpbnMuZXhpdCgpLnJlbW92ZSgpXG5cbiAgICAgIHdpcmVzLmVudGVyKCkuaW5zZXJ0KCdwYXRoJywgJ2cnKSAjIHVzZXMgaW5zZXJ0IHRvIG1vdmUgdG8gYmFjayByaWdodCBhd2F5XG4gICAgICAgIC5hdHRyIGNsYXNzOiAnd2lyZScsIGZpbGw6ICdub25lJywgZDogZGlhZ1xuICAgICAgICAjIGNhbid0IHVzZSBtb3VzZWNsaWNrLCBzZWVcbiAgICAgICAgIyBodHRwczovL2dyb3Vwcy5nb29nbGUuY29tL2QvbXNnL2QzLWpzL2dIek9qOTFYMk5BLzY1QkVmMkR1UlY0SlxuICAgICAgICAub24gJ21vdXNlZW50ZXInLCAoZCkgLT4gd2lyZVVuZGVyQ3Vyc29yID0gZFxuICAgICAgICAub24gJ21vdXNlbGVhdmUnLCAoZCkgLT4gd2lyZVVuZGVyQ3Vyc29yID0gbnVsbFxuICAgICAgd2lyZXMuZXhpdCgpLnJlbW92ZSgpXG5cbiAgICAgIGdhZGdldHMuYXR0ciB0cmFuc2Zvcm06IChkKSAtPiBcInRyYW5zbGF0ZSgje2QueH0sI3tkLnl9KVwiXG4gICAgXG4gICAgcmVkcmF3KClcbiAgICBcbiAgICBzdmcub24gJ21vdXNlZG93bicsIC0+XG4gICAgICAjIHJldHVybiAgaWYgZDMuZXZlbnQuZGVmYXVsdFByZXZlbnRlZFxuICAgICAgaWYgd2lyZVVuZGVyQ3Vyc29yXG4gICAgICAgIGNvbnNvbGUubG9nICdkZWxldGUgd2lyZScsIHdpcmVVbmRlckN1cnNvclxuICAgICAgICBmb3IgaSwgdyBvZiBzY29wZS5kYXRhLndpcmVzIHdoZW4gdyBpcyB3aXJlVW5kZXJDdXJzb3JcbiAgICAgICAgICBzY29wZS5kYXRhLndpcmVzLnNwbGljZSBpLCAxXG4gICAgICAgICAgYnJlYWtcbiAgICAgIGVsc2VcbiAgICAgICAgW3gseV0gPSBkMy5tb3VzZSBAXG4gICAgICAgIG5nID0gaWQ6IFwiZyN7KytsYXN0Z31cIiwgeDogeHwwLCB5OiB5fDAsIHRpdGxlOiAnR2FkZ2V0IFR3bycsIHR5cGU6ICdQaXBlJ1xuICAgICAgICBjb25zb2xlLmxvZyBcImFkZCBnYWRnZXRcIiwgbmcgIyBUT0RPOiBzYXZlIHRvIHNlcnZlclxuICAgICAgICBzY29wZS5kYXRhLmdhZGdldHMucHVzaCBuZ1xuICAgICAgcmVkcmF3KClcblxuZmluZFBpbiA9IChuYW1lLCBnZGF0YSkgLT5cbiAgW2dpZCxwbmFtZV0gPSBuYW1lLnNwbGl0ICcuJ1xuICBmb3IgZyBpbiBnZGF0YSB3aGVuIGdpZCBpcyBnLmlkXG4gICAgZm9yIHAgaW4gZy5kZWYucGlucyB3aGVuIHBuYW1lIGlzIHAubmFtZVxuICAgICAgIyByZXZlcnNlcyB4IGFuZCB5IGFuZCB1c2VzIHByb2plY3Rpb24gdG8gZ2V0IGhvcml6b250YWwgc3BsaW5lc1xuICAgICAgcmV0dXJuIHk6IGcueCArIHAueCArIC41LCB4OiBnLnkgKyBwLnkgKyAuNSwgZzogZywgcDogcFxuXG5wcmVwYXJlRGF0YSA9IChnZGVmcywgZ2RhdGEpIC0+XG4gICMgcHJlLWNhbGN1bGF0ZSBzaXplcyBhbmQgcmVsYXRpdmUgcGluIGNvb3JkaW5hdGVzXG4gIGZvciBuLCBkIG9mIGdkZWZzXG4gICAgZC5uYW1lIG9yPSBuXG4gICAgaW5zID0gMFxuICAgIGZvciBwIGluIGQucGluc1xuICAgICAgcC54ID0gZC53aWR0aCAvIDJcbiAgICAgIGlmIHAuZGlyIGlzICdpbidcbiAgICAgICAgcC54ID0gLXAueFxuICAgICAgICArK2luc1xuICAgIG91dHMgPSBkLnBpbnMubGVuZ3RoIC0gaW5zXG4gICAgc3RlcCA9IDE2XG4gICAgeUluID0gLSAoaW5zIC0gMSkgKiBzdGVwIC8gMlxuICAgIHlPdXQgPSAtIChvdXRzIC0gMSkgKiBzdGVwIC8gMlxuICAgIGZvciBwIGluIGQucGluc1xuICAgICAgaWYgcC5kaXIgaXMgJ2luJ1xuICAgICAgICBwLnkgPSB5SW5cbiAgICAgICAgeUluICs9IHN0ZXBcbiAgICAgIGVsc2VcbiAgICAgICAgcC55ID0geU91dFxuICAgICAgICB5T3V0ICs9IHN0ZXBcbiAgICBkLmhlaWdodCA9IDMwICsgc3RlcCAqIChpZiBpbnMgPiBvdXRzIHRoZW4gaW5zIGVsc2Ugb3V0cylcblxuICBzZXEgPSAnJyAjIGZpbmQgdGhlIGxhcmdlc3QgXCJnPG4+XCIgaWQgdG8gaGVscCBnZW5lcmF0ZSB0aGUgbmV4dCBvbmVcbiAgZm9yIGQgaW4gZ2RhdGEuZ2FkZ2V0c1xuICAgIHNlcSA9IGQuaWQgIGlmIC9eZ1xcZCskLy50ZXN0KGQuaWQpIGFuZCBkLmlkID4gc2VxXG4gICAgZC5kZWYgPSBnZGVmc1tkLnR5cGVdXG4gICAgZC5odyA9IGQuZGVmLndpZHRoIC8gMlxuICAgIGQuaGggPSBkLmRlZi5oZWlnaHQgLyAyXG5cbiAgZm9yIGQgaW4gZ2RhdGEud2lyZXNcbiAgICBkLnNvdXJjZSA9IGZpbmRQaW4gZC5mcm9tLCBnZGF0YS5nYWRnZXRzXG4gICAgZC50YXJnZXQgPSBmaW5kUGluIGQudG8sIGdkYXRhLmdhZGdldHNcbiAgICBcbiAgcmV0dXJuIHNlcS5zbGljZSgxKSB8IDAgIyBkcm9wIHRoZSBsZWFkaW5nIFwiZ1wiLCByZXR1cm4gYXMgaW50XG4iXX0=
