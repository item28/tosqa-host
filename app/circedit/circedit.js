(function() {
  var findPin, ng, prepareData,
    __slice = [].slice;

  ng = angular.module('myApp');

  ng.directive('jbCircuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        defs: '=',
        data: '='
      },
      link: function(scope, elem, attr) {
        var diag, dragInfo, dragWire, emit, gadgetDrag, gadgets, pinDrag, redraw, svg, wireUnderCursor, wires;
        svg = d3.select(elem[0]).append('svg').attr({
          height: '60%'
        });
        diag = d3.svg.diagonal().projection(function(d) {
          return [d.y, d.x];
        });
        gadgets = wires = null;
        emit = function() {
          var args;
          args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          return scope.$apply(function() {
            var _ref;
            return scope.$emit.apply(scope, [(_ref = attr.event) != null ? _ref : 'circuit'].concat(__slice.call(args)));
          });
        };
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          d3.event.sourceEvent.stopPropagation();
          return this.parentNode.appendChild(this);
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
          return wires.filter(function(w) {
            return w.source.g === d || w.target.g === d;
          }).each(function(d) {
            d.source = findPin(d.from, scope.data.gadgets);
            return d.target = findPin(d.to, scope.data.gadgets);
          }).attr({
            d: diag
          });
        }).on('dragend', function(d) {
          return emit('moveGadget', d.id, d.x, d.y);
        });
        dragInfo = {};
        dragWire = svg.append('path').datum(dragInfo).attr({
          id: 'drag'
        });
        wireUnderCursor = null;
        pinDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          d3.event.sourceEvent.stopPropagation();
          dragInfo.from = d.pin;
          delete dragInfo.to;
          return dragInfo.source = findPin(d.pin, scope.data.gadgets);
        }).on('drag', function(d) {
          var mx, my, orig, _ref;
          _ref = d3.mouse(this), mx = _ref[0], my = _ref[1];
          orig = dragInfo.source;
          dragInfo.target = {
            x: orig.x + my - d.y,
            y: orig.y + mx - d.x
          };
          return dragWire.attr({
            "class": 'drawing',
            fill: 'none',
            d: diag
          });
        }).on('dragend', function(d) {
          var nw;
          dragWire.classed('drawing', false);
          if (dragInfo.to) {
            nw = {
              from: dragInfo.from,
              to: dragInfo.to
            };
            if (nw.from !== nw.to) {
              emit('addWire', nw.from, nw.to);
            }
            return redraw();
          }
        });
        redraw = function() {
          var g, p, pins;
          prepareData(scope.defs, scope.data);
          gadgets = svg.selectAll('.gadget').data(scope.data.gadgets, function(d) {
            return d.id;
          });
          wires = svg.selectAll('.wire').data(scope.data.wires, function(d) {
            return d.id;
          });
          g = gadgets.enter().append('g').call(gadgetDrag).attr({
            "class": 'gadget'
          });
          g.append('rect').each(function(d) {
            return d3.select(this).attr({
              "class": 'outline',
              x: 0.5 - d.hw,
              y: 0.5 - d.hh,
              width: 2 * d.hw,
              height: 2 * d.hh
            });
          }).on('mousedown', function(d) {
            return emit('selectGadget', d.id);
          }).style({
            fill: function(d) {
              return d.def.shade;
            }
          });
          g.append('text').text(function(d) {
            return d.title || d.def.name;
          }).attr({
            "class": 'title',
            y: function(d) {
              return 12 - d.hh;
            }
          });
          g.append('text').text(function(d) {
            return "" + d.type + " - " + d.id;
          }).attr({
            "class": 'type',
            y: function(d) {
              return -4 + d.hh;
            }
          });
          g.append('text').text(function(d) {
            return d.def.icon;
          }).attr({
            "class": 'iconfont',
            x: 0,
            y: 0
          });
          g.append('text').text(function(d) {
            return '\uf014';
          }).attr({
            "class": 'iconfont',
            x: (function(d) {
              return d.hw - 8;
            }),
            y: (function(d) {
              return 8 - d.hh;
            })
          }).style({
            'font-size': '12px'
          }).on('mousedown', function(d) {
            d3.event.stopPropagation();
            emit('delGadget', d.id);
            return redraw();
          });
          gadgets.exit().remove();
          pins = gadgets.selectAll('.pin').data(function(d) {
            return d.pins;
          });
          p = pins.enter();
          p.append('circle').attr({
            "class": 'pin',
            cx: (function(d) {
              return d.x + .5;
            }),
            cy: (function(d) {
              return d.y + .5;
            }),
            r: 3
          });
          p.append('circle').call(pinDrag).attr({
            "class": 'hit',
            cx: (function(d) {
              return d.x + .5;
            }),
            cy: (function(d) {
              return d.y + .5;
            }),
            r: 7
          }).on('mouseup', function(d) {
            return dragInfo.to = d.pin;
          });
          p.append('text').text(function(d) {
            return d.name;
          }).attr({
            "class": function(d) {
              return d.dir;
            },
            x: function(d) {
              if (d.dir === 'in') {
                return d.x + 10;
              } else {
                return d.x - 10;
              }
            },
            y: function(d) {
              return d.y + 5;
            }
          });
          pins.exit().remove();
          wires.enter().insert('path', 'g').attr({
            "class": 'wire',
            fill: 'none',
            d: diag
          }).on('mouseenter', function(d) {
            return wireUnderCursor = d;
          }).on('mouseleave', function(d) {
            return wireUnderCursor = null;
          });
          wires.exit().remove();
          return gadgets.attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
        };
        redraw();
        return svg.on('mousedown', function() {
          var x, y, _ref;
          if (wireUnderCursor) {
            emit('delWire', wireUnderCursor.from, wireUnderCursor.to);
            wireUnderCursor = null;
          } else {
            _ref = d3.mouse(this), x = _ref[0], y = _ref[1];
            emit('addGadget', x | 0, y | 0);
          }
          return redraw();
        });
      }
    };
  });

  findPin = function(pin, gdata) {
    var g, gid, p, pname, _i, _j, _len, _len1, _ref, _ref1;
    _ref = pin.split('.'), gid = _ref[0], pname = _ref[1];
    for (_i = 0, _len = gdata.length; _i < _len; _i++) {
      g = gdata[_i];
      if (gid === g.id) {
        _ref1 = g.pins;
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          p = _ref1[_j];
          if (pname === p.name) {
            return {
              y: g.x + p.x + .5,
              x: g.y + p.y + .5,
              g: g
            };
          }
        }
      }
    }
  };

  prepareData = function(gdefs, gdata) {
    var d, ins, outs, placePins, width, ystep, _i, _j, _len, _len1, _ref, _ref1, _results;
    ystep = 20;
    width = 140;
    _ref = gdata.gadgets;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      d = _ref[_i];
      d.def = gdefs[d.type];
      d.pins = [];
      placePins = function(pnames, dir, x) {
        var name, nlist, y, _j, _len1;
        nlist = (pnames != null ? pnames : '').split(' ');
        y = -ystep * (nlist.length - 1) >> 1;
        for (_j = 0, _len1 = nlist.length; _j < _len1; _j++) {
          name = nlist[_j];
          d.pins.push({
            x: x,
            y: y,
            name: name,
            dir: dir,
            pin: "" + d.id + "." + name
          });
          y += ystep;
        }
        return nlist.length;
      };
      d.hw = width / 2;
      ins = placePins(d.def.inputs, 'in', -d.hw);
      outs = placePins(d.def.outputs, 'out', d.hw);
      d.height = 40 + ystep * (ins > outs ? ins : outs);
      d.hh = d.height / 2;
    }
    _ref1 = gdata.wires;
    _results = [];
    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
      d = _ref1[_j];
      d.id = "" + d.from + "/" + d.to;
      d.source = findPin(d.from, gdata.gadgets);
      _results.push(d.target = findPin(d.to, gdata.gadgets));
    }
    return _results;
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSx3QkFBQTtJQUFBLGtCQUFBOztBQUFBLEVBQUEsRUFBQSxHQUFLLE9BQU8sQ0FBQyxNQUFSLENBQWUsT0FBZixDQUFMLENBQUE7O0FBQUEsRUFFQSxFQUFFLENBQUMsU0FBSCxDQUFhLGlCQUFiLEVBQWdDLFNBQUEsR0FBQTtXQUM5QjtBQUFBLE1BQUEsUUFBQSxFQUFVLEdBQVY7QUFBQSxNQUVBLEtBQUEsRUFDRTtBQUFBLFFBQUEsSUFBQSxFQUFNLEdBQU47QUFBQSxRQUNBLElBQUEsRUFBTSxHQUROO09BSEY7QUFBQSxNQU1BLElBQUEsRUFBTSxTQUFDLEtBQUQsRUFBUSxJQUFSLEVBQWMsSUFBZCxHQUFBO0FBQ0osWUFBQSxpR0FBQTtBQUFBLFFBQUEsR0FBQSxHQUFNLEVBQUUsQ0FBQyxNQUFILENBQVUsSUFBSyxDQUFBLENBQUEsQ0FBZixDQUFrQixDQUFDLE1BQW5CLENBQTBCLEtBQTFCLENBQ0osQ0FBQyxJQURHLENBQ0U7QUFBQSxVQUFBLE1BQUEsRUFBUSxLQUFSO1NBREYsQ0FBTixDQUFBO0FBQUEsUUFFQSxJQUFBLEdBQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFQLENBQUEsQ0FDTCxDQUFDLFVBREksQ0FDTyxTQUFDLENBQUQsR0FBQTtpQkFBTyxDQUFDLENBQUMsQ0FBQyxDQUFILEVBQU0sQ0FBQyxDQUFDLENBQVIsRUFBUDtRQUFBLENBRFAsQ0FGUCxDQUFBO0FBQUEsUUFLQSxPQUFBLEdBQVUsS0FBQSxHQUFRLElBTGxCLENBQUE7QUFBQSxRQU9BLElBQUEsR0FBTyxTQUFBLEdBQUE7QUFFTCxjQUFBLElBQUE7QUFBQSxVQUZNLDhEQUVOLENBQUE7aUJBQUEsS0FBSyxDQUFDLE1BQU4sQ0FBYSxTQUFBLEdBQUE7QUFBRyxnQkFBQSxJQUFBO21CQUFBLEtBQUssQ0FBQyxLQUFOLGNBQVks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U0FGQTtlQUtBLEtBQUssQ0FBQyxPQU5JO01BQUEsQ0FGWixDQUFBO0FBQUEsTUFTQSxDQUFDLENBQUMsRUFBRixHQUFPLEtBQUEsR0FBUSxDQVRmLENBQUE7QUFBQSxNQVVBLEdBQUEsR0FBTSxTQUFBLENBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFoQixFQUF3QixJQUF4QixFQUE4QixDQUFBLENBQUUsQ0FBQyxFQUFqQyxDQVZOLENBQUE7QUFBQSxNQVdBLElBQUEsR0FBTyxTQUFBLENBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFoQixFQUF5QixLQUF6QixFQUFnQyxDQUFDLENBQUMsRUFBbEMsQ0FYUCxDQUFBO0FBQUEsTUFZQSxDQUFDLENBQUMsTUFBRixHQUFXLEVBQUEsR0FBSyxLQUFBLEdBQVEsQ0FBSSxHQUFBLEdBQU0sSUFBVCxHQUFtQixHQUFuQixHQUE0QixJQUE3QixDQVp4QixDQUFBO0FBQUEsTUFhQSxDQUFDLENBQUMsRUFBRixHQUFPLENBQUMsQ0FBQyxNQUFGLEdBQVcsQ0FibEIsQ0FERjtBQUFBLEtBSkE7QUFxQkE7QUFBQTtTQUFBLDhDQUFBO29CQUFBO0FBQ0UsTUFBQSxDQUFDLENBQUMsRUFBRixHQUFPLEVBQUEsR0FBRSxDQUFDLENBQUMsSUFBSixHQUFVLEdBQVYsR0FBWSxDQUFDLENBQUMsRUFBckIsQ0FBQTtBQUFBLE1BQ0EsQ0FBQyxDQUFDLE1BQUYsR0FBVyxPQUFBLENBQVEsQ0FBQyxDQUFDLElBQVYsRUFBZ0IsS0FBSyxDQUFDLE9BQXRCLENBRFgsQ0FBQTtBQUFBLG9CQUVBLENBQUMsQ0FBQyxNQUFGLEdBQVcsT0FBQSxDQUFRLENBQUMsQ0FBQyxFQUFWLEVBQWMsS0FBSyxDQUFDLE9BQXBCLEVBRlgsQ0FERjtBQUFBO29CQXRCWTtFQUFBLENBeklkLENBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIm5nID0gYW5ndWxhci5tb2R1bGUgJ215QXBwJ1xuXG5uZy5kaXJlY3RpdmUgJ2piQ2lyY3VpdEVkaXRvcicsIC0+XG4gIHJlc3RyaWN0OiAnRSdcbiAgXG4gIHNjb3BlOlxuICAgIGRlZnM6ICc9J1xuICAgIGRhdGE6ICc9J1xuICAgIFxuICBsaW5rOiAoc2NvcGUsIGVsZW0sIGF0dHIpIC0+XG4gICAgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZCAnc3ZnJ1xuICAgICAgLmF0dHIgaGVpZ2h0OiAnNjAlJ1xuICAgIGRpYWcgPSBkMy5zdmcuZGlhZ29uYWwoKVxuICAgICAgLnByb2plY3Rpb24gKGQpIC0+IFtkLnksIGQueF0gIyB1bmRvIHRoZSB4L3kgcmV2ZXJzYWwgZnJvbSBmaW5kUGluXG4gICAgXG4gICAgZ2FkZ2V0cyA9IHdpcmVzID0gbnVsbFxuICAgIFxuICAgIGVtaXQgPSAoYXJncy4uLikgLT5cbiAgICAgICMgZm9yY2UgYSBkaWdlc3QsIHNpbmNlIGQzIGV2ZW50cyBoYXBwZW4gb3V0c2lkZSBvZiBuZydzIGV2ZW50IGNvbnRleHRcbiAgICAgIHNjb3BlLiRhcHBseSAtPiBzY29wZS4kZW1pdCBhdHRyLmV2ZW50ID8gJ2NpcmN1aXQnLCBhcmdzLi4uXG4gICAgICBcbiAgICBnYWRnZXREcmFnID0gZDMuYmVoYXZpb3IuZHJhZygpXG4gICAgICAub3JpZ2luIE9iamVjdFxuICAgICAgLm9uICdkcmFnc3RhcnQnLCAoZCkgLT5cbiAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcbiAgICAgICAgQHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQgQCAjIG1vdmUgdG8gZnJvbnRcbiAgICAgIC5vbiAnZHJhZycsIChkKSAtPlxuICAgICAgICBkLnggPSBkMy5ldmVudC54IHwgMCAjIHN0YXkgb24gaW50IGNvb3JkaW5hdGVzXG4gICAgICAgIGQueSA9IGQzLmV2ZW50LnkgfCAwICMgc3RheSBvbiBpbnQgY29vcmRpbmF0ZXNcbiAgICAgICAgZDMuc2VsZWN0KEApLmF0dHIgdHJhbnNmb3JtOiAoZCkgLT4gXCJ0cmFuc2xhdGUoI3tkLnh9LCN7ZC55fSlcIlxuICAgICAgICAjIHJlY2FsY3VsYXRlIGVuZHBvaW50cyBhbmQgcmVkcmF3IGFsbCB3aXJlcyBhdHRhY2hlZCB0byB0aGlzIGdhZGdldFxuICAgICAgICB3aXJlcy5maWx0ZXIgKHcpIC0+IHcuc291cmNlLmcgaXMgZCBvciB3LnRhcmdldC5nIGlzIGRcbiAgICAgICAgICAuZWFjaCAoZCkgLT5cbiAgICAgICAgICAgIGQuc291cmNlID0gZmluZFBpbiBkLmZyb20sIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgICAgICAgZC50YXJnZXQgPSBmaW5kUGluIGQudG8sIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgICAgIC5hdHRyIGQ6IGRpYWdcbiAgICAgIC5vbiAnZHJhZ2VuZCcsIChkKSAtPlxuICAgICAgICBlbWl0ICdtb3ZlR2FkZ2V0JywgZC5pZCwgZC54LCBkLnlcblxuICAgIGRyYWdJbmZvID0ge31cbiAgICBkcmFnV2lyZSA9IHN2Zy5hcHBlbmQoJ3BhdGgnKS5kYXR1bShkcmFnSW5mbykuYXR0ciBpZDogJ2RyYWcnXG4gICAgd2lyZVVuZGVyQ3Vyc29yID0gbnVsbFxuXG4gICAgcGluRHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgLm9yaWdpbiBPYmplY3RcbiAgICAgIC5vbiAnZHJhZ3N0YXJ0JywgKGQpIC0+XG4gICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICAgIGRyYWdJbmZvLmZyb20gPSBkLnBpblxuICAgICAgICBkZWxldGUgZHJhZ0luZm8udG9cbiAgICAgICAgZHJhZ0luZm8uc291cmNlID0gZmluZFBpbiBkLnBpbiwgc2NvcGUuZGF0YS5nYWRnZXRzXG4gICAgICAub24gJ2RyYWcnLCAoZCkgLT5cbiAgICAgICAgW214LG15XSA9IGQzLm1vdXNlKEApXG4gICAgICAgIG9yaWcgPSBkcmFnSW5mby5zb3VyY2VcbiAgICAgICAgZHJhZ0luZm8udGFyZ2V0ID0geDogb3JpZy54K215LWQueSwgeTogb3JpZy55K214LWQueCAjIGZsaXBwZWRcbiAgICAgICAgZHJhZ1dpcmUuYXR0ciBjbGFzczogJ2RyYXdpbmcnLCBmaWxsOiAnbm9uZScsIGQ6IGRpYWdcbiAgICAgIC5vbiAnZHJhZ2VuZCcsIChkKSAtPlxuICAgICAgICBkcmFnV2lyZS5jbGFzc2VkICdkcmF3aW5nJywgZmFsc2VcbiAgICAgICAgaWYgZHJhZ0luZm8udG9cbiAgICAgICAgICBudyA9IGZyb206IGRyYWdJbmZvLmZyb20sIHRvOiBkcmFnSW5mby50b1xuICAgICAgICAgIHVubGVzcyBudy5mcm9tIGlzIG53LnRvXG4gICAgICAgICAgICBlbWl0ICdhZGRXaXJlJywgbncuZnJvbSwgbncudG9cbiAgICAgICAgICByZWRyYXcoKVxuXG4gICAgcmVkcmF3ID0gLT5cbiAgICAgIHByZXBhcmVEYXRhIHNjb3BlLmRlZnMsIHNjb3BlLmRhdGFcbiAgICAgIGdhZGdldHMgPSBzdmcuc2VsZWN0QWxsKCcuZ2FkZ2V0JykuZGF0YSBzY29wZS5kYXRhLmdhZGdldHMsIChkKSAtPiBkLmlkXG4gICAgICB3aXJlcyA9IHN2Zy5zZWxlY3RBbGwoJy53aXJlJykuZGF0YSBzY29wZS5kYXRhLndpcmVzLCAoZCkgLT4gZC5pZFxuXG4gICAgICBnID0gZ2FkZ2V0cy5lbnRlcigpLmFwcGVuZCgnZycpLmNhbGwoZ2FkZ2V0RHJhZylcbiAgICAgICAgLmF0dHIgY2xhc3M6ICdnYWRnZXQnXG4gICAgICBnLmFwcGVuZCgncmVjdCcpXG4gICAgICAgIC5lYWNoIChkKSAtPlxuICAgICAgICAgIGQzLnNlbGVjdChAKS5hdHRyXG4gICAgICAgICAgICBjbGFzczogJ291dGxpbmUnXG4gICAgICAgICAgICAjIDFweCBsaW5lcyByZW5kZXIgc2hhcnBseSB3aGVuIG9uIGEgMC41cHggb2Zmc2V0XG4gICAgICAgICAgICB4OiAwLjUgLSBkLmh3LCB5OiAwLjUgLSBkLmhoXG4gICAgICAgICAgICB3aWR0aDogMiAqIGQuaHcsIGhlaWdodDogMiAqIGQuaGhcbiAgICAgICAgLm9uICdtb3VzZWRvd24nLCAoZCkgLT4gZW1pdCAnc2VsZWN0R2FkZ2V0JywgZC5pZFxuICAgICAgICAuc3R5bGUgZmlsbDogKGQpIC0+IGQuZGVmLnNoYWRlXG4gICAgICBnLmFwcGVuZCgndGV4dCcpLnRleHQgKGQpIC0+IGQudGl0bGUgb3IgZC5kZWYubmFtZVxuICAgICAgICAuYXR0ciBjbGFzczogJ3RpdGxlJywgeTogKGQpIC0+IDEyIC0gZC5oaFxuICAgICAgZy5hcHBlbmQoJ3RleHQnKS50ZXh0IChkKSAtPiBcIiN7ZC50eXBlfSAtICN7ZC5pZH1cIlxuICAgICAgICAuYXR0ciBjbGFzczogJ3R5cGUnLCB5OiAoZCkgLT4gLTQgKyBkLmhoXG4gICAgICBnLmFwcGVuZCgndGV4dCcpLnRleHQgKGQpIC0+IGQuZGVmLmljb25cbiAgICAgICAgLmF0dHIgY2xhc3M6ICdpY29uZm9udCcsIHg6IDAsIHk6IDBcbiAgICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gJ1xcdWYwMTQnICMgZmEtdHJhc2gtb1xuICAgICAgICAuYXR0ciBjbGFzczogJ2ljb25mb250JywgeDogKChkKSAtPiBkLmh3LTgpLCB5OiAoKGQpIC0+IDgtZC5oaClcbiAgICAgICAgLnN0eWxlICdmb250LXNpemUnOiAnMTJweCdcbiAgICAgICAgLm9uICdtb3VzZWRvd24nLCAoZCkgLT5cbiAgICAgICAgICBkMy5ldmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgIGVtaXQgJ2RlbEdhZGdldCcsIGQuaWRcbiAgICAgICAgICByZWRyYXcoKVxuICAgICAgZ2FkZ2V0cy5leGl0KCkucmVtb3ZlKClcblxuICAgICAgcGlucyA9IGdhZGdldHMuc2VsZWN0QWxsKCcucGluJykuZGF0YSAoZCkgLT4gZC5waW5zXG4gICAgICBwID0gcGlucy5lbnRlcigpXG4gICAgICBwLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgICAgLmF0dHIgY2xhc3M6ICdwaW4nLCBjeDogKChkKSAtPiBkLngrLjUpLCBjeTogKChkKSAtPiBkLnkrLjUpLCByOiAzXG4gICAgICBwLmFwcGVuZCgnY2lyY2xlJykuY2FsbChwaW5EcmFnKVxuICAgICAgICAuYXR0ciBjbGFzczogJ2hpdCcsIGN4OiAoKGQpIC0+IGQueCsuNSksIGN5OiAoKGQpIC0+IGQueSsuNSksIHI6IDdcbiAgICAgICAgLm9uICdtb3VzZXVwJywgKGQpIC0+IGRyYWdJbmZvLnRvID0gZC5waW5cbiAgICAgIHAuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC5uYW1lXG4gICAgICAgIC5hdHRyXG4gICAgICAgICAgY2xhc3M6IChkKSAtPiBkLmRpclxuICAgICAgICAgIHg6IChkKSAtPiBpZiBkLmRpciBpcyAnaW4nIHRoZW4gZC54ICsgMTAgZWxzZSBkLnggLSAxMFxuICAgICAgICAgIHk6IChkKSAtPiBkLnkgKyA1XG4gICAgICBwaW5zLmV4aXQoKS5yZW1vdmUoKVxuXG4gICAgICB3aXJlcy5lbnRlcigpLmluc2VydCgncGF0aCcsICdnJykgIyB1c2VzIGluc2VydCB0byBtb3ZlIHRvIGJhY2sgcmlnaHQgYXdheVxuICAgICAgICAuYXR0ciBjbGFzczogJ3dpcmUnLCBmaWxsOiAnbm9uZScsIGQ6IGRpYWdcbiAgICAgICAgIyBjYW4ndCB1c2UgbW91c2VjbGljaywgc2VlXG4gICAgICAgICMgaHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9kL21zZy9kMy1qcy9nSHpPajkxWDJOQS82NUJFZjJEdVJWNEpcbiAgICAgICAgLm9uICdtb3VzZWVudGVyJywgKGQpIC0+IHdpcmVVbmRlckN1cnNvciA9IGRcbiAgICAgICAgLm9uICdtb3VzZWxlYXZlJywgKGQpIC0+IHdpcmVVbmRlckN1cnNvciA9IG51bGxcbiAgICAgIHdpcmVzLmV4aXQoKS5yZW1vdmUoKVxuXG4gICAgICBnYWRnZXRzLmF0dHIgdHJhbnNmb3JtOiAoZCkgLT4gXCJ0cmFuc2xhdGUoI3tkLnh9LCN7ZC55fSlcIlxuICAgIFxuICAgIHJlZHJhdygpXG4gICAgXG4gICAgc3ZnLm9uICdtb3VzZWRvd24nLCAtPlxuICAgICAgIyByZXR1cm4gIGlmIGQzLmV2ZW50LmRlZmF1bHRQcmV2ZW50ZWRcbiAgICAgIGlmIHdpcmVVbmRlckN1cnNvclxuICAgICAgICBlbWl0ICdkZWxXaXJlJywgd2lyZVVuZGVyQ3Vyc29yLmZyb20sIHdpcmVVbmRlckN1cnNvci50b1xuICAgICAgICB3aXJlVW5kZXJDdXJzb3IgPSBudWxsXG4gICAgICBlbHNlXG4gICAgICAgIFt4LHldID0gZDMubW91c2UoQClcbiAgICAgICAgZW1pdCAnYWRkR2FkZ2V0JywgeHwwLCB5fDAgIyBjb252ZXJ0IHRvIGludHNcbiAgICAgIHJlZHJhdygpXG5cbmZpbmRQaW4gPSAocGluLCBnZGF0YSkgLT5cbiAgW2dpZCxwbmFtZV0gPSBwaW4uc3BsaXQgJy4nXG4gIGZvciBnIGluIGdkYXRhIHdoZW4gZ2lkIGlzIGcuaWRcbiAgICBmb3IgcCBpbiBnLnBpbnMgd2hlbiBwbmFtZSBpcyBwLm5hbWVcbiAgICAgICMgcmV2ZXJzZXMgeCBhbmQgeSBhbmQgdXNlcyBwcm9qZWN0aW9uIHRvIGdldCBob3Jpem9udGFsIHNwbGluZXNcbiAgICAgIHJldHVybiB5OiBnLnggKyBwLnggKyAuNSwgeDogZy55ICsgcC55ICsgLjUsIGc6IGdcblxucHJlcGFyZURhdGEgPSAoZ2RlZnMsIGdkYXRhKSAtPlxuICB5c3RlcCA9IDIwICAjIHZlcnRpY2FsIHNlcGFyYXRpb24gYmV0d2VlbiBwaW5zXG4gIHdpZHRoID0gMTQwICMgZml4ZWQgd2lkdGggZm9yIG5vd1xuXG4gICMgcHJlLWNhbGN1bGF0ZSBzaXplcyBhbmQgcmVsYXRpdmUgcGluIGNvb3JkaW5hdGVzXG4gIGZvciBkIGluIGdkYXRhLmdhZGdldHNcbiAgICBkLmRlZiA9IGdkZWZzW2QudHlwZV1cbiAgICBkLnBpbnMgPSBbXVxuICAgIHBsYWNlUGlucyA9IChwbmFtZXMsIGRpciwgeCkgLT5cbiAgICAgIG5saXN0ID0gKHBuYW1lcyA/ICcnKS5zcGxpdCAnICdcbiAgICAgIHkgPSAteXN0ZXAgKiAobmxpc3QubGVuZ3RoIC0gMSkgPj4gMVxuICAgICAgZm9yIG5hbWUgaW4gbmxpc3RcbiAgICAgICAgZC5waW5zLnB1c2ggeyB4LCB5LCBuYW1lLCBkaXIsIHBpbjogXCIje2QuaWR9LiN7bmFtZX1cIiB9XG4gICAgICAgIHkgKz0geXN0ZXBcbiAgICAgIG5saXN0Lmxlbmd0aFxuICAgIGQuaHcgPSB3aWR0aCAvIDJcbiAgICBpbnMgPSBwbGFjZVBpbnMgZC5kZWYuaW5wdXRzLCAnaW4nLCAtZC5od1xuICAgIG91dHMgPSBwbGFjZVBpbnMgZC5kZWYub3V0cHV0cywgJ291dCcsIGQuaHdcbiAgICBkLmhlaWdodCA9IDQwICsgeXN0ZXAgKiAoaWYgaW5zID4gb3V0cyB0aGVuIGlucyBlbHNlIG91dHMpXG4gICAgZC5oaCA9IGQuaGVpZ2h0IC8gMlxuXG4gICMgbG9va3VwIHRoZSB3aXJlIGVuZHBvaW50cyBpbiB0aGUgZ2FkZ2V0c1xuICBmb3IgZCBpbiBnZGF0YS53aXJlc1xuICAgIGQuaWQgPSBcIiN7ZC5mcm9tfS8je2QudG99XCJcbiAgICBkLnNvdXJjZSA9IGZpbmRQaW4gZC5mcm9tLCBnZGF0YS5nYWRnZXRzXG4gICAgZC50YXJnZXQgPSBmaW5kUGluIGQudG8sIGdkYXRhLmdhZGdldHNcbiJdfQ==
