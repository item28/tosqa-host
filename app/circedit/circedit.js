(function() {
  var findPin, ng, prepareData;

  ng = angular.module('myApp');

  ng.directive('circuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        defs: '=',
        data: '=',
        type: '='
      },
      link: function(scope, elem, attr) {
        var diag, dragInfo, dragWire, gadgetDrag, gadgets, k, lastg, pinDrag, redraw, svg, wireUnderCursor, wires;
        for (k in scope.defs) {
          scope.type = k;
          break;
        }
        svg = d3.select(elem[0]).append('svg').attr({
          height: '60%'
        });
        diag = d3.svg.diagonal().projection(function(d) {
          return [d.y, d.x];
        });
        lastg = gadgets = wires = null;
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          this.parentNode.appendChild(this);
          return d3.event.sourceEvent.stopPropagation();
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
          return wires.filter(function(w) {
            return w.source.g === d || w.target.g === d;
          }).each(function(d) {
            d.source = findPin(d.from, scope.data.gadgets);
            return d.target = findPin(d.to, scope.data.gadgets);
          }).attr({
            d: diag
          });
        }).on('dragend', function(d) {
          return console.log('save gadget', d);
        });
        dragInfo = {};
        dragWire = svg.append('path').datum(dragInfo).attr({
          id: 'drag'
        });
        wireUnderCursor = null;
        pinDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          d3.event.sourceEvent.stopPropagation();
          this.parentNode.appendChild(this);
          dragInfo.from = d.pin;
          delete dragInfo.to;
          return dragInfo.source = findPin(d.pin, scope.data.gadgets);
        }).on('drag', function(d) {
          var mx, my, orig, _ref;
          _ref = d3.mouse(this), mx = _ref[0], my = _ref[1];
          orig = dragInfo.source;
          dragInfo.target = {
            x: orig.x + my - d.y,
            y: orig.y + mx - d.x
          };
          return dragWire.attr({
            "class": 'drawing',
            fill: 'none',
            d: diag
          });
        }).on('dragend', function(d) {
          var nw;
          dragWire.classed('drawing', false);
          if (dragInfo.to) {
            nw = {
              from: dragInfo.from,
              to: dragInfo.to
            };
            if (nw.from !== nw.to) {
              console.log('add wire', nw);
              scope.data.wires.push(nw);
            }
            return redraw();
          }
        });
        redraw = function() {
          var g, p, pins;
          lastg = prepareData(scope.defs, scope.data);
          gadgets = svg.selectAll('.gadget').data(scope.data.gadgets, function(d) {
            return d.id;
          });
          wires = svg.selectAll('.wire').data(scope.data.wires, function(d) {
            return "" + d.from + "/" + d.to;
          });
          g = gadgets.enter().append('g').call(gadgetDrag).attr({
            "class": 'gadget'
          });
          g.append('rect').each(function(d) {
            d.def = scope.defs[d.type];
            d.hw = d.def.width / 2;
            d.hh = d.def.height / 2;
            return d3.select(this).attr({
              "class": 'outline',
              x: 0.5 - d.hw,
              y: 0.5 - d.hh,
              width: 2 * d.hw,
              height: 2 * d.hh
            });
          }).style({
            fill: function(d) {
              return d.def.shade;
            }
          });
          g.append('text').text(function(d) {
            return d.title || ("" + d.type + " " + d.id);
          }).attr({
            "class": 'title',
            y: function(d) {
              return 12 - d.hh;
            }
          });
          g.append('text').text(function(d) {
            return d.def.name;
          }).attr({
            "class": 'type',
            y: function(d) {
              return -4 + d.hh;
            }
          });
          g.append('text').text(function(d) {
            return d.def.icon;
          }).attr({
            "class": 'iconfont',
            x: 0,
            y: 0
          });
          g.append('text').text(function(d) {
            return '\uf014';
          }).attr({
            "class": 'iconfont',
            x: (function(d) {
              return d.hw - 8;
            }),
            y: (function(d) {
              return 8 - d.hh;
            })
          }).style({
            'font-size': '12px'
          }).on('mousedown', function(d) {
            var i, n, sdw, w, _ref;
            d3.event.stopPropagation();
            sdw = scope.data.wires;
            n = sdw.length;
            while (n) {
              w = sdw[--n];
              if (w.from.split('.')[0] === d.id || w.to.split('.')[0] === d.id) {
                console.log('del attached', w);
                sdw.splice(n, 1);
              }
            }
            console.log('del gadget', d);
            _ref = scope.data.gadgets;
            for (i in _ref) {
              g = _ref[i];
              if (!(g === d)) {
                continue;
              }
              scope.data.gadgets.splice(i, 1);
              break;
            }
            return redraw();
          });
          gadgets.exit().remove();
          pins = gadgets.selectAll('.pin').data(function(d) {
            var p;
            return d.conn = (function() {
              var _i, _len, _ref, _results;
              _ref = d.def.pins;
              _results = [];
              for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                p = _ref[_i];
                _results.push({
                  x: p.x,
                  y: p.y,
                  name: p.name,
                  dir: p.dir,
                  pin: "" + d.id + "." + p.name
                });
              }
              return _results;
            })();
          });
          p = pins.enter();
          p.append('circle').attr({
            "class": 'pin',
            cx: (function(d) {
              return d.x + .5;
            }),
            cy: (function(d) {
              return d.y + .5;
            }),
            r: 3
          });
          p.append('circle').call(pinDrag).attr({
            "class": 'hit',
            cx: (function(d) {
              return d.x + .5;
            }),
            cy: (function(d) {
              return d.y + .5;
            }),
            r: 7
          }).on('mouseup', function(d) {
            return dragInfo.to = d.pin;
          });
          p.append('text').text(function(d) {
            return d.name;
          }).attr({
            "class": function(d) {
              return d.dir;
            },
            x: function(d) {
              if (d.dir === 'in') {
                return d.x + 10;
              } else {
                return d.x - 10;
              }
            },
            y: function(d) {
              return d.y + 5;
            }
          });
          pins.exit().remove();
          wires.enter().insert('path', 'g').attr({
            "class": 'wire',
            fill: 'none',
            d: diag
          }).on('mouseenter', function(d) {
            return wireUnderCursor = d;
          }).on('mouseleave', function(d) {
            return wireUnderCursor = null;
          });
          wires.exit().remove();
          return gadgets.attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
        };
        redraw();
        return svg.on('mousedown', function() {
          var i, w, x, y, _ref, _ref1;
          if (wireUnderCursor) {
            console.log('del wire', wireUnderCursor);
            _ref = scope.data.wires;
            for (i in _ref) {
              w = _ref[i];
              if (!(w === wireUnderCursor)) {
                continue;
              }
              scope.data.wires.splice(i, 1);
              break;
            }
          } else {
            _ref1 = d3.mouse(this), x = _ref1[0], y = _ref1[1];
            ng = {
              id: "g" + (++lastg),
              x: x | 0,
              y: y | 0,
              type: scope.type
            };
            console.log('add gadget', ng);
            scope.data.gadgets.push(ng);
          }
          return redraw();
        });
      }
    };
  });

  findPin = function(name, gdata) {
    var g, gid, p, pname, _i, _j, _len, _len1, _ref, _ref1;
    _ref = name.split('.'), gid = _ref[0], pname = _ref[1];
    for (_i = 0, _len = gdata.length; _i < _len; _i++) {
      g = gdata[_i];
      if (gid === g.id) {
        _ref1 = g.def.pins;
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          p = _ref1[_j];
          if (pname === p.name) {
            return {
              y: g.x + p.x + .5,
              x: g.y + p.y + .5,
              g: g,
              p: p
            };
          }
        }
      }
    }
  };

  prepareData = function(gdefs, gdata) {
    var d, ins, n, outs, p, seq, step, yIn, yOut, _i, _j, _k, _l, _len, _len1, _len2, _len3, _ref, _ref1, _ref2, _ref3;
    for (n in gdefs) {
      d = gdefs[n];
      d.name || (d.name = n);
      ins = 0;
      _ref = d.pins;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        p = _ref[_i];
        p.x = d.width / 2;
        if (p.dir === 'in') {
          p.x = -p.x;
          ++ins;
        }
      }
      outs = d.pins.length - ins;
      step = 20;
      yIn = -(ins - 1) * step / 2;
      yOut = -(outs - 1) * step / 2;
      _ref1 = d.pins;
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        p = _ref1[_j];
        if (p.dir === 'in') {
          p.y = yIn;
          yIn += step;
        } else {
          p.y = yOut;
          yOut += step;
        }
      }
      d.height = 40 + step * (ins > outs ? ins : outs);
    }
    seq = 0;
    _ref2 = gdata.gadgets;
    for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
      d = _ref2[_k];
      if (/^g\d+$/.test(d.id)) {
        n = d.id.slice(1) | 0;
        if (n > seq) {
          seq = n;
        }
      }
      d.def = gdefs[d.type];
      d.hw = d.def.width / 2;
      d.hh = d.def.height / 2;
    }
    _ref3 = gdata.wires;
    for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {
      d = _ref3[_l];
      d.source = findPin(d.from, gdata.gadgets);
      d.target = findPin(d.to, gdata.gadgets);
    }
    return seq;
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSx3QkFBQTs7QUFBQSxFQUFBLEVBQUEsR0FBSyxPQUFPLENBQUMsTUFBUixDQUFlLE9BQWYsQ0FBTCxDQUFBOztBQUFBLEVBRUEsRUFBRSxDQUFDLFNBQUgsQ0FBYSxlQUFiLEVBQThCLFNBQUEsR0FBQTtXQUM1QjtBQUFBLE1BQUEsUUFBQSxFQUFVLEdBQVY7QUFBQSxNQUVBLEtBQUEsRUFDRTtBQUFBLFFBQUEsSUFBQSxFQUFNLEdBQU47QUFBQSxRQUNBLElBQUEsRUFBTSxHQUROO0FBQUEsUUFFQSxJQUFBLEVBQU0sR0FGTjtPQUhGO0FBQUEsTUFPQSxJQUFBLEVBQU0sU0FBQyxLQUFELEVBQVEsSUFBUixFQUFjLElBQWQsR0FBQTtBQUNKLFlBQUEscUdBQUE7QUFBQSxhQUFBLGVBQUEsR0FBQTtBQUNFLFVBQUEsS0FBSyxDQUFDLElBQU4sR0FBYSxDQUFiLENBQUE7QUFDQSxnQkFGRjtBQUFBLFNBQUE7QUFBQSxRQUlBLEdBQUEsR0FBTSxFQUFFLENBQUMsTUFBSCxDQUFVLElBQUssQ0FBQSxDQUFBLENBQWYsQ0FBa0IsQ0FBQyxNQUFuQixDQUEwQixLQUExQixDQUNKLENBQUMsSUFERyxDQUNFO0FBQUEsVUFBQSxNQUFBLEVBQVEsS0FBUjtTQURGLENBSk4sQ0FBQTtBQUFBLFFBTUEsSUFBQSxHQUFPLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUCxDQUFBLENBQ0wsQ0FBQyxVQURJLENBQ08sU0FBQyxDQUFELEdBQUE7aUJBQU8sQ0FBQyxDQUFDLENBQUMsQ0FBSCxFQUFNLENBQUMsQ0FBQyxDQUFSLEVBQVA7UUFBQSxDQURQLENBTlAsQ0FBQTtBQUFBLFFBU0EsS0FBQSxHQUFRLE9BQUEsR0FBVSxLQUFBLEdBQVEsSUFUMUIsQ0FBQTtBQUFBLFFBV0EsVUFBQSxHQUFhLEVBQUUsQ0FBQyxRQUFRLENBQUMs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QUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBTCxDQUFXLENBQVgsQ0FBQSxHQUFnQixDQUFwQixDQUFBO0FBQ0EsUUFBQSxJQUFZLENBQUEsR0FBSSxHQUFoQjtBQUFBLFVBQUEsR0FBQSxHQUFNLENBQU4sQ0FBQTtTQUZGO09BQUE7QUFBQSxNQUdBLENBQUMsQ0FBQyxHQUFGLEdBQVEsS0FBTSxDQUFBLENBQUMsQ0FBQyxJQUFGLENBSGQsQ0FBQTtBQUFBLE1BSUEsQ0FBQyxDQUFDLEVBQUYsR0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQU4sR0FBYyxDQUpyQixDQUFBO0FBQUEsTUFLQSxDQUFDLENBQUMsRUFBRixHQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTixHQUFlLENBTHRCLENBREY7QUFBQSxLQXRCQTtBQThCQTtBQUFBLFNBQUEsOENBQUE7b0JBQUE7QUFDRSxNQUFBLENBQUMsQ0FBQyxNQUFGLEdBQVcsT0FBQSxDQUFRLENBQUMsQ0FBQyxJQUFWLEVBQWdCLEtBQUssQ0FBQyxPQUF0QixDQUFYLENBQUE7QUFBQSxNQUNBLENBQUMsQ0FBQyxNQUFGLEdBQVcsT0FBQSxDQUFRLENBQUMsQ0FBQyxFQUFWLEVBQWMsS0FBSyxDQUFDLE9BQXBCLENBRFgsQ0FERjtBQUFBLEtBOUJBO0FBa0NBLFdBQU8sR0FBUCxDQXBDWTtFQUFBLENBaEtkLENBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIm5nID0gYW5ndWxhci5tb2R1bGUgJ215QXBwJ1xuXG5uZy5kaXJlY3RpdmUgJ2NpcmN1aXRFZGl0b3InLCAtPlxuICByZXN0cmljdDogJ0UnXG4gIFxuICBzY29wZTpcbiAgICBkZWZzOiAnPSdcbiAgICBkYXRhOiAnPSdcbiAgICB0eXBlOiAnPSdcbiAgICBcbiAgbGluazogKHNjb3BlLCBlbGVtLCBhdHRyKSAtPlxuICAgIGZvciBrIG9mIHNjb3BlLmRlZnNcbiAgICAgIHNjb3BlLnR5cGUgPSBrICMgc2V0IGluaXRpYWwgdHlwZSB0byBhIHZhbGlkIGtleSBmcm9tIHRoZSBkZWZpbml0aW9uc1xuICAgICAgYnJlYWtcbiAgICBcbiAgICBzdmcgPSBkMy5zZWxlY3QoZWxlbVswXSkuYXBwZW5kICdzdmcnXG4gICAgICAuYXR0ciBoZWlnaHQ6ICc2MCUnXG4gICAgZGlhZyA9IGQzLnN2Zy5kaWFnb25hbCgpXG4gICAgICAucHJvamVjdGlvbiAoZCkgLT4gW2QueSwgZC54XSAjIHVuZG8gdGhlIHgveSByZXZlcnNhbCBmcm9tIGZpbmRQaW5cbiAgICBcbiAgICBsYXN0ZyA9IGdhZGdldHMgPSB3aXJlcyA9IG51bGxcbiAgICBcbiAgICBnYWRnZXREcmFnID0gZDMuYmVoYXZpb3IuZHJhZygpXG4gICAgICAub3JpZ2luIE9iamVjdFxuICAgICAgLm9uICdkcmFnc3RhcnQnLCAoZCkgLT5cbiAgICAgICAgQHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQgQCAjIG1vdmUgdG8gZnJvbnRcbiAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcbiAgICAgIC5vbiAnZHJhZycsIChkKSAtPlxuICAgICAgICBkLnggPSBkMy5ldmVudC54IHwgMCAjIHN0YXkgb24gaW50IGNvb3JkaW5hdGVzXG4gICAgICAgIGQueSA9IGQzLmV2ZW50LnkgfCAwICMgc3RheSBvbiBpbnQgY29vcmRpbmF0ZXNcbiAgICAgICAgZDMuc2VsZWN0KEApLmF0dHIgdHJhbnNmb3JtOiAoZCkgLT4gXCJ0cmFuc2xhdGUoI3tkLnh9LCN7ZC55fSlcIlxuICAgICAgICAjIHJlY2FsY3VsYXRlIGVuZHBvaW50cyBhbmQgcmVkcmF3IGFsbCB3aXJlcyBhdHRhY2hlZCB0byB0aGlzIGdhZGdldFxuICAgICAgICB3aXJlcy5maWx0ZXIgKHcpIC0+IHcuc291cmNlLmcgaXMgZCBvciB3LnRhcmdldC5nIGlzIGRcbiAgICAgICAgICAuZWFjaCAoZCkgLT5cbiAgICAgICAgICAgIGQuc291cmNlID0gZmluZFBpbiBkLmZyb20sIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgICAgICAgZC50YXJnZXQgPSBmaW5kUGluIGQudG8sIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgICAgIC5hdHRyIGQ6IGRpYWdcbiAgICAgIC5vbiAnZHJhZ2VuZCcsIChkKSAtPlxuICAgICAgICBjb25zb2xlLmxvZyAnc2F2ZSBnYWRnZXQnLCBkICMgVE9ETzogc2F2ZSB0byBzZXJ2ZXJcblxuICAgIGRyYWdJbmZvID0ge31cbiAgICBkcmFnV2lyZSA9IHN2Zy5hcHBlbmQoJ3BhdGgnKS5kYXR1bShkcmFnSW5mbykuYXR0ciBpZDogJ2RyYWcnXG4gICAgd2lyZVVuZGVyQ3Vyc29yID0gbnVsbFxuXG4gICAgcGluRHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgLm9yaWdpbiBPYmplY3RcbiAgICAgIC5vbiAnZHJhZ3N0YXJ0JywgKGQpIC0+XG4gICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICAgIEBwYXJlbnROb2RlLmFwcGVuZENoaWxkIEAgIyBtb3ZlIHRvIGZyb250XG4gICAgICAgIGRyYWdJbmZvLmZyb20gPSBkLnBpblxuICAgICAgICBkZWxldGUgZHJhZ0luZm8udG9cbiAgICAgICAgZHJhZ0luZm8uc291cmNlID0gZmluZFBpbiBkLnBpbiwgc2NvcGUuZGF0YS5nYWRnZXRzXG4gICAgICAub24gJ2RyYWcnLCAoZCkgLT5cbiAgICAgICAgW214LG15XSA9IGQzLm1vdXNlKEApXG4gICAgICAgIG9yaWcgPSBkcmFnSW5mby5zb3VyY2VcbiAgICAgICAgZHJhZ0luZm8udGFyZ2V0ID0geDogb3JpZy54K215LWQueSwgeTogb3JpZy55K214LWQueCAjIGZsaXBwZWRcbiAgICAgICAgZHJhZ1dpcmUuYXR0ciBjbGFzczogJ2RyYXdpbmcnLCBmaWxsOiAnbm9uZScsIGQ6IGRpYWdcbiAgICAgIC5vbiAnZHJhZ2VuZCcsIChkKSAtPlxuICAgICAgICBkcmFnV2lyZS5jbGFzc2VkICdkcmF3aW5nJywgZmFsc2VcbiAgICAgICAgaWYgZHJhZ0luZm8udG9cbiAgICAgICAgICBudyA9IGZyb206IGRyYWdJbmZvLmZyb20sIHRvOiBkcmFnSW5mby50b1xuICAgICAgICAgIHVubGVzcyBudy5mcm9tIGlzIG53LnRvXG4gICAgICAgICAgICBjb25zb2xlLmxvZyAnYWRkIHdpcmUnLCBudyAjIFRPRE86IHNhdmUgdG8gc2VydmVyXG4gICAgICAgICAgICBzY29wZS5kYXRhLndpcmVzLnB1c2ggbndcbiAgICAgICAgICByZWRyYXcoKVxuXG4gICAgcmVkcmF3ID0gLT5cbiAgICAgIGxhc3RnID0gcHJlcGFyZURhdGEgc2NvcGUuZGVmcywgc2NvcGUuZGF0YVxuICAgICAgZ2FkZ2V0cyA9IHN2Zy5zZWxlY3RBbGwoJy5nYWRnZXQnKS5kYXRhIHNjb3BlLmRhdGEuZ2FkZ2V0cywgKGQpIC0+IGQuaWRcbiAgICAgIHdpcmVzID0gc3ZnLnNlbGVjdEFsbCgnLndpcmUnKS5kYXRhIHNjb3BlLmRhdGEud2lyZXMsIChkKSAtPlxuICAgICAgICAgICAgICAgIFwiI3tkLmZyb219LyN7ZC50b31cIiAjIGVzc2VudGlhbCBmb3IgYWRkaW5nIG9yIHJlbW92aW5nIHdpcmVzXG5cbiAgICAgIGcgPSBnYWRnZXRzLmVudGVyKCkuYXBwZW5kKCdnJykuY2FsbChnYWRnZXREcmFnKVxuICAgICAgICAuYXR0ciBjbGFzczogJ2dhZGdldCdcbiAgICAgIGcuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgLmVhY2ggKGQpIC0+XG4gICAgICAgICAgZC5kZWYgPSBzY29wZS5kZWZzW2QudHlwZV1cbiAgICAgICAgICBkLmh3ID0gZC5kZWYud2lkdGggLyAyXG4gICAgICAgICAgZC5oaCA9IGQuZGVmLmhlaWdodCAvIDJcbiAgICAgICAgICBkMy5zZWxlY3QoQCkuYXR0clxuICAgICAgICAgICAgY2xhc3M6ICdvdXRsaW5lJ1xuICAgICAgICAgICAgIyAxcHggbGluZXMgcmVuZGVyIHNoYXJwbHkgd2hlbiBvbiBhIDAuNXB4IG9mZnNldFxuICAgICAgICAgICAgeDogMC41IC0gZC5odywgeTogMC41IC0gZC5oaFxuICAgICAgICAgICAgd2lkdGg6IDIgKiBkLmh3LCBoZWlnaHQ6IDIgKiBkLmhoXG4gICAgICAgIC5zdHlsZSBmaWxsOiAoZCkgLT4gZC5kZWYuc2hhZGVcbiAgICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC50aXRsZSBvciBcIiN7ZC50eXBlfSAje2QuaWR9XCJcbiAgICAgICAgLmF0dHIgY2xhc3M6ICd0aXRsZScsIHk6IChkKSAtPiAxMiAtIGQuaGhcbiAgICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC5kZWYubmFtZVxuICAgICAgICAuYXR0ciBjbGFzczogJ3R5cGUnLCB5OiAoZCkgLT4gLTQgKyBkLmhoXG4gICAgICBnLmFwcGVuZCgndGV4dCcpLnRleHQgKGQpIC0+IGQuZGVmLmljb25cbiAgICAgICAgLmF0dHIgY2xhc3M6ICdpY29uZm9udCcsIHg6IDAsIHk6IDBcbiAgICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gJ1xcdWYwMTQnICMgZmEtdHJhc2gtb1xuICAgICAgICAuYXR0ciBjbGFzczogJ2ljb25mb250JywgeDogKChkKSAtPiBkLmh3LTgpLCB5OiAoKGQpIC0+IDgtZC5oaClcbiAgICAgICAgLnN0eWxlICdmb250LXNpemUnOiAnMTJweCdcbiAgICAgICAgLm9uICdtb3VzZWRvd24nLCAoZCkgLT5cbiAgICAgICAgICBkMy5ldmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgICMgZGVsZXRlIGFsbCBhdHRhY2hlZCB3aXJlc1xuICAgICAgICAgIHNkdyA9IHNjb3BlLmRhdGEud2lyZXNcbiAgICAgICAgICBuID0gc2R3Lmxlbmd0aFxuICAgICAgICAgIHdoaWxlIG5cbiAgICAgICAgICAgIHcgPSBzZHdbLS1uXVxuICAgICAgICAgICAgaWYgdy5mcm9tLnNwbGl0KCcuJylbMF0gaXMgZC5pZCBvciB3LnRvLnNwbGl0KCcuJylbMF0gaXMgZC5pZFxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyAnZGVsIGF0dGFjaGVkJywgdyAjIFRPRE86IHNhdmUgdG8gc2VydmVyXG4gICAgICAgICAgICAgIHNkdy5zcGxpY2UgbiwgMVxuICAgICAgICAgIGNvbnNvbGUubG9nICdkZWwgZ2FkZ2V0JywgZCAjIFRPRE86IHNhdmUgdG8gc2VydmVyXG4gICAgICAgICAgZm9yIGksIGcgb2Ygc2NvcGUuZGF0YS5nYWRnZXRzIHdoZW4gZyBpcyBkXG4gICAgICAgICAgICBzY29wZS5kYXRhLmdhZGdldHMuc3BsaWNlIGksIDFcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgcmVkcmF3KClcbiAgICAgIGdhZGdldHMuZXhpdCgpLnJlbW92ZSgpXG4gICAgICAgIFxuICAgICAgcGlucyA9IGdhZGdldHMuc2VsZWN0QWxsKCcucGluJykuZGF0YSAoZCkgLT5cbiAgICAgICAgZC5jb25uID0gZm9yIHAgaW4gZC5kZWYucGluc1xuICAgICAgICAgIHg6IHAueCwgeTogcC55LCBuYW1lOiBwLm5hbWUsIGRpcjogcC5kaXIsIHBpbjogXCIje2QuaWR9LiN7cC5uYW1lfVwiXG4gICAgICBwID0gcGlucy5lbnRlcigpXG4gICAgICBwLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgICAgLmF0dHIgY2xhc3M6ICdwaW4nLCBjeDogKChkKSAtPiBkLngrLjUpLCBjeTogKChkKSAtPiBkLnkrLjUpLCByOiAzXG4gICAgICBwLmFwcGVuZCgnY2lyY2xlJykuY2FsbChwaW5EcmFnKVxuICAgICAgICAuYXR0ciBjbGFzczogJ2hpdCcsIGN4OiAoKGQpIC0+IGQueCsuNSksIGN5OiAoKGQpIC0+IGQueSsuNSksIHI6IDdcbiAgICAgICAgLm9uICdtb3VzZXVwJywgKGQpIC0+IGRyYWdJbmZvLnRvID0gZC5waW5cbiAgICAgIHAuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC5uYW1lXG4gICAgICAgIC5hdHRyXG4gICAgICAgICAgY2xhc3M6IChkKSAtPiBkLmRpclxuICAgICAgICAgIHg6IChkKSAtPiBpZiBkLmRpciBpcyAnaW4nIHRoZW4gZC54ICsgMTAgZWxzZSBkLnggLSAxMFxuICAgICAgICAgIHk6IChkKSAtPiBkLnkgKyA1XG4gICAgICBwaW5zLmV4aXQoKS5yZW1vdmUoKVxuXG4gICAgICB3aXJlcy5lbnRlcigpLmluc2VydCgncGF0aCcsICdnJykgIyB1c2VzIGluc2VydCB0byBtb3ZlIHRvIGJhY2sgcmlnaHQgYXdheVxuICAgICAgICAuYXR0ciBjbGFzczogJ3dpcmUnLCBmaWxsOiAnbm9uZScsIGQ6IGRpYWdcbiAgICAgICAgIyBjYW4ndCB1c2UgbW91c2VjbGljaywgc2VlXG4gICAgICAgICMgaHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9kL21zZy9kMy1qcy9nSHpPajkxWDJOQS82NUJFZjJEdVJWNEpcbiAgICAgICAgLm9uICdtb3VzZWVudGVyJywgKGQpIC0+IHdpcmVVbmRlckN1cnNvciA9IGRcbiAgICAgICAgLm9uICdtb3VzZWxlYXZlJywgKGQpIC0+IHdpcmVVbmRlckN1cnNvciA9IG51bGxcbiAgICAgIHdpcmVzLmV4aXQoKS5yZW1vdmUoKVxuXG4gICAgICBnYWRnZXRzLmF0dHIgdHJhbnNmb3JtOiAoZCkgLT4gXCJ0cmFuc2xhdGUoI3tkLnh9LCN7ZC55fSlcIlxuICAgIFxuICAgIHJlZHJhdygpXG4gICAgXG4gICAgc3ZnLm9uICdtb3VzZWRvd24nLCAtPlxuICAgICAgIyByZXR1cm4gIGlmIGQzLmV2ZW50LmRlZmF1bHRQcmV2ZW50ZWRcbiAgICAgIGlmIHdpcmVVbmRlckN1cnNvclxuICAgICAgICBjb25zb2xlLmxvZyAnZGVsIHdpcmUnLCB3aXJlVW5kZXJDdXJzb3IgIyBUT0RPOiBzYXZlIHRvIHNlcnZlclxuICAgICAgICBmb3IgaSwgdyBvZiBzY29wZS5kYXRhLndpcmVzIHdoZW4gdyBpcyB3aXJlVW5kZXJDdXJzb3JcbiAgICAgICAgICBzY29wZS5kYXRhLndpcmVzLnNwbGljZSBpLCAxXG4gICAgICAgICAgYnJlYWtcbiAgICAgIGVsc2VcbiAgICAgICAgW3gseV0gPSBkMy5tb3VzZSBAXG4gICAgICAgIG5nID0gaWQ6IFwiZyN7KytsYXN0Z31cIiwgeDogeHwwLCB5OiB5fDAsIHR5cGU6IHNjb3BlLnR5cGVcbiAgICAgICAgY29uc29sZS5sb2cgJ2FkZCBnYWRnZXQnLCBuZyAjIFRPRE86IHNhdmUgdG8gc2VydmVyXG4gICAgICAgIHNjb3BlLmRhdGEuZ2FkZ2V0cy5wdXNoIG5nXG4gICAgICByZWRyYXcoKVxuXG5maW5kUGluID0gKG5hbWUsIGdkYXRhKSAtPlxuICBbZ2lkLHBuYW1lXSA9IG5hbWUuc3BsaXQgJy4nXG4gIGZvciBnIGluIGdkYXRhIHdoZW4gZ2lkIGlzIGcuaWRcbiAgICBmb3IgcCBpbiBnLmRlZi5waW5zIHdoZW4gcG5hbWUgaXMgcC5uYW1lXG4gICAgICAjIHJldmVyc2VzIHggYW5kIHkgYW5kIHVzZXMgcHJvamVjdGlvbiB0byBnZXQgaG9yaXpvbnRhbCBzcGxpbmVzXG4gICAgICByZXR1cm4geTogZy54ICsgcC54ICsgLjUsIHg6IGcueSArIHAueSArIC41LCBnOiBnLCBwOiBwXG5cbnByZXBhcmVEYXRhID0gKGdkZWZzLCBnZGF0YSkgLT5cbiAgIyBwcmUtY2FsY3VsYXRlIHNpemVzIGFuZCByZWxhdGl2ZSBwaW4gY29vcmRpbmF0ZXNcbiAgZm9yIG4sIGQgb2YgZ2RlZnNcbiAgICBkLm5hbWUgb3I9IG5cbiAgICBpbnMgPSAwXG4gICAgZm9yIHAgaW4gZC5waW5zXG4gICAgICBwLnggPSBkLndpZHRoIC8gMlxuICAgICAgaWYgcC5kaXIgaXMgJ2luJ1xuICAgICAgICBwLnggPSAtcC54XG4gICAgICAgICsraW5zXG4gICAgb3V0cyA9IGQucGlucy5sZW5ndGggLSBpbnNcbiAgICBzdGVwID0gMjBcbiAgICB5SW4gPSAtIChpbnMgLSAxKSAqIHN0ZXAgLyAyXG4gICAgeU91dCA9IC0gKG91dHMgLSAxKSAqIHN0ZXAgLyAyXG4gICAgZm9yIHAgaW4gZC5waW5zXG4gICAgICBpZiBwLmRpciBpcyAnaW4nXG4gICAgICAgIHAueSA9IHlJblxuICAgICAgICB5SW4gKz0gc3RlcFxuICAgICAgZWxzZVxuICAgICAgICBwLnkgPSB5T3V0XG4gICAgICAgIHlPdXQgKz0gc3RlcFxuICAgIGQuaGVpZ2h0ID0gNDAgKyBzdGVwICogKGlmIGlucyA+IG91dHMgdGhlbiBpbnMgZWxzZSBvdXRzKVxuXG4gIHNlcSA9IDAgIyBmaW5kIHRoZSBsYXJnZXN0IFwiZzxuPlwiIGlkIHRvIGhlbHAgZ2VuZXJhdGUgdGhlIG5leHQgb25lXG4gIGZvciBkIGluIGdkYXRhLmdhZGdldHNcbiAgICBpZiAvXmdcXGQrJC8udGVzdChkLmlkKVxuICAgICAgbiA9IGQuaWQuc2xpY2UoMSkgfCAwICMgZHJvcCB0aGUgbGVhZGluZyBcImdcIiBhbmQgY29udmVydCB0byBpbnRcbiAgICAgIHNlcSA9IG4gIGlmIG4gPiBzZXFcbiAgICBkLmRlZiA9IGdkZWZzW2QudHlwZV1cbiAgICBkLmh3ID0gZC5kZWYud2lkdGggLyAyXG4gICAgZC5oaCA9IGQuZGVmLmhlaWdodCAvIDJcblxuICBmb3IgZCBpbiBnZGF0YS53aXJlc1xuICAgIGQuc291cmNlID0gZmluZFBpbiBkLmZyb20sIGdkYXRhLmdhZGdldHNcbiAgICBkLnRhcmdldCA9IGZpbmRQaW4gZC50bywgZ2RhdGEuZ2FkZ2V0c1xuICAgIFxuICByZXR1cm4gc2VxXG4iXX0=
