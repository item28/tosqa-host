(function() {
  var ng,
    __slice = [].slice;

  ng = angular.module('myApp');

  ng.directive('jbCircuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        defs: '=',
        data: '='
      },
      link: function(scope, elem, attr) {
        var diag, dragInfo, dragWire, emit, findPin, gadgetDrag, gadgets, glist, pinDrag, prepareData, redraw, svg, wireUnderCursor, wires, wlist;
        console.log("khgfdfghfghfghghj");
        svg = d3.select(elem[0]).append('svg').attr({
          height: '60%'
        });
        diag = d3.svg.diagonal().projection(function(d) {
          return [d.y, d.x];
        });
        glist = wlist = gadgets = wires = null;
        emit = function() {
          var args;
          args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          return scope.$apply(function() {
            var _ref;
            return scope.$emit.apply(scope, [(_ref = attr.event) != null ? _ref : 'circuit'].concat(__slice.call(args)));
          });
        };
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          d3.event.sourceEvent.stopPropagation();
          return this.parentNode.appendChild(this);
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
          return wires.filter(function(w) {
            return w.source.id === d.id || w.target.id === d.id;
          }).each(function(d) {
            d.source = findPin(d.from);
            return d.target = findPin(d.to);
          }).attr({
            d: diag
          });
        }).on('dragend', function(d) {
          var g;
          g = scope.data.gadgets[d.id];
          if (!(g.x === d.x && g.y === d.y)) {
            return emit('moveGadget', d.id, d.x, d.y);
          }
        });
        dragInfo = {};
        dragWire = svg.append('path').datum(dragInfo).attr({
          id: 'drag'
        });
        wireUnderCursor = null;
        pinDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          d3.event.sourceEvent.stopPropagation();
          dragInfo.from = d.pin;
          delete dragInfo.to;
          return dragInfo.source = findPin(d.pin);
        }).on('drag', function(d) {
          var mx, my, orig, _ref;
          _ref = d3.mouse(this), mx = _ref[0], my = _ref[1];
          orig = dragInfo.source;
          dragInfo.target = {
            x: orig.x + my - d.y,
            y: orig.y + mx - d.x
          };
          return dragWire.attr({
            "class": 'drawing',
            fill: 'none',
            d: diag
          });
        }).on('dragend', function(d) {
          dragWire.classed('drawing', false);
          if (dragInfo.to && dragInfo.to !== dragInfo.from) {
            return emit('addWire', dragInfo.from, dragInfo.to);
          }
        });
        redraw = function() {
          var g, p, pins;
          prepareData();
          gadgets = svg.selectAll('.gadget').data(glist, function(d) {
            return d.id;
          });
          wires = svg.selectAll('.wire').data(wlist, function(d) {
            return d.id;
          });
          g = gadgets.enter().append('g').call(gadgetDrag).attr({
            "class": 'gadget'
          });
          g.append('rect').each(function(d) {
            return d3.select(this).attr({
              "class": 'outline',
              x: 0.5 - d.hw,
              y: 0.5 - d.hh,
              width: 2 * d.hw,
              height: 2 * d.hh
            });
          }).on('mousedown', function(d) {
            return emit('selectGadget', d.id);
          }).style({
            fill: function(d) {
              return d.def.shade;
            }
          });
          g.append('text').text(function(d) {
            return d.title || d.def.name;
          }).attr({
            "class": 'title',
            y: function(d) {
              return 12 - d.hh;
            }
          });
          g.append('text').text(function(d) {
            return "" + d.type + " - " + d.id;
          }).attr({
            "class": 'type',
            y: function(d) {
              return -4 + d.hh;
            }
          });
          g.append('text').text(function(d) {
            return d.def.icon;
          }).attr({
            "class": 'iconfont',
            x: 0,
            y: 0
          });
          g.append('text').text(function(d) {
            return '\uf014';
          }).attr({
            "class": 'iconfont',
            x: (function(d) {
              return d.hw - 8;
            }),
            y: (function(d) {
              return 8 - d.hh;
            })
          }).style({
            'font-size': '12px'
          }).on('mousedown', function(d) {
            d3.event.stopPropagation();
            return emit('delGadget', d.id);
          });
          gadgets.exit().remove();
          pins = gadgets.selectAll('.pin').data(function(d) {
            return d.pins;
          });
          p = pins.enter();
          p.append('circle').attr({
            "class": 'pin',
            cx: (function(d) {
              return d.x + .5;
            }),
            cy: (function(d) {
              return d.y + .5;
            }),
            r: 3
          });
          p.append('circle').call(pinDrag).attr({
            "class": 'hit',
            cx: (function(d) {
              return d.x + .5;
            }),
            cy: (function(d) {
              return d.y + .5;
            }),
            r: 7
          }).on('mouseup', function(d) {
            return dragInfo.to = d.pin;
          });
          p.append('text').text(function(d) {
            return d.name;
          }).attr({
            "class": function(d) {
              return d.dir;
            },
            x: function(d) {
              if (d.dir === 'in') {
                return d.x + 10;
              } else {
                return d.x - 10;
              }
            },
            y: function(d) {
              return d.y + 5;
            }
          });
          pins.exit().remove();
          wires.enter().insert('path', 'g').attr({
            "class": 'wire',
            fill: 'none',
            d: diag
          }).on('mouseenter', function(d) {
            return wireUnderCursor = d;
          }).on('mouseleave', function(d) {
            return wireUnderCursor = null;
          });
          wires.exit().remove();
          return gadgets.attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
        };
        svg.on('mousedown', function() {
          var x, y, _ref;
          if (wireUnderCursor) {
            return emit('delWire', wireUnderCursor.from, wireUnderCursor.to);
          } else {
            _ref = d3.mouse(this), x = _ref[0], y = _ref[1];
            return emit('addGadget', x | 0, y | 0);
          }
        });
        findPin = function(pin) {
          var g, gid, p, pname, _i, _j, _len, _len1, _ref, _ref1;
          _ref = pin.split('.'), gid = _ref[0], pname = _ref[1];
          for (_i = 0, _len = glist.length; _i < _len; _i++) {
            g = glist[_i];
            if (gid === g.id) {
              _ref1 = g.pins;
              for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
                p = _ref1[_j];
                if (pname === p.name) {
                  return {
                    y: g.x + p.x + .5,
                    x: g.y + p.y + .5,
                    id: gid
                  };
                }
              }
            }
          }
        };
        prepareData = function() {
          var cap, def, from, g, height, hh, hw, id, ins, outs, pins, placePins, source, target, title, to, type, width, x, y, ystep;
          ystep = 20;
          width = 140;
          glist = (function() {
            var _ref, _results;
            _ref = scope.data.gadgets;
            _results = [];
            for (id in _ref) {
              g = _ref[id];
              x = g.x, y = g.y, title = g.title, type = g.type;
              def = scope.defs[type];
              pins = [];
              placePins = function(pnames, dir, xi) {
                var name, nlist, yi, _i, _len;
                nlist = pnames ? pnames.split(' ') : [];
                yi = -ystep * (nlist.length - 1) >> 1;
                for (_i = 0, _len = nlist.length; _i < _len; _i++) {
                  name = nlist[_i];
                  pins.push({
                    x: xi,
                    y: yi,
                    name: name,
                    dir: dir,
                    pin: "" + id + "." + name
                  });
                  yi += ystep;
                }
                return nlist.length;
              };
              hw = width / 2;
              ins = placePins(def.inputs, 'in', -hw);
              outs = placePins(def.outputs, 'out', hw);
              height = 40 + ystep * (ins > outs ? ins : outs);
              hh = height / 2;
              _results.push({
                id: id,
                x: x,
                y: y,
                title: title,
                type: type,
                def: def,
                pins: pins,
                hw: hw,
                hh: hh,
                height: height
              });
            }
            return _results;
          })();
          return wlist = (function() {
            var _ref, _ref1, _results;
            _ref = scope.data.wires;
            _results = [];
            for (id in _ref) {
              cap = _ref[id];
              _ref1 = id.split('/'), from = _ref1[0], to = _ref1[1];
              source = findPin(from);
              target = findPin(to);
              _results.push({
                id: id,
                from: from,
                to: to,
                source: source,
                target: target,
                cap: cap
              });
            }
            return _results;
          })();
        };
        scope.$watch("data", (function() {
          console.log("hahahhahahahahh");
          return redraw();
        }), true);
        return redraw();
      }
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSxFQUFBO0lBQUEsa0JBQUE7O0FBQUEsRUFBQSxFQUFBLEdBQUssT0FBTyxDQUFDLE1BQVIsQ0FBZSxPQUFmLENBQUwsQ0FBQTs7QUFBQSxFQUVBLEVBQUUsQ0FBQyxTQUFILENBQWEsaUJBQWIsRUFBZ0MsU0FBQSxHQUFBO1dBQzlCO0FBQUEsTUFBQSxRQUFBLEVBQVUsR0FBVjtBQUFBLE1BRUEsS0FBQSxFQUNFO0FBQUEsUUFBQSxJQUFBLEVBQU0sR0FBTjtBQUFBLFFBQ0EsSUFBQSxFQUFNLEdBRE47T0FIRjtBQUFBLE1BTUEsSUFBQSxFQUFNLFNBQUMsS0FBRCxFQUFRLElBQVIsRUFBYyxJQUFkLEdBQUE7QUFDSixZQUFBLHFJQUFBO0FBQUEsUUFBQSxPQUFPLENBQUMsR0FBUixDQUFZLG1CQUFaLENBQUEsQ0FBQTtBQUFBLFFBRUEsR0FBQSxHQUFNLEVBQUUsQ0FBQyxNQUFILENBQVUsSUFBSyxDQUFBLENBQUEsQ0FBZixDQUFrQixDQUFDLE1BQW5CLENBQTBCLEtBQTFCLENBQ0osQ0FBQyxJQURHLENBQ0U7QUFBQSxVQUFBLE1BQUEsRUFBUSxLQUFSO1NBREYsQ0FGTixDQUFBO0FBQUEsUUFJQSxJQUFBLEdBQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFQLENBQUEsQ0FDTCxDQUFDLFVBREksQ0FDTyxTQUFDLENBQUQsR0FBQTtpQkFBTyxDQUFDLENBQUMsQ0FBQyxDQUFILEVBQU0sQ0FBQyxDQUFDLENBQVIsRUFBUDtRQUFBLENBRFAsQ0FKUCxDQUFBO0FBQUEsUUFPQSxLQUFBLEdBQVEsS0FBQSxHQUFRLE9BQUEsR0FBVSxLQUFBLEdBQVEsSUFQbEMsQ0FBQTtBQUFBLFFBU0EsSUFBQSxHQUFPLFNBQUEsR0FBQTtBQUVMLGNBQUEsSUFBQTtBQUFBLFVBRk0sOERBRU4sQ0FBQTtpQkFBQSxLQUFLLENBQUMsTUFBTixDQUFhLFNBQUEsR0FBQTtBQUFHLGdCQUFBLElBQUE7bUJBQUEsS0FBSyxDQUFDLEtBQU4sY0FBWSxzQ0FBYSxTQUFXLFNBQUEsYUFBQSxJQUFBLENBQUEsQ0FBcEMsRUFBSDtVQUFBLENBQWIsRUFGSztRQUFBLENBVFAsQ0FBQTtBQUFBLFFBYUEsVUFBQSxHQUFhLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBWixDQUFBLENBQ1gsQ0FBQyxNQURVLENBQ0gsTUFERyxDQUVYLENBQUMsRUFGVSxDQUVQLFdBRk8sRUFFTSxTQUFDLENBQUQsR0FBQTtBQUNmLFVBQUEsRUFBRSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsZUFBckIsQ0FBQSxDQUFBLENBQUE7aUJBQ0EsSUFBQyxDQUFBLFVBQVUsQ0FBQyxXQUFaLENBQXdCLElBQXhCLEVBRmU7UUFBQSxDQUZOLENBS1gsQ0FBQyxFQUxVLENBS1AsTUFMTyxFQUtDLFNBQUMsQ0FBRCxHQUFBO0FBQ1YsVUFBQSxDQUFDLENBQUMsQ0FBRixHQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBVCxHQUFhLENBQW5CLENBQUE7QUFBQSxVQUNBLENBQUMsQ0FBQyxDQUFGLEdBQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFULEdBQWEsQ0FEbkIsQ0FBQTtBQUFBLFVBRUEsRUFBRSxDQUFDLE1BQUgsQ0FBVSxJQUFWLENBQVksQ0FBQyxJQUFiLENBQWtCO0FBQUEsWUFBQSxTQUFBLEVBQVcsU0FBQyxDQUFELEdBQUE7cUJBQVEsWUFBQSxHQUFXLENBQUMsQ0FBQyxDQUFiLEdBQWdCLEdBQWhCLEdBQWtCLENBQUMsQ0FBQyxDQUFwQixHQUF1QixJQUEvQjtZQUFBLENBQVg7V0FBbEIsQ0FGQSxDQUFBO2lCQUlBLEtBQUssQ0FBQyxNQUFOLENBQWEsU0FBQyxDQUFELEdBQUE7bUJBQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFULEtBQWUsQ0FBQyxDQUFDLEVBQWpCLElBQXVCLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBVCxLQUFlLENBQUMsQ0FBQyxHQUEvQztVQUFBLENBQWIsQ0FDRSxDQUFDLElBREgsQ0FDUSxTQUFDLENBQUQsR0FBQTtBQUNKLFlBQUEsQ0FBQyxDQUFDLE1BQUYsR0FBVyxPQUFBLENBQVEsQ0FBQyxDQUFDLElBQVYsQ0FBWCxDQUFBO21CQUNBLENBQUMsQ0FBQyxNQUFGLEdBQVcsT0FBQSxDQUFRLENBQUMsQ0FBQyxFQUFWLEVBRlA7VUFBQSxDQURSLENBSUUsQ0FBQyxJQUpILENBSVE7QUFBQSxZQUFBLENBQUEsRUFBRyxJQUFIO1dBSlIsRUFMVTtRQUFBLENBTEQsQ0FlWCxDQUFDLEVBZlUsQ0FlUCxTQWZPLEVBZUksU0FBQyxDQUFELEdBQUE7QUFDYixjQUFBLENBQUE7QUFBQSxVQUFBLENBQUEsR0FBSSxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQVEsQ0FBQSxDQUFDLENBQUMsRUFBRixDQUF2QixDQUFBO0FBQ0EsVUFBQSxJQUFBLENBQUEsQ0FBTyxDQUFDLENBQUMsQ0FBRixLQUFPLENBQUMsQ0FBQyxDQUFULElBQWUsQ0FBQyxDQUFDLENBQUYsS0FBTyxDQUFDLENBQUMsQ0FBL0IsQ0FBQTttQkFDRSxJQUFBLENBQUssWUFBTCxFQUFtQixDQUFDLENBQUMsRUFBckIsRUFBeUIsQ0FBQyxDQUFDLENBQTNCLEVBQThCLENBQUMsQ0FBQyxDQUFoQyxFQURGO1dBRmE7UUFBQSxDQWZKLENBYmIsQ0FBQTtBQUFBLFFBaUNBLFFBQUEsR0FBVyxFQWpDWCxDQUFBO0FBQUEsUUFrQ0EsUUFBQSxHQUFXLEdBQUcsQ0FBQyxNQUFKLENBQVcsTUFBWCxDQUFrQixDQUFDLEtBQW5CLENBQXlCLFFBQXpCLENBQWtDLENBQUMsSUFBbkMsQ0FBd0M7QUFBQSxVQUFBLEVBQUEsRUFBSSxNQUFKO1NBQXhDLENBbENYLENBQUE7QUFBQSxRQW1DQSxlQUFBLEdBQWtCLElBbkNsQixDQUFBO0FBQUEsUUFxQ0EsT0FBQSxHQUFVLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBWixDQUFBLENBQ1IsQ0FBQyxNQURPLENBQ0EsTUFEQSxDQUVSLENBQUMsRUFGTyxDQUVKLFdBRkksRUFFUyxTQUFDLENBQUQsR0FBQTtBQUNmLFVBQUEsRUFBRSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsZUFBckIsQ0FBQSxDQUFBLENBQUE7QUFBQSxVQUNBLFFBQVEsQ0FBQyxJQUFULEdBQWdCLENBQUMsQ0FBQyxHQURsQixDQUFBO0FBQUEsVUFFQSxNQUFBLENBQUEsUUFBZSxDQUFDLEVBRmhCLENBQUE7aUJBR0EsUUFBUSxDQUFDLE1BQVQsR0FBa0IsT0FBQSxDQUFRLENBQUMsQ0FBQyxHQUFWLEVBSkg7UUFBQSxDQUZULENBT1IsQ0FBQyxFQVBPLENBT0osTUFQSSxFQU9JLFNBQUMsQ0FBRCxHQUFBO0FBQ1YsY0FBQSxrQkFBQTtBQUFBLFVBQUEsT0FBVSxFQUFFLENBQUMsS0FBSCxDQUFTLElBQVQsQ0FBVixFQUFDLFlBQUQsRUFBSSxZQUFKLENBQUE7QUFBQSxVQUNBLElBQUEsR0FBTyxRQUFRLENBQUMsTUFEaEIsQ0FBQTtBQUFBLFVBRUEsUUFBUSxDQUFDLE1BQVQsR0FBa0I7QUFBQSxZQUFBLENBQUEsRUFBRyxJQUFJLENBQUMsQ0FBTCxHQUFPLEVBQVAsR0FBVSxDQUFDLENBQUMsQ0FBZjtBQUFBLFlBQWtCLENBQUEsRUFBRyxJQUFJLENBQUMsQ0FBTCxHQUFPLEVBQVAsR0FBVSxDQUFDLENBQUMsQ0FBakM7V0FGbEIsQ0FBQTtpQkFHQSxRQUFRLENBQUMsSUFBVCxDQUFjO0FBQUEsWUFBQSxPQUFBLEVBQU8sU0FBUDtBQUFBLFlBQWtCLElBQUEsRUFBTSxNQUF4QjtBQUFBLFlBQWdDLENBQUEsRUFBRyxJQUFuQztXQUFkLEVBSlU7UUFBQSxDQVBKLENBWVIsQ0FBQyxFQVpPLENBWUosU0FaSSxFQVlPLFNBQUMsQ0FBRCxHQUFBO0FBQ2IsVUFBQSxRQUFRLENBQUMsT0FBVCxDQUFpQixTQUFqQixFQUE0QixLQUE1QixDQUFBLENBQUE7QUFDQSxVQUFBLElBQUcsUUFBUSxDQUFDLEVBQVQsSUFBZ0IsUUFBUSxDQUFDLEVBQVQsS0FBaUIsUUFBUSxDQUFDLElBQTdDO21CQUNFLElBQUEsQ0FBSyxTQUFMLEVBQWdCLFFBQVEsQ0FBQyxJQUF6QixFQUErQixRQUFRLENBQUMsRUFBeEMsRUFERjtXQUZhO1FBQUEsQ0FaUCxDQXJDVixDQUFBO0FBQUEsUUFzREEsTUFBQSxHQUFTLFNBQUEsR0FBQTtBQUNQLGNBQUEsVUFBQTtBQUFBLFVBQUEsV0FBQSxDQUFBLENBQUEsQ0FBQTtBQUFBLFVBRUEsT0FBQSxHQUFVLEdBQUcsQ0FBQyxTQUFKLENBQWMsU0FBZCxDQUF3QixDQUFDLElBQXpCLENBQThCLEtBQTlCLEVBQXFDLFNBQUMsQ0FBRCxHQUFBO21CQUFPLENBQUMsQ0FBQyxHQUFUO1VBQUEsQ0FBckMsQ0FGVixDQUFBO0FBQUEsVUFHQSxLQUFBLEdBQVEsR0FBRyxDQUFDLFNBQUosQ0FBYyxPQUFkLENBQXNCLENBQUMsSUFBdkIsQ0FBNEIsS0FBNUIsRUFBbUMsU0FBQyxDQUFELEdBQUE7bUJBQU8sQ0FBQyxDQUFDLEdBQVQ7VUFBQSxDQUFuQyxDQUhSLENBQUE7QUFBQSxVQUtBLENBQUEsR0FBSSxPQUFPLENBQUMsS0FBUixDQUFBLENBQWUsQ0FBQyxNQUFoQixDQUF1QixHQUF2QixDQUEyQixDQUFDLElBQTVCLENBQWlDLFVBQWpDLENBQ0YsQ0FBQyxJQURDLENBQ0k7QUFBQSxZQUFBLE9BQUEsRUFBTyxRQUFQO1dBREosQ0FMSixDQUFBO0FBQUEsVUFPQSxDQUFDLENBQUMsTUFBRixDQUFTLE1BQVQsQ0FDRSxDQUFDLElBREgsQ0FDUSxTQUFDLENBQUQsR0FBQTttQkFDSixFQUFFLENBQUMsTUFBSCxDQUFVLElBQVYsQ0FBWSxDQUFDLElBQWIsQ0FDRTtBQUFBLGNBQUEsT0FBQSxFQUFPLFNBQVA7QUFBQSxjQUVBLENBQUEsRUFBRyxHQUFBLEdBQU0sQ0FBQyxDQUFDLEVBRlg7QUFBQSxjQUVlLENBQUEsRUFBRyxHQUFBLEdBQU0sQ0FBQyxDQUFDLEVBRjFCO0FBQUEsY0FHQSxLQUFBLEVBQU8sQ0FBQSxHQUFJLENBQUMsQ0FBQyxFQUhiO0FBQUEsY0FHaUIsTUFBQSxFQUFRLENBQUEsR0FBSSxDQUFDLENBQUMsRUFIL0I7YUFERixFQURJO1VBQUEsQ0FEUixDQU9FLENBQUMsRUFQSCxDQU9NLFdBUE4sRUFPbUIsU0FBQyxDQUFELEdBQUE7bUJBQU8sSUFBQSxDQUFLLGNBQUwsRUFBcUIsQ0FBQyxDQUFDLEVBQXZCLEVBQVA7VUFBQSxDQVBuQixDQVFFLENBQUMsS0FSSCxDQVFTO0FBQUEsWUFBQSxJQUFBLEVBQU0sU0FBQyxDQUFELEdBQUE7cUJBQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFiO1lBQUEsQ0FBTjtXQVJULENBUEEsQ0FBQTtBQUFBLFVBZ0JBLENBQUMsQ0FBQyxNQUFGLENBQVMsTUFBVCxDQUFnQixDQUFDLElBQWpCLENBQXNCLFNBQUMsQ0FBRCxHQUFBO21CQUFPLENBQUMsQ0FBQyxLQUFGLElBQVcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUF4QjtVQUFBLENBQXRCLENBQ0UsQ0FBQyxJQURILENBQ1E7QUFBQSxZQUFBLE9BQUEsRUFBTyxPQUFQO0FBQUEsWUFBZ0IsQ0FBQSxFQUFHLFNBQUMsQ0FBRCxHQUFBO3FCQUFPLEVBQUEsR0FBSyxDQUFDLENBQUMsR0FBZDtZQUFBLENBQW5CO1dBRFIsQ0FoQkEsQ0FBQTtBQUFBLFVBa0JBLENBQUMsQ0FBQyxNQUFGLENBQVMsTUFBVCxDQUFnQixDQUFDLElBQWpCLENBQXNCLFNBQUMsQ0FBRCxHQUFBO21CQUFPLEVBQUEsR0FBRSxDQUFDLENBQUMsSUFBSixHQUFVLEtBQVYsR0FBYyxDQUFDLENBQUMsR0FBdkI7VUFBQSxDQUF0QixDQUNFLENBQUMsSUFESCxDQUNRO0FBQUEsWUFBQSxPQUFBLEVBQU8sTUFBUDtBQUFBLFlBQWUsQ0FBQSxFQUFHLFNBQUMsQ0FBRCxHQUFBO3FCQUFPLENBQUEsQ0FBQSxHQUFLLENBQUMsQ0FBQyxHQUFkO1lBQUEsQ0FBbEI7V0FEUixDQWxCQSxDQUFBO0FBQUEsVUFvQkEsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxNQUFULENBQWdCLENBQUMsSUFBakIsQ0FBc0IsU0FBQyxDQUFELEdBQUE7bUJBQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFiO1VBQUEsQ0FBdEIsQ0FDRSxDQUFDLElBREgsQ0FDUTtBQUFBLFlBQUEsT0FBQSxFQUFPLFVBQVA7QUFBQSxZQUFtQixDQUFBLEVBQUcsQ0FBdEI7QUFBQSxZQUF5QixDQUFBLEVBQUcsQ0FBNUI7V0FEUixDQXBCQSxDQUFBO0FBQUEsVUFzQkEsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxNQUFULENBQWdCLENBQUMsSUFBakIsQ0FBc0IsU0FBQyxDQUFELEdBQUE7bUJBQU8sU0FBUDtVQUFBLENBQXRCLENBQ0UsQ0FBQyxJQURILENBQ1E7QUFBQSxZQUFBLE9BQUEsRUFBTyxVQUFQO0FBQUEsWUFBbUIsQ0FBQSxFQUFHLENBQUMsU0FBQyxDQUFELEdBQUE7cUJBQU8sQ0FBQyxDQUFDLEVBQUYsR0FBSyxFQUFaO1lBQUEsQ0FBRCxDQUF0QjtBQUFBLFlBQXVDLENBQUEsRUFBRyxDQUFDLFNBQUMsQ0FBRCxHQUFBO3FCQUFPLENBQUEsR0FBRSxDQUFDLENBQUMsR0FBWDtZQUFBLENBQUQsQ0FBMUM7V0FEUixDQUVFLENBQUMsS0FGSCxDQUVTO0FBQUEsWUFBQSxXQUFBLEVBQWEsTUFBYjtXQUZULENBR0UsQ0FBQyxFQUhILENBR00sV0FITixFQUdtQixTQUFDLENBQUQsR0FBQTtBQUNmLFlBQUEsRUFBRSxDQUFDLEtBQUssQ0FBQyxlQUFULENBQUEsQ0FBQSxDQUFBO21CQUNBLElBQUEsQ0FBSyxXQUFMLEVBQWtCLENBQUMsQ0FBQyxFQUFwQixFQUZlO1VBQUEsQ0FIbkIsQ0F0QkEsQ0FBQTtBQUFBLFVBNEJBLE9BQU8sQ0FBQyxJQUFSLENBQUEsQ0FBYyxDQUFDLE1BQWYsQ0FBQSxDQTVCQSxDQUFBO0FBQUEsVUE4QkEsSUFBQSxHQUFPLE9BQU8sQ0FBQyxTQUFSLENBQWtCLE1BQWxCLENBQXlCLENBQUMsSUFBMUIsQ0FBK0IsU0FBQyxDQUFELEdBQUE7bUJBQU8sQ0FBQyxDQUFDLEtBQVQ7VUFBQSxDQUEvQixDQTlCUCxDQUFBO0FBQUEsVUErQkEsQ0FBQSxHQUFJLElBQUksQ0FBQyxLQUFMLENBQUEsQ0EvQkosQ0FBQTtBQUFBLFVBZ0NBLENBQUMsQ0FBQyxNQUFGLENBQVMsUUFBVCxDQUNFLENBQUMsSUFESCxDQUNRO0FBQUEsWUFBQSxPQUFBLEVBQU8sS0FBUDtBQUFBLFlBQWMsRUFBQSxFQUFJLENBQUMsU0FBQyxDQUFELEdBQUE7cUJBQU8sQ0FBQyxDQUFDLENBQUYsR0FBSSxHQUFYO1lBQUEsQ0FBRCxDQUFsQjtBQUFBLFlBQW1DLEVBQUEsRUFBSSxDQUFDLFNBQUMsQ0FBRCxHQUFBO3FCQUFPLENBQUMsQ0FBQyxDQUFGLEdBQUksR0FBWDtZQUFBLENBQUQsQ0FBdkM7QUFBQSxZQUF3RCxDQUFBLEVBQUcsQ0FBM0Q7V0FEUixDQWhDQSxDQUFBO0FBQUEsVUFrQ0EsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxRQUFULENBQWtCLENBQUMsSUFBbkIsQ0FBd0IsT0FBeEIsQ0FDRSxDQUFDLElBREgsQ0FDUTtBQUFBLFlBQUEsT0FBQSxFQUFPLEtBQVA7QUFBQSxZQUFjLEVBQUEsRUFBSSxDQUFDLFNBQUMsQ0FBRCxHQUFBO3FCQUFPLENBQUMsQ0FBQyxDQUFGLEdBQUksR0FBWDtZQUFBLENBQUQsQ0FBbEI7QUFBQSxZQUFtQyxFQUFBLEVBQUksQ0FBQyxTQUFDLENBQUQsR0FBQTtxQkFBTyxDQUFDLENBQUMsQ0FBRixHQUFJLEdBQVg7WUFBQSxDQUFELENBQXZDO0FBQUEsWUFBd0QsQ0FBQSxFQUFHLENBQTNEO1dBRFIsQ0FFRSxDQUFDLEVBRkgsQ0FFTSxTQUZOLEVBRWlCLFNBQUMsQ0FBRCxHQUFBO21CQUFPLFFBQVEsQ0FBQyxFQUFULEdBQWMsQ0FBQyxDQUFDLElBQXZCO1VBQUEsQ0FGakIsQ0FsQ0EsQ0FBQTtBQUFBLFVBcUNBLENBQUMsQ0FBQyxNQUFGLENBQVMsTUFBVCxDQUFnQixDQUFDLElBQWpCLENBQXNCLFNBQUMsQ0FBRCxHQUFBO21CQUFPLENBQUMsQ0FBQyxLQUFUO1VBQUEsQ0FBdEIsQ0FDRSxDQUFDLElBREgsQ0FFSTtBQUFBLFlBQUEsT0FBQSxFQUFPLFNBQUMsQ0FBRCxHQUFBO3FCQUFPLENBQUMsQ0FBQyxJQUFUO1lBQUEsQ0FBUDtBQUFBLFlBQ0EsQ0FBQSxFQUFHLFNBQUMsQ0FBRCxHQUFBO0FBQU8sY0FBQSxJQUFHLENBQUMsQ0FBQyxHQUFGLEtBQVMsSUFBWjt1QkFBc0IsQ0FBQyxDQUFDLENBQUYsR0FBTSxHQUE1QjtlQUFBLE1BQUE7dUJBQW9DLENBQUMsQ0FBQyxDQUFGLEdBQU0sR0FBMUM7ZUFBUDtZQUFBLENBREg7QUFBQSxZQUVBLENBQUEsRUFBRyxTQUFDLENBQUQsR0FBQTtxQkFBTyxDQUFDLENBQUMsQ0FBRixHQUFNLEVBQWI7WUFBQSxDQUZIO1dBRkosQ0FyQ0EsQ0FBQTtBQUFBLFVBMENBLElBQUksQ0FBQyxJQUFMLENBQUEsQ0FBVyxDQUFDLE1BQVosQ0FBQSxDQTFDQSxDQUFBO0FBQUEsVUE0Q0EsS0FBSyxDQUFDLEtBQU4sQ0FBQSxDQUFhLENBQUMsTUFBZCxDQUFxQixNQUFyQixFQUE2QixHQUE3QixDQUNFLENBQUMsSUFESCxDQUNRO0FBQUEsWUFBQSxPQUFBLEVBQU8sTUFBUDtBQUFBLFlBQWUsSUFBQSxFQUFNLE1BQXJCO0FBQUEsWUFBNkIsQ0FBQSxFQUFHLElBQWhDO1dBRFIsQ0FJRSxDQUFDLEVBSkgsQ0FJTSxZQUpOLEVBSW9CLFNBQUMsQ0FBRCxHQUFBO21CQUFPLGVBQUEsR0FBa0IsRUFBekI7VUFBQSxDQUpwQixDQUtFLENBQUMsRUFMSCxDQUtNLFlBTE4sRUFLb0IsU0FBQyxDQUFELEdBQUE7bUJBQU8sZUFBQSxHQUFrQixLQUF6QjtVQUFBLENBTHBCLENBNUNBLENBQUE7QUFBQSxVQWtEQSxLQUFLLENBQUMsSUFBTixDQUFBLENBQVksQ0FBQyxNQUFiLENBQUEsQ0FsREEsQ0FBQTtpQkFvREEsT0FBTyxDQUFDLElBQVIsQ0FBYTtBQUFBLFlBQUEsU0FBQSxFQUFXLFNBQUMsQ0FBRCxHQUFBO3FCQUFRLFlBQUEsR0FBVyxDQUFDLENBQUMsQ0FBYixHQUFnQixHQUFoQixHQUFrQixDQUFDLENBQUMsQ0FBcEIsR0FBdUIsSUFBL0I7WUFBQSxDQUFYO1dBQWIsRUFyRE87UUFBQSxDQXREVCxDQUFBO0FBQUEsUUE2R0EsR0FBRyxDQUFDLEVBQUosQ0FBTyxXQUFQLEVBQW9CLFNBQUEsR0FBQTtBQUVsQixjQUFBLFVBQUE7QUFBQSxVQUFBLElBQUcsZUFBSDttQkFDRSxJQUFBLENBQUssU0FBTCxFQUFnQixlQUFlLENBQUMsSUFBaEMsRUFBc0MsZUFBZSxDQUFDLEVBQXRELEVBREY7V0FBQSxNQUFBO0FBSUUsWUFBQSxPQUFRLEVBQUUsQ0FBQyxLQUFILENBQVMsSUFBVCxDQUFSLEVBQUMsV0FBRCxFQUFHLFdBQUgsQ0FBQTttQkFDQSxJQUFBLENBQUssV0FBTCxFQUFrQixDQUFBLEdBQUUsQ0FBcEIsRUFBdUIsQ0FBQSxHQUFFLENBQXpCLEVBTEY7V0FGa0I7UUFBQSxDQUFwQixDQTdHQSxDQUFBO0FBQUEsUUFzSEEsT0FBQSxHQUFVLFNBQUMsR0FBRCxHQUFBO0FBQ1IsY0FBQSxrREFBQTtBQUFBLFVBQUEsT0FBYyxHQUFHLENBQUMsS0FBSixDQUFVLEdBQVYsQ0FBZCxFQUFDLGFBQUQsRUFBSyxlQUFMLENBQUE7QUFDQSxlQUFBLDRDQUFBOzBCQUFBO2dCQUFvQixHQUFBLEtBQU8sQ0FBQyxDQUFDO0FBQzNCO0FBQUEsbUJBQUEsOENBQUE7OEJBQUE7b0JBQXFCLEtBQUEsS0FBUyxDQUFDLENBQUM7QUFFOUIseUJBQU87QUFBQSxvQkFBQSxDQUFBLEVBQUcsQ0FBQyxDQUFDLENBQUYsR0FBTSxDQUFDLENBQUMsQ0FBUixHQUFZLEVBQWY7QUFBQSxvQkFBbUIsQ0FBQSxFQUFHLENBQUMsQ0FBQyxDQUFGLEdBQU0sQ0FBQyxDQUFDLENBQVIsR0FBWSxFQUFsQztBQUFBLG9CQUFzQyxFQUFBLEVBQUksR0FBMUM7bUJBQVA7aUJBRkY7QUFBQTthQURGO0FBQUEsV0FGUTtRQUFBLENBdEhWLENBQUE7QUFBQSxRQTZIQSxXQUFBLEdBQWMsU0FBQSxHQUFBO0FBQ1osY0FBQSxzSEFBQTtBQUFBLFVBQUEsS0FBQSxHQUFRLEVBQVIsQ0FBQTtBQUFBLFVBQ0EsS0FBQSxHQUFRLEdBRFIsQ0FBQTtBQUFBLFVBSUEsS0FBQTs7QUFBUTtBQUFBO2lCQUFBLFVBQUE7MkJBQUE7QUFDTixjQUFDLE1BQUEsQ0FBRCxFQUFHLE1BQUEsQ0FBSCxFQUFLLFVBQUEsS0FBTCxFQUFXLFNBQUEsSUFBWCxDQUFBO0FBQUEsY0FDQSxHQUFBLEdBQU0sS0FBSyxDQUFDLElBQUssQ0FBQSxJQUFBLENBRGpCLENBQUE7QUFBQSxjQUVBLElBQUEsR0FBTyxFQUZQLENBQUE7QUFBQSxjQUdBLFNBQUEsR0FBWSxTQUFDLE1BQUQsRUFBUyxHQUFULEVBQWMsRUFBZCxHQUFBO0FBQ1Ysb0JBQUEseUJBQUE7QUFBQSxnQkFBQSxLQUFBLEdBQVcsTUFBSCxHQUFlLE1BQU0sQ0FBQyxLQUFQLENBQWEsR0FBYixDQUFmLEdBQXFDLEVBQTdDLENBQUE7QUFBQSxnQkFDQSxFQUFBLEdBQUssQ0FBQSxLQUFBLEdBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTixHQUFlLENBQWhCLENBQVQsSUFBK0IsQ0FEcEMsQ0FBQTtBQUVBLHFCQUFBLDRDQUFBO21DQUFBO0FBQ0Usa0JBQUEsSUFBSSxDQUFDLElBQUwsQ0FBVTtBQUFBLG9CQUFFLENBQUEsRUFBRyxFQUFMO0FBQUEsb0JBQVMsQ0FBQSxFQUFHLEVBQVo7QUFBQSxvQkFBZ0IsTUFBQSxJQUFoQjtBQUFBLG9CQUFzQixLQUFBLEdBQXRCO0FBQUEsb0JBQTJCLEdBQUEsRUFBSyxFQUFBLEdBQUUsRUFBRixHQUFNLEdBQU4sR0FBUSxJQUF4QzttQkFBVixDQUFBLENBQUE7QUFBQSxrQkFDQSxFQUFBLElBQU0sS0FETixDQURGO0FBQUEsaUJBRkE7dUJBS0EsS0FBSyxDQUFDLE9BTkk7Y0FBQSxDQUhaLENBQUE7QUFBQSxjQVVBLEVBQUEsR0FBSyxLQUFBLEdBQVEsQ0FWYixDQUFBO0FBQUEsY0FXQSxHQUFBLEdBQU0sU0FBQSxDQUFVLEdBQUcsQ0FBQyxNQUFkLEVBQXNCLElBQXRCLEVBQTRCLENBQUEsRUFBNUIsQ0FYTixDQUFBO0FBQUEsY0FZQSxJQUFBLEdBQU8sU0FBQSxDQUFVLEdBQUcsQ0FBQyxPQUFkLEVBQXVCLEtBQXZCLEVBQThCLEVBQTlCLENBWlAsQ0FBQTtBQUFBLGNBYUEsTUFBQSxHQUFTLEVBQUEsR0FBSyxLQUFBLEdBQVEsQ0FBSSxHQUFBLEdBQU0sSUFBVCxHQUFtQixHQUFuQixHQUE0QixJQUE3QixDQWJ0QixDQUFBO0FBQUEsY0FjQSxFQUFBLEdBQUssTUFBQSxHQUFTLENBZGQsQ0FBQTtBQUFBLDRCQWVBO0FBQUEsZ0JBQUUsSUFBQSxFQUFGO0FBQUEsZ0JBQU0sR0FBQSxDQUFOO0FBQUEsZ0JBQVMsR0FBQSxDQUFUO0FBQUEsZ0JBQVksT0FBQSxLQUFaO0FBQUEsZ0JBQW1CLE1BQUEsSUFBbkI7QUFBQSxnQkFBeUIsS0FBQSxHQUF6QjtBQUFBLGdCQUE4QixNQUFBLElBQTlCO0FBQUEsZ0JBQW9DLElBQUEsRUFBcEM7QUFBQSxnQkFBd0MsSUFBQSxFQUF4QztBQUFBLGdCQUE0QyxRQUFBLE1BQTVDO2dCQWZBLENBRE07QUFBQTs7Y0FKUixDQUFBO2lCQXVCQSxLQUFBOztBQUFRO0FBQUE7aUJBQUEsVUFBQTs2QkFBQTtBQUNOLGNBQUEsUUFBWSxFQUFFLENBQUMsS0FBSCxDQUFTLEdBQVQsQ0FBWixFQUFDLGVBQUQsRUFBTSxhQUFOLENBQUE7QUFBQSxjQUNBLE1BQUEsR0FBUyxPQUFBLENBQVEsSUFBUixDQURULENBQUE7QUFBQSxjQUVBLE1BQUEsR0FBUyxPQUFBLENBQVEsRUFBUixDQUZULENBQUE7QUFBQSw0QkFHQTtBQUFBLGdCQUFFLElBQUEsRUFBRjtBQUFBLGdCQUFNLE1BQUEsSUFBTjtBQUFBLGdCQUFZLElBQUEsRUFBWjtBQUFBLGdCQUFnQixRQUFBLE1BQWhCO0FBQUEsZ0JBQXdCLFFBQUEsTUFBeEI7QUFBQSxnQkFBZ0MsS0FBQSxHQUFoQztnQkFIQSxDQURNO0FBQUE7O2VBeEJJO1FBQUEsQ0E3SGQsQ0FBQTtBQUFBLFFBMkpBLEtBQUssQ0FBQyxNQUFOLENBQWEsTUFBYixFQUFxQixDQUFDLFNBQUEsR0FBQTtBQUNwQixVQUFBLE9BQU8sQ0FBQyxHQUFSLENBQVksaUJBQVosQ0FBQSxDQUFBO2lCQUNBLE1BQUEsQ0FBQSxFQUZvQjtRQUFBLENBQUQsQ0FBckIsRUFHRyxJQUhILENBM0pBLENBQUE7ZUFnS0EsTUFBQSxDQUFBLEVBaktJO01BQUEsQ0FOTjtNQUQ4QjtFQUFBLENBQWhDLENBRkEsQ0FBQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsibmcgPSBhbmd1bGFyLm1vZHVsZSAnbXlBcHAnXG5cbm5nLmRpcmVjdGl2ZSAnamJDaXJjdWl0RWRpdG9yJywgLT5cbiAgcmVzdHJpY3Q6ICdFJ1xuICBcbiAgc2NvcGU6XG4gICAgZGVmczogJz0nXG4gICAgZGF0YTogJz0nXG4gICAgXG4gIGxpbms6IChzY29wZSwgZWxlbSwgYXR0cikgLT5cbiAgICBjb25zb2xlLmxvZyBcImtoZ2ZkZmdoZmdoZmdoZ2hqXCJcbiAgXG4gICAgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZCAnc3ZnJ1xuICAgICAgLmF0dHIgaGVpZ2h0OiAnNjAlJ1xuICAgIGRpYWcgPSBkMy5zdmcuZGlhZ29uYWwoKVxuICAgICAgLnByb2plY3Rpb24gKGQpIC0+IFtkLnksIGQueF0gIyB1bmRvIHRoZSB4L3kgcmV2ZXJzYWwgZnJvbSBmaW5kUGluXG4gICAgXG4gICAgZ2xpc3QgPSB3bGlzdCA9IGdhZGdldHMgPSB3aXJlcyA9IG51bGxcbiAgICBcbiAgICBlbWl0ID0gKGFyZ3MuLi4pIC0+XG4gICAgICAjIGZvcmNlIGEgZGlnZXN0LCBzaW5jZSBkMyBldmVudHMgaGFwcGVuIG91dHNpZGUgb2YgbmcncyBldmVudCBjb250ZXh0XG4gICAgICBzY29wZS4kYXBwbHkgLT4gc2NvcGUuJGVtaXQgYXR0ci5ldmVudCA/ICdjaXJjdWl0JywgYXJncy4uLlxuICAgICAgXG4gICAgZ2FkZ2V0RHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgLm9yaWdpbiBPYmplY3RcbiAgICAgIC5vbiAnZHJhZ3N0YXJ0JywgKGQpIC0+XG4gICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICAgIEBwYXJlbnROb2RlLmFwcGVuZENoaWxkIEAgIyBtb3ZlIHRvIGZyb250XG4gICAgICAub24gJ2RyYWcnLCAoZCkgLT5cbiAgICAgICAgZC54ID0gZDMuZXZlbnQueCB8IDAgIyBzdGF5IG9uIGludCBjb29yZGluYXRlc1xuICAgICAgICBkLnkgPSBkMy5ldmVudC55IHwgMCAjIHN0YXkgb24gaW50IGNvb3JkaW5hdGVzXG4gICAgICAgIGQzLnNlbGVjdChAKS5hdHRyIHRyYW5zZm9ybTogKGQpIC0+IFwidHJhbnNsYXRlKCN7ZC54fSwje2QueX0pXCJcbiAgICAgICAgIyByZWNhbGN1bGF0ZSBlbmRwb2ludHMgYW5kIG1vdmUgYWxsIHdpcmVzIGF0dGFjaGVkIHRvIHRoaXMgZ2FkZ2V0XG4gICAgICAgIHdpcmVzLmZpbHRlciAodykgLT4gdy5zb3VyY2UuaWQgaXMgZC5pZCBvciB3LnRhcmdldC5pZCBpcyBkLmlkXG4gICAgICAgICAgLmVhY2ggKGQpIC0+XG4gICAgICAgICAgICBkLnNvdXJjZSA9IGZpbmRQaW4gZC5mcm9tXG4gICAgICAgICAgICBkLnRhcmdldCA9IGZpbmRQaW4gZC50b1xuICAgICAgICAgIC5hdHRyIGQ6IGRpYWdcbiAgICAgIC5vbiAnZHJhZ2VuZCcsIChkKSAtPlxuICAgICAgICBnID0gc2NvcGUuZGF0YS5nYWRnZXRzW2QuaWRdXG4gICAgICAgIHVubGVzcyBnLnggaXMgZC54IGFuZCBnLnkgaXMgZC55XG4gICAgICAgICAgZW1pdCAnbW92ZUdhZGdldCcsIGQuaWQsIGQueCwgZC55XG5cbiAgICBkcmFnSW5mbyA9IHt9XG4gICAgZHJhZ1dpcmUgPSBzdmcuYXBwZW5kKCdwYXRoJykuZGF0dW0oZHJhZ0luZm8pLmF0dHIgaWQ6ICdkcmFnJ1xuICAgIHdpcmVVbmRlckN1cnNvciA9IG51bGxcblxuICAgIHBpbkRyYWcgPSBkMy5iZWhhdmlvci5kcmFnKClcbiAgICAgIC5vcmlnaW4gT2JqZWN0XG4gICAgICAub24gJ2RyYWdzdGFydCcsIChkKSAtPlxuICAgICAgICBkMy5ldmVudC5zb3VyY2VFdmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICBkcmFnSW5mby5mcm9tID0gZC5waW5cbiAgICAgICAgZGVsZXRlIGRyYWdJbmZvLnRvXG4gICAgICAgIGRyYWdJbmZvLnNvdXJjZSA9IGZpbmRQaW4gZC5waW5cbiAgICAgIC5vbiAnZHJhZycsIChkKSAtPlxuICAgICAgICBbbXgsbXldID0gZDMubW91c2UoQClcbiAgICAgICAgb3JpZyA9IGRyYWdJbmZvLnNvdXJjZVxuICAgICAgICBkcmFnSW5mby50YXJnZXQgPSB4OiBvcmlnLngrbXktZC55LCB5OiBvcmlnLnkrbXgtZC54ICMgZmxpcHBlZFxuICAgICAgICBkcmFnV2lyZS5hdHRyIGNsYXNzOiAnZHJhd2luZycsIGZpbGw6ICdub25lJywgZDogZGlhZ1xuICAgICAgLm9uICdkcmFnZW5kJywgKGQpIC0+XG4gICAgICAgIGRyYWdXaXJlLmNsYXNzZWQgJ2RyYXdpbmcnLCBmYWxzZVxuICAgICAgICBpZiBkcmFnSW5mby50byBhbmQgZHJhZ0luZm8udG8gaXNudCBkcmFnSW5mby5mcm9tXG4gICAgICAgICAgZW1pdCAnYWRkV2lyZScsIGRyYWdJbmZvLmZyb20sIGRyYWdJbmZvLnRvXG5cbiAgICByZWRyYXcgPSAtPlxuICAgICAgcHJlcGFyZURhdGEoKVxuXG4gICAgICBnYWRnZXRzID0gc3ZnLnNlbGVjdEFsbCgnLmdhZGdldCcpLmRhdGEgZ2xpc3QsIChkKSAtPiBkLmlkXG4gICAgICB3aXJlcyA9IHN2Zy5zZWxlY3RBbGwoJy53aXJlJykuZGF0YSB3bGlzdCwgKGQpIC0+IGQuaWRcblxuICAgICAgZyA9IGdhZGdldHMuZW50ZXIoKS5hcHBlbmQoJ2cnKS5jYWxsKGdhZGdldERyYWcpXG4gICAgICAgIC5hdHRyIGNsYXNzOiAnZ2FkZ2V0J1xuICAgICAgZy5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAuZWFjaCAoZCkgLT5cbiAgICAgICAgICBkMy5zZWxlY3QoQCkuYXR0clxuICAgICAgICAgICAgY2xhc3M6ICdvdXRsaW5lJ1xuICAgICAgICAgICAgIyAxcHggbGluZXMgcmVuZGVyIHNoYXJwbHkgd2hlbiBvbiBhIDAuNXB4IG9mZnNldFxuICAgICAgICAgICAgeDogMC41IC0gZC5odywgeTogMC41IC0gZC5oaFxuICAgICAgICAgICAgd2lkdGg6IDIgKiBkLmh3LCBoZWlnaHQ6IDIgKiBkLmhoXG4gICAgICAgIC5vbiAnbW91c2Vkb3duJywgKGQpIC0+IGVtaXQgJ3NlbGVjdEdhZGdldCcsIGQuaWRcbiAgICAgICAgLnN0eWxlIGZpbGw6IChkKSAtPiBkLmRlZi5zaGFkZVxuICAgICAgZy5hcHBlbmQoJ3RleHQnKS50ZXh0IChkKSAtPiBkLnRpdGxlIG9yIGQuZGVmLm5hbWVcbiAgICAgICAgLmF0dHIgY2xhc3M6ICd0aXRsZScsIHk6IChkKSAtPiAxMiAtIGQuaGhcbiAgICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gXCIje2QudHlwZX0gLSAje2QuaWR9XCJcbiAgICAgICAgLmF0dHIgY2xhc3M6ICd0eXBlJywgeTogKGQpIC0+IC00ICsgZC5oaFxuICAgICAgZy5hcHBlbmQoJ3RleHQnKS50ZXh0IChkKSAtPiBkLmRlZi5pY29uXG4gICAgICAgIC5hdHRyIGNsYXNzOiAnaWNvbmZvbnQnLCB4OiAwLCB5OiAwXG4gICAgICBnLmFwcGVuZCgndGV4dCcpLnRleHQgKGQpIC0+ICdcXHVmMDE0JyAjIGZhLXRyYXNoLW9cbiAgICAgICAgLmF0dHIgY2xhc3M6ICdpY29uZm9udCcsIHg6ICgoZCkgLT4gZC5ody04KSwgeTogKChkKSAtPiA4LWQuaGgpXG4gICAgICAgIC5zdHlsZSAnZm9udC1zaXplJzogJzEycHgnXG4gICAgICAgIC5vbiAnbW91c2Vkb3duJywgKGQpIC0+XG4gICAgICAgICAgZDMuZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcbiAgICAgICAgICBlbWl0ICdkZWxHYWRnZXQnLCBkLmlkXG4gICAgICBnYWRnZXRzLmV4aXQoKS5yZW1vdmUoKVxuXG4gICAgICBwaW5zID0gZ2FkZ2V0cy5zZWxlY3RBbGwoJy5waW4nKS5kYXRhIChkKSAtPiBkLnBpbnNcbiAgICAgIHAgPSBwaW5zLmVudGVyKClcbiAgICAgIHAuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgICAuYXR0ciBjbGFzczogJ3BpbicsIGN4OiAoKGQpIC0+IGQueCsuNSksIGN5OiAoKGQpIC0+IGQueSsuNSksIHI6IDNcbiAgICAgIHAuYXBwZW5kKCdjaXJjbGUnKS5jYWxsKHBpbkRyYWcpXG4gICAgICAgIC5hdHRyIGNsYXNzOiAnaGl0JywgY3g6ICgoZCkgLT4gZC54Ky41KSwgY3k6ICgoZCkgLT4gZC55Ky41KSwgcjogN1xuICAgICAgICAub24gJ21vdXNldXAnLCAoZCkgLT4gZHJhZ0luZm8udG8gPSBkLnBpblxuICAgICAgcC5hcHBlbmQoJ3RleHQnKS50ZXh0IChkKSAtPiBkLm5hbWVcbiAgICAgICAgLmF0dHJcbiAgICAgICAgICBjbGFzczogKGQpIC0+IGQuZGlyXG4gICAgICAgICAgeDogKGQpIC0+IGlmIGQuZGlyIGlzICdpbicgdGhlbiBkLnggKyAxMCBlbHNlIGQueCAtIDEwXG4gICAgICAgICAgeTogKGQpIC0+IGQueSArIDVcbiAgICAgIHBpbnMuZXhpdCgpLnJlbW92ZSgpXG5cbiAgICAgIHdpcmVzLmVudGVyKCkuaW5zZXJ0KCdwYXRoJywgJ2cnKSAjIHVzZXMgaW5zZXJ0IHRvIG1vdmUgdG8gYmFjayByaWdodCBhd2F5XG4gICAgICAgIC5hdHRyIGNsYXNzOiAnd2lyZScsIGZpbGw6ICdub25lJywgZDogZGlhZ1xuICAgICAgICAjIGNhbid0IHVzZSBtb3VzZWNsaWNrLCBzZWVcbiAgICAgICAgIyBodHRwczovL2dyb3Vwcy5nb29nbGUuY29tL2QvbXNnL2QzLWpzL2dIek9qOTFYMk5BLzY1QkVmMkR1UlY0SlxuICAgICAgICAub24gJ21vdXNlZW50ZXInLCAoZCkgLT4gd2lyZVVuZGVyQ3Vyc29yID0gZFxuICAgICAgICAub24gJ21vdXNlbGVhdmUnLCAoZCkgLT4gd2lyZVVuZGVyQ3Vyc29yID0gbnVsbFxuICAgICAgd2lyZXMuZXhpdCgpLnJlbW92ZSgpXG5cbiAgICAgIGdhZGdldHMuYXR0ciB0cmFuc2Zvcm06IChkKSAtPiBcInRyYW5zbGF0ZSgje2QueH0sI3tkLnl9KVwiXG4gICAgXG4gICAgc3ZnLm9uICdtb3VzZWRvd24nLCAtPlxuICAgICAgIyByZXR1cm4gIGlmIGQzLmV2ZW50LmRlZmF1bHRQcmV2ZW50ZWRcbiAgICAgIGlmIHdpcmVVbmRlckN1cnNvclxuICAgICAgICBlbWl0ICdkZWxXaXJlJywgd2lyZVVuZGVyQ3Vyc29yLmZyb20sIHdpcmVVbmRlckN1cnNvci50b1xuICAgICAgICAjIHdpcmVVbmRlckN1cnNvciA9IG51bGxcbiAgICAgIGVsc2VcbiAgICAgICAgW3gseV0gPSBkMy5tb3VzZShAKVxuICAgICAgICBlbWl0ICdhZGRHYWRnZXQnLCB4fDAsIHl8MCAjIGNvbnZlcnQgdG8gaW50c1xuXG4gICAgZmluZFBpbiA9IChwaW4pIC0+XG4gICAgICBbZ2lkLHBuYW1lXSA9IHBpbi5zcGxpdCAnLidcbiAgICAgIGZvciBnIGluIGdsaXN0IHdoZW4gZ2lkIGlzIGcuaWRcbiAgICAgICAgZm9yIHAgaW4gZy5waW5zIHdoZW4gcG5hbWUgaXMgcC5uYW1lXG4gICAgICAgICAgIyByZXZlcnNlcyB4IGFuZCB5IGFuZCB1c2VzIHByb2plY3Rpb24gdG8gZ2V0IGhvcml6b250YWwgc3BsaW5lc1xuICAgICAgICAgIHJldHVybiB5OiBnLnggKyBwLnggKyAuNSwgeDogZy55ICsgcC55ICsgLjUsIGlkOiBnaWRcblxuICAgIHByZXBhcmVEYXRhID0gLT5cbiAgICAgIHlzdGVwID0gMjAgICMgdmVydGljYWwgc2VwYXJhdGlvbiBiZXR3ZWVuIHBpbnNcbiAgICAgIHdpZHRoID0gMTQwICMgZml4ZWQgd2lkdGggZm9yIG5vd1xuXG4gICAgICAjIHNldCB1cCBhIGxpc3Qgb2YgZ2FkZ2V0cyB3aXRoIHNpemVzIGFuZCByZWxhdGl2ZSBwaW4gY29vcmRpbmF0ZXNcbiAgICAgIGdsaXN0ID0gZm9yIGlkLCBnIG9mIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgICB7eCx5LHRpdGxlLHR5cGV9ID0gZ1xuICAgICAgICBkZWYgPSBzY29wZS5kZWZzW3R5cGVdXG4gICAgICAgIHBpbnMgPSBbXVxuICAgICAgICBwbGFjZVBpbnMgPSAocG5hbWVzLCBkaXIsIHhpKSAtPlxuICAgICAgICAgIG5saXN0ID0gaWYgcG5hbWVzIHRoZW4gcG5hbWVzLnNwbGl0ICcgJyBlbHNlIFtdXG4gICAgICAgICAgeWkgPSAteXN0ZXAgKiAobmxpc3QubGVuZ3RoIC0gMSkgPj4gMVxuICAgICAgICAgIGZvciBuYW1lIGluIG5saXN0XG4gICAgICAgICAgICBwaW5zLnB1c2ggeyB4OiB4aSwgeTogeWksIG5hbWUsIGRpciwgcGluOiBcIiN7aWR9LiN7bmFtZX1cIiB9XG4gICAgICAgICAgICB5aSArPSB5c3RlcFxuICAgICAgICAgIG5saXN0Lmxlbmd0aFxuICAgICAgICBodyA9IHdpZHRoIC8gMlxuICAgICAgICBpbnMgPSBwbGFjZVBpbnMgZGVmLmlucHV0cywgJ2luJywgLWh3XG4gICAgICAgIG91dHMgPSBwbGFjZVBpbnMgZGVmLm91dHB1dHMsICdvdXQnLCBod1xuICAgICAgICBoZWlnaHQgPSA0MCArIHlzdGVwICogKGlmIGlucyA+IG91dHMgdGhlbiBpbnMgZWxzZSBvdXRzKVxuICAgICAgICBoaCA9IGhlaWdodCAvIDJcbiAgICAgICAgeyBpZCwgeCwgeSwgdGl0bGUsIHR5cGUsIGRlZiwgcGlucywgaHcsIGhoLCBoZWlnaHQgfVxuXG4gICAgICAjIGNvbnZlcnQgb2JqZWN0IHRvIGxpc3QgYW5kIGxvb2t1cCB0aGUgd2lyZSBlbmRwb2ludHMgaW4gdGhlIGdhZGdldHNcbiAgICAgIHdsaXN0ID0gZm9yIGlkLCBjYXAgb2Ygc2NvcGUuZGF0YS53aXJlc1xuICAgICAgICBbZnJvbSx0b10gPSBpZC5zcGxpdCAnLydcbiAgICAgICAgc291cmNlID0gZmluZFBpbiBmcm9tXG4gICAgICAgIHRhcmdldCA9IGZpbmRQaW4gdG9cbiAgICAgICAgeyBpZCwgZnJvbSwgdG8sIHNvdXJjZSwgdGFyZ2V0LCBjYXAgfVxuICAgIFxuICAgIHNjb3BlLiR3YXRjaCBcImRhdGFcIiwgKC0+XG4gICAgICBjb25zb2xlLmxvZyBcImhhaGFoaGFoYWhhaGFoaFwiXG4gICAgICByZWRyYXcoKVxuICAgICksIHRydWVcbiAgICBcbiAgICByZWRyYXcoKVxuIl19
