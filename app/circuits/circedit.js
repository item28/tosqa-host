(function() {
  var gadgetTypes, ng,
    __slice = [].slice;

  ng = angular.module('myApp');

  gadgetTypes = {
    Pipe: {
      width: 80,
      height: 60,
      shade: 'lightyellow',
      pins: [
        {
          name: 'In',
          type: 'i'
        }, {
          name: 'Out',
          type: 'o'
        }
      ]
    },
    Printer: {
      width: 120,
      height: 40,
      shade: 'lightblue',
      pins: [
        {
          name: 'In',
          type: 'i'
        }, {
          name: 'Out',
          type: 'o'
        }
      ]
    }
  };

  ng.directive('circuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        data: '='
      },
      link: function(scope, elem, attr) {
        var diag, findPin, g, gadgetDrag, gadgets, pins, svg, wireDrag, wires;
        svg = d3.select(elem[0]).append('svg').attr({
          width: 900,
          height: 400
        });
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          return this.parentNode.appendChild(this);
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          return d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
        }).on('dragend', function(d) {
          return console.log('save gadget', d);
        });
        wireDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          console.log('wireDrag', d);
          this.parentNode.appendChild(this);
          return d3.event.sourceEvent.stopPropagation();
        }).on('drag', function(d) {
          d.x = d3.event.x;
          d.y = d3.event.y;
          return d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
        }).on('dragend', function(d) {
          return console.log('save wire', d);
        });
        diag = d3.svg.diagonal();
        gadgets = svg.selectAll('.gadget').data(scope.data.gadgets);
        g = gadgets.enter().append('g').call(gadgetDrag).attr({
          "class": 'gadget'
        }).each(function(d) {
          d.gt = gadgetTypes[d.type];
          d.hw = d.gt.width / 2;
          return d.hh = d.gt.height / 2;
        });
        g.append('rect').each(function(d) {
          return d3.select(this).attr({
            x: 0.5 - d.hw,
            y: 0.5 - d.hh,
            width: 2 * d.hw,
            height: 2 * d.hh
          });
        }).style({
          fill: function(d) {
            return d.gt.shade;
          }
        });
        g.append('text').text(function(d) {
          return d.title;
        }).attr({
          "class": 'title',
          y: function(d) {
            return 12 - d.hh;
          }
        });
        g.append('text').text(function(d) {
          return d.type;
        }).attr({
          "class": 'type',
          y: function(d) {
            return -4 + d.hh;
          }
        });
        g.append('circle').on('mousedown', function(d) {
          console.log('c1', d);
          return d3.event.sourceEvent.stopPropagation();
        }).attr({
          "class": 'pin',
          cx: (function(d) {
            return 0.5 - d.hw;
          }),
          r: 3
        });
        g.append('circle').on('mousedown', function(d) {
          console.log('c2', d);
          return d3.event.sourceEvent.stopPropagation();
        }).attr({
          "class": 'pin',
          cx: (function(d) {
            return 0.5 + d.hw;
          }),
          r: 3
        });
        pins = gadgets.selectAll('rect .pin').data(function(d) {
          var i, p, _i, _len, _ref, _results;
          i = 0;
          d.conns = [];
          _ref = d.gt.pins;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            p = _ref[_i];
            _results.push(d.conns.push({
              pin: p,
              parent: d,
              x: 800 + 50 * i++,
              y: 10 * i
            }));
          }
          return _results;
        });
        pins.enter().append('circle').each(function(d) {
          console.log('t', d.pin, d.parent);
          return d3.select(this).attr({
            "class": 'pin',
            cx: 100,
            cy: 50,
            r: 8
          });
        });
        findPin = function(name) {
          var c, cpn, gid, _i, _j, _len, _len1, _ref, _ref1, _ref2;
          _ref = name.split('.'), gid = _ref[0], cpn = _ref[1];
          _ref1 = scope.data.gadgets;
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            g = _ref1[_i];
            if (gid === g.id) {
              _ref2 = g.conns;
              for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
                c = _ref2[_j];
                console.log('cpn', cpn, c);
                if (cpn === c.pin.name) {
                  console.log('gp', name, g, c);
                  return [g, c];
                }
              }
            }
          }
        };
        diag.source(function(d) {
          console.log.apply(console, ['df', d].concat(__slice.call(findPin(d.from))));
          return findPin(d.from)[1];
        });
        diag.target(function(d) {
          console.log.apply(console, ['dt', d].concat(__slice.call(findPin(d.to))));
          return findPin(d.to)[1];
        });
        wires = svg.selectAll('.wire').data(scope.data.wires);
        wires.enter().append('path').attr({
          "class": 'wire',
          d: diag
        });
        return gadgets.attr({
          transform: function(d) {
            return "translate(" + d.x + "," + d.y + ")";
          }
        });
      }
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSxlQUFBO0lBQUEsa0JBQUE7O0FBQUEsRUFBQSxFQUFBLEdBQUssT0FBTyxDQUFDLE1BQVIsQ0FBZSxPQUFmLENBQUwsQ0FBQTs7QUFBQSxFQUVBLFdBQUEsR0FDRTtBQUFBLElBQUEsSUFBQSxFQUNFO0FBQUEsTUFBQSxLQUFBLEVBQU8sRUFBUDtBQUFBLE1BQ0EsTUFBQSxFQUFRLEVBRFI7QUFBQSxNQUVBLEtBQUEsRUFBTyxhQUZQO0FBQUEsTUFHQSxJQUFBLEVBQU07UUFDSjtBQUFBLFVBQUUsSUFBQSxFQUFLLElBQVA7QUFBQSxVQUFhLElBQUEsRUFBSyxHQUFsQjtTQURJLEVBRUo7QUFBQSxVQUFFLElBQUEsRUFBSyxLQUFQO0FBQUEsVUFBYyxJQUFBLEVBQUssR0FBbkI7U0FGSTtPQUhOO0tBREY7QUFBQSxJQVFBLE9BQUEsRUFDRTtBQUFBLE1BQUEsS0FBQSxFQUFPLEdBQVA7QUFBQSxNQUNBLE1BQUEsRUFBUSxFQURSO0FBQUEsTUFFQSxLQUFBLEVBQU8sV0FGUDtBQUFBLE1BR0EsSUFBQSxFQUFNO1FBQ0o7QUFBQSxVQUFFLElBQUEsRUFBSyxJQUFQO0FBQUEsVUFBYSxJQUFBLEVBQUssR0FBbEI7U0FESSxFQUVKO0FBQUEsVUFBRSxJQUFBLEVBQUssS0FBUDtBQUFBLFVBQWMsSUFBQSxFQUFLLEdBQW5CO1NBRkk7T0FITjtLQVRGO0dBSEYsQ0FBQTs7QUFBQSxFQW9CQSxFQUFFLENBQUMsU0FBSCxDQUFhLGVBQWIsRUFBOEIsU0FBQSxHQUFBO1dBQzVCO0FBQUEsTUFBQSxRQUFBLEVBQVUsR0FBVjtBQUFBLE1BRUEsS0FBQSxFQUNFO0FBQUEsUUFBQSxJQUFBLEVBQU0sR0FBTjtPQUhGO0FBQUEsTUFLQSxJQUFBLEVBQU0sU0FBQyxLQUFELEVBQVEsSUFBUixFQUFjLElBQWQsR0FBQTtBQUNKLFlB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O0FBQUEsUUFxR0EsSUFBSSxDQUFDLE1BQUwsQ0FBWSxTQUFDLENBQUQsR0FBQTtBQUNWLFVBQUEsT0FBTyxDQUFDLEdBQVIsZ0JBQVksQ0FBQSxJQUFBLEVBQU0sQ0FBRyxTQUFBLGFBQUEsT0FBQSxDQUFRLENBQUMsQ0FBQyxFQUFWLENBQUEsQ0FBQSxDQUFyQixDQUFBLENBQUE7aUJBQ0EsT0FBQSxDQUFRLENBQUMsQ0FBQyxFQUFWLENBQWMsQ0FBQSxDQUFBLEVBRko7UUFBQSxDQUFaLENBckdBLENBQUE7QUFBQSxRQTJHQSxLQUFBLEdBQVEsR0FBRyxDQUFDLFNBQUosQ0FBYyxPQUFkLENBQXNCLENBQUMsSUFBdkIsQ0FBNEIsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUF2QyxDQTNHUixDQUFBO0FBQUEsUUE0R0EsS0FBSyxDQUFDLEtBQU4sQ0FBQSxDQUFhLENBQUMsTUFBZCxDQUFxQixNQUFyQixDQUNFLENBQUMsSUFESCxDQUNRO0FBQUEsVUFBQSxPQUFBLEVBQU8sTUFBUDtBQUFBLFVBQWUsQ0FBQSxFQUFHLElBQWxCO1NBRFIsQ0E1R0EsQ0FBQTtlQStHQSxPQUFPLENBQUMsSUFBUixDQUNFO0FBQUEsVUFBQSxTQUFBLEVBQVcsU0FBQyxDQUFELEdBQUE7bUJBQVEsWUFBQSxHQUFXLENBQUMsQ0FBQyxDQUFiLEdBQWdCLEdBQWhCLEdBQWtCLENBQUMsQ0FBQyxDQUFwQixHQUF1QixJQUEvQjtVQUFBLENBQVg7U0FERixFQWhISTtNQUFBLENBTE47TUFENEI7RUFBQSxDQUE5QixDQXBCQSxDQUFBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJuZyA9IGFuZ3VsYXIubW9kdWxlICdteUFwcCdcblxuZ2FkZ2V0VHlwZXMgPVxuICBQaXBlOlxuICAgIHdpZHRoOiA4MFxuICAgIGhlaWdodDogNjBcbiAgICBzaGFkZTogJ2xpZ2h0eWVsbG93J1xuICAgIHBpbnM6IFtcbiAgICAgIHsgbmFtZTonSW4nLCB0eXBlOidpJyB9XG4gICAgICB7IG5hbWU6J091dCcsIHR5cGU6J28nIH1cbiAgICBdXG4gIFByaW50ZXI6XG4gICAgd2lkdGg6IDEyMFxuICAgIGhlaWdodDogNDBcbiAgICBzaGFkZTogJ2xpZ2h0Ymx1ZSdcbiAgICBwaW5zOiBbXG4gICAgICB7IG5hbWU6J0luJywgdHlwZTonaScgfVxuICAgICAgeyBuYW1lOidPdXQnLCB0eXBlOidvJyB9XG4gICAgXVxuXG5uZy5kaXJlY3RpdmUgJ2NpcmN1aXRFZGl0b3InLCAtPlxuICByZXN0cmljdDogJ0UnXG4gIFxuICBzY29wZTpcbiAgICBkYXRhOiAnPSdcbiAgICBcbiAgbGluazogKHNjb3BlLCBlbGVtLCBhdHRyKSAtPlxuICAgIHN2ZyA9IGQzLnNlbGVjdChlbGVtWzBdKS5hcHBlbmQgJ3N2ZydcbiAgICAgIC5hdHRyIHdpZHRoOiA5MDAsIGhlaWdodDogNDAwXG5cbiAgICBnYWRnZXREcmFnID0gZDMuYmVoYXZpb3IuZHJhZygpXG4gICAgICAub3JpZ2luIE9iamVjdFxuICAgICAgLm9uICdkcmFnc3RhcnQnLCAoZCkgLT5cbiAgICAgICAgQHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQgQCAjIG1vdmUgdG8gZnJvbnRcbiAgICAgIC5vbiAnZHJhZycsIChkKSAtPlxuICAgICAgICBkLnggPSBkMy5ldmVudC54IHwgMCAjIHN0YXkgb24gaW50IGNvb3JkaW5hdGVzXG4gICAgICAgIGQueSA9IGQzLmV2ZW50LnkgfCAwICMgc3RheSBvbiBpbnQgY29vcmRpbmF0ZXNcbiAgICAgICAgZDMuc2VsZWN0KEApLmF0dHJcbiAgICAgICAgICB0cmFuc2Zvcm06IChkKSAtPiBcInRyYW5zbGF0ZSgje2QueH0sI3tkLnl9KVwiXG4gICAgICAub24gJ2RyYWdlbmQnLCAoZCkgLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ3NhdmUgZ2FkZ2V0JywgZCAjIFRPRE86IHNhdmUgdG8gc2VydmVyXG5cbiAgICB3aXJlRHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgLm9yaWdpbiBPYmplY3RcbiAgICAgIC5vbiAnZHJhZ3N0YXJ0JywgKGQpIC0+XG4gICAgICAgIGNvbnNvbGUubG9nICd3aXJlRHJhZycsIGRcbiAgICAgICAgQHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQgQCAjIG1vdmUgdG8gZnJvbnRcbiAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcbiAgICAgIC5vbiAnZHJhZycsIChkKSAtPlxuICAgICAgICBkLnggPSBkMy5ldmVudC54XG4gICAgICAgIGQueSA9IGQzLmV2ZW50LnlcbiAgICAgICAgZDMuc2VsZWN0KEApLmF0dHJcbiAgICAgICAgICB0cmFuc2Zvcm06IChkKSAtPiBcInRyYW5zbGF0ZSgje2QueH0sI3tkLnl9KVwiXG4gICAgICAub24gJ2RyYWdlbmQnLCAoZCkgLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ3NhdmUgd2lyZScsIGQgIyBUT0RPOiBzYXZlIHRvIHNlcnZlclxuXG4gICAgZGlhZyA9IGQzLnN2Zy5kaWFnb25hbCgpXG4gICAgXG4gICAgZ2FkZ2V0cyA9IHN2Zy5zZWxlY3RBbGwoJy5nYWRnZXQnKS5kYXRhKHNjb3BlLmRhdGEuZ2FkZ2V0cylcbiAgXG4gICAgZyA9IGdhZGdldHMuZW50ZXIoKS5hcHBlbmQoJ2cnKS5jYWxsKGdhZGdldERyYWcpXG4gICAgICAuYXR0ciBjbGFzczogJ2dhZGdldCdcbiAgICAgIC5lYWNoIChkKSAtPlxuICAgICAgICBkLmd0ID0gZ2FkZ2V0VHlwZXNbZC50eXBlXVxuICAgICAgICBkLmh3ID0gZC5ndC53aWR0aCAvIDJcbiAgICAgICAgZC5oaCA9IGQuZ3QuaGVpZ2h0IC8gMlxuICAgIGcuYXBwZW5kKCdyZWN0JylcbiAgICAgIC5lYWNoIChkKSAtPlxuICAgICAgICBkMy5zZWxlY3QoQCkuYXR0clxuICAgICAgICAgICMgMXB4IGxpbmVzIHJlbmRlciBzaGFycGx5IHdoZW4gb24gYSAwLjVweCBvZmZzZXRcbiAgICAgICAgICB4OiAwLjUgLSBkLmh3XG4gICAgICAgICAgeTogMC41IC0gZC5oaFxuICAgICAgICAgIHdpZHRoOiAyICogZC5od1xuICAgICAgICAgIGhlaWdodDogMiAqIGQuaGhcbiAgICAgIC5zdHlsZVxuICAgICAgICBmaWxsOiAoZCkgLT4gZC5ndC5zaGFkZVxuICAgIGcuYXBwZW5kKCd0ZXh0JylcbiAgICAgIC50ZXh0IChkKSAtPiBkLnRpdGxlXG4gICAgICAuYXR0ciBjbGFzczogJ3RpdGxlJywgeTogKGQpIC0+IDEyIC0gZC5oaFxuICAgIGcuYXBwZW5kKCd0ZXh0JylcbiAgICAgIC50ZXh0IChkKSAtPiBkLnR5cGVcbiAgICAgIC5hdHRyIGNsYXNzOiAndHlwZScsIHk6IChkKSAtPiAtNCArIGQuaGhcbiAgICBnLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgIC5vbiAnbW91c2Vkb3duJywgKGQpIC0+XG4gICAgICAgIGNvbnNvbGUubG9nICdjMScsIGRcbiAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcbiAgICAgIC5hdHRyIGNsYXNzOiAncGluJywgY3g6ICgoZCkgLT4gMC41IC0gZC5odyksIHI6IDNcbiAgICBnLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgIC5vbiAnbW91c2Vkb3duJywgKGQpIC0+XG4gICAgICAgIGNvbnNvbGUubG9nICdjMicsIGRcbiAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcbiAgICAgIC5hdHRyIGNsYXNzOiAncGluJywgY3g6ICgoZCkgLT4gMC41ICsgZC5odyksIHI6IDNcbiAgICAgICAgXG4gICAgcGlucyA9IGdhZGdldHMuc2VsZWN0QWxsKCdyZWN0IC5waW4nKS5kYXRhIChkKSAtPlxuICAgICAgaSA9IDBcbiAgICAgIGQuY29ubnMgPSBbXVxuICAgICAgZm9yIHAgaW4gZC5ndC5waW5zXG4gICAgICAgIGQuY29ubnMucHVzaFxuICAgICAgICAgIHBpbjogcFxuICAgICAgICAgIHBhcmVudDogZFxuICAgICAgICAgIHg6IDgwMCs1MCppKytcbiAgICAgICAgICB5OjEwKmlcbiAgICBwaW5zLmVudGVyKCkuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgLmVhY2ggKGQpIC0+XG4gICAgICAgIGNvbnNvbGUubG9nICd0JywgZC5waW4sIGQucGFyZW50XG4gICAgICAgIGQzLnNlbGVjdChAKS5hdHRyXG4gICAgICAgICAgY2xhc3M6ICdwaW4nLCBjeDogMTAwLCBjeTogNTAsIHI6OFxuXG4gICAgZmluZFBpbiA9IChuYW1lKSAtPlxuICAgICAgW2dpZCxjcG5dID0gbmFtZS5zcGxpdCAnLidcbiAgICAgIGZvciBnIGluIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgICBpZiBnaWQgaXMgZy5pZFxuICAgICAgICAgIGZvciBjIGluIGcuY29ubnNcbiAgICAgICAgICAgIGNvbnNvbGUubG9nICdjcG4nLCBjcG4sIGNcbiAgICAgICAgICAgIGlmIGNwbiBpcyBjLnBpbi5uYW1lXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nICdncCcsIG5hbWUsIGcsIGNcbiAgICAgICAgICAgICAgcmV0dXJuIFtnLCBjXVxuICAgICMgY29uc29sZS5sb2cgJ2YxJywgZmluZFBpbihcImcyLk91dFwiKS4uLlxuICAgICMgY29uc29sZS5sb2cgJ2YyJywgZmluZFBpbihcImcxLkluXCIpLi4uXG4gICAgXG4gICAgIyBGSVhNRVxuICAgICMgZGlhZy5zb3VyY2Ugc2NvcGUuZGF0YS5nYWRnZXRzWzBdXG4gICAgIyBkaWFnLnByb2plY3Rpb24gKGQpIC0+XG4gICAgIyAgIGNvbnNvbGUubG9nICdyJywgZFxuICAgICMgICBbZC5jeCwgZC5jeV1cbiAgICBkaWFnLnNvdXJjZSAoZCkgLT5cbiAgICAgIGNvbnNvbGUubG9nICdkZicsIGQsIGZpbmRQaW4oZC5mcm9tKS4uLlxuICAgICAgZmluZFBpbihkLmZyb20pWzFdXG4gICAgZGlhZy50YXJnZXQgKGQpIC0+XG4gICAgICBjb25zb2xlLmxvZyAnZHQnLCBkLCBmaW5kUGluKGQudG8pLi4uXG4gICAgICBmaW5kUGluKGQudG8pWzFdXG4gICAgIyBkaWFnLnNvdXJjZSBzY29wZS5kYXRhLmdhZGdldHNbMV1cbiAgICAjIGRpYWcudGFyZ2V0IHNjb3BlLmRhdGEuZ2FkZ2V0c1swXVxuXG4gICAgd2lyZXMgPSBzdmcuc2VsZWN0QWxsKCcud2lyZScpLmRhdGEoc2NvcGUuZGF0YS53aXJlcylcbiAgICB3aXJlcy5lbnRlcigpLmFwcGVuZCgncGF0aCcpXG4gICAgICAuYXR0ciBjbGFzczogJ3dpcmUnLCBkOiBkaWFnXG5cbiAgICBnYWRnZXRzLmF0dHJcbiAgICAgIHRyYW5zZm9ybTogKGQpIC0+IFwidHJhbnNsYXRlKCN7ZC54fSwje2QueX0pXCJcbiJdfQ==
