(function() {
  var ng;

  ng = angular.module('myApp');

  ng.directive('circuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        defs: '=',
        data: '='
      },
      link: function(scope, elem, attr) {
        var d, diag, findPin, g, gadgetDrag, gadgets, ins, n, outs, p, pins, step, svg, wires, yIn, yOut, _i, _j, _k, _l, _len, _len1, _len2, _len3, _ref, _ref1, _ref2, _ref3, _ref4;
        svg = d3.select(elem[0]).append('svg').attr({
          height: "70%"
        });
        _ref = scope.defs;
        for (n in _ref) {
          d = _ref[n];
          d.name || (d.name = n);
          ins = 0;
          _ref1 = d.pins;
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            p = _ref1[_i];
            p.x = d.width / 2;
            if (p.dir === 'in') {
              p.x = -p.x;
              ++ins;
            }
          }
          outs = d.pins.length - ins;
          step = 16;
          yIn = -(ins - 1) * step / 2;
          yOut = -(outs - 1) * step / 2;
          _ref2 = d.pins;
          for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
            p = _ref2[_j];
            if (p.dir === 'in') {
              p.y = yIn;
              yIn += step;
            } else {
              p.y = yOut;
              yOut += step;
            }
          }
          d.height = 30 + step * (ins > outs ? ins : outs);
        }
        findPin = function(name) {
          var g, gid, pname, _k, _l, _len2, _len3, _ref3, _ref4, _ref5;
          _ref3 = name.split('.'), gid = _ref3[0], pname = _ref3[1];
          _ref4 = scope.data.gadgets;
          for (_k = 0, _len2 = _ref4.length; _k < _len2; _k++) {
            g = _ref4[_k];
            if (gid === g.id) {
              _ref5 = g.def.pins;
              for (_l = 0, _len3 = _ref5.length; _l < _len3; _l++) {
                p = _ref5[_l];
                if (pname === p.name) {
                  return {
                    y: g.x + p.x + .5,
                    x: g.y + p.y + .5,
                    g: g,
                    p: p
                  };
                }
              }
            }
          }
        };
        _ref3 = scope.data.gadgets;
        for (_k = 0, _len2 = _ref3.length; _k < _len2; _k++) {
          d = _ref3[_k];
          d.def = scope.defs[d.type];
          d.hw = d.def.width / 2;
          d.hh = d.def.height / 2;
        }
        _ref4 = scope.data.wires;
        for (_l = 0, _len3 = _ref4.length; _l < _len3; _l++) {
          d = _ref4[_l];
          d.source = findPin(d.from);
          d.target = findPin(d.to);
        }
        gadgets = svg.selectAll('.gadget').data(scope.data.gadgets);
        wires = svg.selectAll('.wire').data(scope.data.wires);
        diag = d3.svg.diagonal().projection(function(d) {
          return [d.y, d.x];
        });
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          return this.parentNode.appendChild(this);
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
          return wires.filter(function(w) {
            return w.source.g === d || w.target.g === d;
          }).each(function(d) {
            d.source = findPin(d.from);
            return d.target = findPin(d.to);
          }).attr({
            d: diag
          });
        }).on('dragend', function(d) {
          return console.log('save gadget', d);
        });
        g = gadgets.enter().append('g').call(gadgetDrag).attr({
          "class": 'gadget'
        });
        g.append('rect').each(function(d) {
          return d3.select(this).attr({
            "class": 'outline',
            x: 0.5 - d.hw,
            y: 0.5 - d.hh,
            width: 2 * d.hw,
            height: 2 * d.hh
          });
        }).style({
          fill: function(d) {
            return d.def.shade;
          }
        });
        g.append('text').text(function(d) {
          return d.title;
        }).attr({
          "class": 'title',
          y: function(d) {
            return 12 - d.hh;
          }
        });
        g.append('text').text(function(d) {
          return d.def.name;
        }).attr({
          "class": 'type',
          y: function(d) {
            return -4 + d.hh;
          }
        });
        g.append('text').text(function(d) {
          return d.def.icon;
        }).attr({
          "class": 'iconfont',
          x: 0,
          y: 0
        });
        pins = gadgets.selectAll('rect .pin').data(function(d) {
          return d.def.pins;
        });
        p = pins.enter();
        p.append('circle').attr({
          "class": 'pin',
          cx: (function(d) {
            return d.x + .5;
          }),
          cy: (function(d) {
            return d.y + .5;
          }),
          r: 3
        }).on('mousedown', function(d) {
          return console.log('c1', d);
        });
        p.append('text').text(function(d) {
          return d.name;
        }).attr({
          "class": function(d) {
            return d.dir;
          },
          x: function(d) {
            if (d.dir === 'in') {
              return d.x + 7;
            } else {
              return d.x - 7;
            }
          },
          y: function(d) {
            return d.y + 5;
          }
        });
        wires.enter().insert('path', 'g').attr({
          "class": 'wire',
          d: diag
        });
        return gadgets.attr({
          transform: function(d) {
            return "translate(" + d.x + "," + d.y + ")";
          }
        });
      }
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSxFQUFBOztBQUFBLEVBQUEsRUFBQSxHQUFLLE9BQU8sQ0FBQyxNQUFSLENBQWUsT0FBZixDQUFMLENBQUE7O0FBQUEsRUFFQSxFQUFFLENBQUMsU0FBSCxDQUFhLGVBQWIsRUFBOEIsU0FBQSxHQUFBO1dBQzVCO0FBQUEsTUFBQSxRQUFBLEVBQVUsR0FBVjtBQUFBLE1BRUEsS0FBQSxFQUNFO0FBQUEsUUFBQSxJQUFBLEVBQU0sR0FBTjtBQUFBLFFBQ0EsSUFBQSxFQUFNLEdBRE47T0FIRjtBQUFBLE1BTUEsSUFBQSxFQUFNLFNBQUMsS0FBRCxFQUFRLElBQVIsRUFBYyxJQUFkLEdBQUE7QUFDSixZQUFBLHlLQUFBO0FBQUEsUUFBQSxHQUFBLEdBQU0sRUFBRSxDQUFDLE1BQUgsQ0FBVSxJQUFLLENBQUEsQ0FBQSxDQUFmLENBQWtCLENBQUMsTUFBbkIsQ0FBMEIsS0FBMUIsQ0FDSixDQUFDLElBREcsQ0FDRTtBQUFBLFVBQUEsTUFBQSxFQUFRLEtBQVI7U0FERixDQUFOLENBQUE7QUFJQTtBQUFBLGFBQUEsU0FBQTtzQkFBQTtBQUNFLFVBQUEsQ0FBQyxDQUFDLFNBQUYsQ0FBQyxDQUFDLE9BQVMsRUFBWCxDQUFBO0FBQUEsVUFDQSxHQUFBLEdBQU0sQ0FETixDQUFBO0FBRUE7QUFBQSxlQUFBLDRDQUFBOzBCQUFBO0FBQ0UsWUFBQSxDQUFDLENBQUMsQ0FBRixHQUFNLENBQUMsQ0FBQyxLQUFGLEdBQVUsQ0FBaEIsQ0FBQTtBQUNBLFlBQUEsSUFBRyxDQUFDLENBQUMsR0FBRixLQUFTLElBQVo7QUFDRSxjQUFBLENBQUMsQ0FBQyxDQUFGLEdBQU0sQ0FBQSxDQUFFLENBQUMsQ0FBVCxDQUFBO0FBQUEsY0FDQSxFQUFBLEdBREEsQ0FERjthQUZGO0FBQUEsV0FGQTtBQUFBLFVBT0EsSUFBQSxHQUFPLENBQUMs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QURILENBQ1E7QUFBQSxVQUFBLE9BQUEsRUFBTyxNQUFQO0FBQUEsVUFBZSxDQUFBLEVBQUcsSUFBbEI7U0FEUixDQWxHQSxDQUFBO2VBcUdBLE9BQU8sQ0FBQyxJQUFSLENBQWE7QUFBQSxVQUFBLFNBQUEsRUFBVyxTQUFDLENBQUQsR0FBQTttQkFBUSxZQUFBLEdBQVcsQ0FBQyxDQUFDLENBQWIsR0FBZ0IsR0FBaEIsR0FBa0IsQ0FBQyxDQUFDLENBQXBCLEdBQXVCLElBQS9CO1VBQUEsQ0FBWDtTQUFiLEVBdEdJO01BQUEsQ0FOTjtNQUQ0QjtFQUFBLENBQTlCLENBRkEsQ0FBQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsibmcgPSBhbmd1bGFyLm1vZHVsZSAnbXlBcHAnXG5cbm5nLmRpcmVjdGl2ZSAnY2lyY3VpdEVkaXRvcicsIC0+XG4gIHJlc3RyaWN0OiAnRSdcbiAgXG4gIHNjb3BlOlxuICAgIGRlZnM6ICc9J1xuICAgIGRhdGE6ICc9J1xuICAgIFxuICBsaW5rOiAoc2NvcGUsIGVsZW0sIGF0dHIpIC0+XG4gICAgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZCAnc3ZnJ1xuICAgICAgLmF0dHIgaGVpZ2h0OiBcIjcwJVwiXG5cbiAgICAjIHByZS1jYWxjdWxhdGUgc2l6ZXMgYW5kIHJlbGF0aXZlIHBpbiBjb29yZGluYXRlc1xuICAgIGZvciBuLCBkIG9mIHNjb3BlLmRlZnNcbiAgICAgIGQubmFtZSBvcj0gblxuICAgICAgaW5zID0gMFxuICAgICAgZm9yIHAgaW4gZC5waW5zXG4gICAgICAgIHAueCA9IGQud2lkdGggLyAyXG4gICAgICAgIGlmIHAuZGlyIGlzICdpbidcbiAgICAgICAgICBwLnggPSAtcC54XG4gICAgICAgICAgKytpbnNcbiAgICAgIG91dHMgPSBkLnBpbnMubGVuZ3RoIC0gaW5zXG4gICAgICBzdGVwID0gMTZcbiAgICAgIHlJbiA9IC0gKGlucyAtIDEpICogc3RlcCAvIDJcbiAgICAgIHlPdXQgPSAtIChvdXRzIC0gMSkgKiBzdGVwIC8gMlxuICAgICAgZm9yIHAgaW4gZC5waW5zXG4gICAgICAgIGlmIHAuZGlyIGlzICdpbidcbiAgICAgICAgICBwLnkgPSB5SW5cbiAgICAgICAgICB5SW4gKz0gc3RlcFxuICAgICAgICBlbHNlXG4gICAgICAgICAgcC55ID0geU91dFxuICAgICAgICAgIHlPdXQgKz0gc3RlcFxuICAgICAgZC5oZWlnaHQgPSAzMCArIHN0ZXAgKiAoaWYgaW5zID4gb3V0cyB0aGVuIGlucyBlbHNlIG91dHMpXG5cbiAgICBmaW5kUGluID0gKG5hbWUpIC0+XG4gICAgICBbZ2lkLHBuYW1lXSA9IG5hbWUuc3BsaXQgJy4nXG4gICAgICBmb3IgZyBpbiBzY29wZS5kYXRhLmdhZGdldHNcbiAgICAgICAgaWYgZ2lkIGlzIGcuaWRcbiAgICAgICAgICBmb3IgcCBpbiBnLmRlZi5waW5zXG4gICAgICAgICAgICBpZiBwbmFtZSBpcyBwLm5hbWVcbiAgICAgICAgICAgICAgIyByZXZlcnNlcyB4IGFuZCB5IGFuZCB1c2VzIHByb2plY3Rpb24gdG8gZ2V0IGhvcml6b250YWwgc3BsaW5lc1xuICAgICAgICAgICAgICByZXR1cm4geTogZy54ICsgcC54ICsgLjUsIHg6IGcueSArIHAueSArIC41LCBnOiBnLCBwOiBwXG5cbiAgICBmb3IgZCBpbiBzY29wZS5kYXRhLmdhZGdldHNcbiAgICAgIGQuZGVmID0gc2NvcGUuZGVmc1tkLnR5cGVdXG4gICAgICBkLmh3ID0gZC5kZWYud2lkdGggLyAyXG4gICAgICBkLmhoID0gZC5kZWYuaGVpZ2h0IC8gMlxuXG4gICAgZm9yIGQgaW4gc2NvcGUuZGF0YS53aXJlc1xuICAgICAgZC5zb3VyY2UgPSBmaW5kUGluIGQuZnJvbVxuICAgICAgZC50YXJnZXQgPSBmaW5kUGluIGQudG9cblxuICAgIGdhZGdldHMgPSBzdmcuc2VsZWN0QWxsKCcuZ2FkZ2V0JykuZGF0YShzY29wZS5kYXRhLmdhZGdldHMpXG4gICAgd2lyZXMgPSBzdmcuc2VsZWN0QWxsKCcud2lyZScpLmRhdGEoc2NvcGUuZGF0YS53aXJlcylcblxuICAgIGRpYWcgPSBkMy5zdmcuZGlhZ29uYWwoKVxuICAgICAgLnByb2plY3Rpb24gKGQpIC0+IFtkLnksIGQueF0gIyB1bmRvIHRoZSB4L3kgcmV2ZXJzYWwgZnJvbSBmaW5kUGluXG4gICAgXG4gICAgZ2FkZ2V0RHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgLm9yaWdpbiBPYmplY3RcbiAgICAgIC5vbiAnZHJhZ3N0YXJ0JywgKGQpIC0+XG4gICAgICAgIEBwYXJlbnROb2RlLmFwcGVuZENoaWxkIEAgIyBtb3ZlIHRvIGZyb250XG4gICAgICAub24gJ2RyYWcnLCAoZCkgLT5cbiAgICAgICAgZC54ID0gZDMuZXZlbnQueCB8IDAgIyBzdGF5IG9uIGludCBjb29yZGluYXRlc1xuICAgICAgICBkLnkgPSBkMy5ldmVudC55IHwgMCAjIHN0YXkgb24gaW50IGNvb3JkaW5hdGVzXG4gICAgICAgIGQzLnNlbGVjdChAKS5hdHRyXG4gICAgICAgICAgdHJhbnNmb3JtOiAoZCkgLT4gXCJ0cmFuc2xhdGUoI3tkLnh9LCN7ZC55fSlcIlxuICAgICAgICAjIHJlY2FsY3VsYXRlIGVuZHBvaW50cyBhbmQgcmVkcmF3IGFsbCB3aXJlcyBhdHRhY2hlZCB0byB0aGlzIGdhZGdldFxuICAgICAgICB3aXJlcy5maWx0ZXIgKHcpIC0+IHcuc291cmNlLmcgaXMgZCBvciB3LnRhcmdldC5nIGlzIGRcbiAgICAgICAgICAuZWFjaCAoZCkgLT5cbiAgICAgICAgICAgIGQuc291cmNlID0gZmluZFBpbiBkLmZyb21cbiAgICAgICAgICAgIGQudGFyZ2V0ID0gZmluZFBpbiBkLnRvXG4gICAgICAgICAgLmF0dHIgZDogZGlhZ1xuICAgICAgLm9uICdkcmFnZW5kJywgKGQpIC0+XG4gICAgICAgIGNvbnNvbGUubG9nICdzYXZlIGdhZGdldCcsIGQgIyBUT0RPOiBzYXZlIHRvIHNlcnZlclxuXG4gICAgZyA9IGdhZGdldHMuZW50ZXIoKS5hcHBlbmQoJ2cnKS5jYWxsKGdhZGdldERyYWcpXG4gICAgICAuYXR0ciBjbGFzczogJ2dhZGdldCdcbiAgICBnLmFwcGVuZCgncmVjdCcpXG4gICAgICAuZWFjaCAoZCkgLT5cbiAgICAgICAgZDMuc2VsZWN0KEApLmF0dHJcbiAgICAgICAgICBjbGFzczogJ291dGxpbmUnXG4gICAgICAgICAgIyAxcHggbGluZXMgcmVuZGVyIHNoYXJwbHkgd2hlbiBvbiBhIDAuNXB4IG9mZnNldFxuICAgICAgICAgIHg6IDAuNSAtIGQuaHdcbiAgICAgICAgICB5OiAwLjUgLSBkLmhoXG4gICAgICAgICAgd2lkdGg6IDIgKiBkLmh3XG4gICAgICAgICAgaGVpZ2h0OiAyICogZC5oaFxuICAgICAgLnN0eWxlIGZpbGw6IChkKSAtPiBkLmRlZi5zaGFkZVxuICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC50aXRsZVxuICAgICAgLmF0dHIgY2xhc3M6ICd0aXRsZScsIHk6IChkKSAtPiAxMiAtIGQuaGhcbiAgICBnLmFwcGVuZCgndGV4dCcpLnRleHQgKGQpIC0+IGQuZGVmLm5hbWVcbiAgICAgIC5hdHRyIGNsYXNzOiAndHlwZScsIHk6IChkKSAtPiAtNCArIGQuaGhcbiAgICBnLmFwcGVuZCgndGV4dCcpLnRleHQgKGQpIC0+IGQuZGVmLmljb25cbiAgICAgIC5hdHRyIGNsYXNzOiAnaWNvbmZvbnQnLCB4OiAwLCB5OiAwXG4gICAgICAgIFxuICAgIHBpbnMgPSBnYWRnZXRzLnNlbGVjdEFsbCgncmVjdCAucGluJykuZGF0YSAoZCkgLT4gZC5kZWYucGluc1xuICAgIHAgPSBwaW5zLmVudGVyKClcbiAgICBwLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgIC5hdHRyIGNsYXNzOiAncGluJywgY3g6ICgoZCkgLT4gZC54Ky41KSwgY3k6ICgoZCkgLT4gZC55Ky41KSwgcjogM1xuICAgICAgLm9uICdtb3VzZWRvd24nLCAoZCkgLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ2MxJywgZFxuICAgIHAuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC5uYW1lXG4gICAgICAuYXR0clxuICAgICAgICBjbGFzczogKGQpIC0+IGQuZGlyXG4gICAgICAgIHg6IChkKSAtPiBpZiBkLmRpciBpcyAnaW4nIHRoZW4gZC54ICsgNyBlbHNlIGQueCAtIDdcbiAgICAgICAgeTogKGQpIC0+IGQueSArIDVcblxuICAgIHdpcmVzLmVudGVyKCkuaW5zZXJ0KCdwYXRoJywgJ2cnKSAjIHVzZXMgaW5zZXJ0IHRvIG1vdmUgdG8gYmFjayByaWdodCBhd2F5XG4gICAgICAuYXR0ciBjbGFzczogJ3dpcmUnLCBkOiBkaWFnXG5cbiAgICBnYWRnZXRzLmF0dHIgdHJhbnNmb3JtOiAoZCkgLT4gXCJ0cmFuc2xhdGUoI3tkLnh9LCN7ZC55fSlcIlxuIl19
