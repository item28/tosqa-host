(function() {
  var d, gadgetDefs, ins, n, ng, outs, p, step, yIn, yOut, _i, _j, _len, _len1, _ref, _ref1;

  ng = angular.module('myApp');

  gadgetDefs = {
    Feed: {
      width: 200,
      shade: 'white',
      pins: [
        {
          name: 'Out',
          dir: 'out'
        }
      ]
    },
    Pipe: {
      name: 'Ceci est une pipe',
      width: 160,
      pins: [
        {
          name: 'In',
          dir: 'in'
        }, {
          name: 'Out',
          dir: 'out'
        }
      ]
    },
    Printer: {
      width: 120,
      shade: 'lightblue',
      pins: [
        {
          name: 'In',
          dir: 'in'
        }, {
          name: 'In2',
          dir: 'in'
        }
      ]
    }
  };

  for (n in gadgetDefs) {
    d = gadgetDefs[n];
    d.name || (d.name = n);
    ins = 0;
    _ref = d.pins;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      p = _ref[_i];
      p.x = d.width / 2;
      if (p.dir === 'in') {
        p.x = -p.x;
        ++ins;
      }
    }
    outs = d.pins.length - ins;
    step = 16;
    yIn = -(ins - 1) * step / 2;
    yOut = -(outs - 1) * step / 2;
    _ref1 = d.pins;
    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
      p = _ref1[_j];
      if (p.dir === 'in') {
        p.y = yIn;
        yIn += step;
      } else {
        p.y = yOut;
        yOut += step;
      }
    }
    d.height = 30 + step * (ins > outs ? ins : outs);
  }

  ng.directive('circuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        data: '='
      },
      link: function(scope, elem, attr) {
        var diag, findPin, g, gadgetDrag, gadgets, pins, svg, wires, _k, _l, _len2, _len3, _ref2, _ref3;
        svg = d3.select(elem[0]).append('svg').attr({
          height: "70%"
        });
        findPin = function(name) {
          var g, gid, pname, _k, _l, _len2, _len3, _ref2, _ref3, _ref4;
          _ref2 = name.split('.'), gid = _ref2[0], pname = _ref2[1];
          _ref3 = scope.data.gadgets;
          for (_k = 0, _len2 = _ref3.length; _k < _len2; _k++) {
            g = _ref3[_k];
            if (gid === g.id) {
              _ref4 = g.def.pins;
              for (_l = 0, _len3 = _ref4.length; _l < _len3; _l++) {
                p = _ref4[_l];
                if (pname === p.name) {
                  return {
                    y: g.x + p.x + .5,
                    x: g.y + p.y + .5,
                    g: g,
                    p: p
                  };
                }
              }
            }
          }
        };
        _ref2 = scope.data.gadgets;
        for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
          d = _ref2[_k];
          d.def = gadgetDefs[d.type];
          d.hw = d.def.width / 2;
          d.hh = d.def.height / 2;
        }
        _ref3 = scope.data.wires;
        for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {
          d = _ref3[_l];
          d.source = findPin(d.from);
          d.target = findPin(d.to);
        }
        gadgets = svg.selectAll('.gadget').data(scope.data.gadgets);
        wires = svg.selectAll('.wire').data(scope.data.wires);
        diag = d3.svg.diagonal().projection(function(d) {
          return [d.y, d.x];
        });
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          return this.parentNode.appendChild(this);
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
          return wires.filter(function(w) {
            return w.source.g === d || w.target.g === d;
          }).each(function(d) {
            d.source = findPin(d.from);
            return d.target = findPin(d.to);
          }).attr({
            d: diag
          });
        }).on('dragend', function(d) {
          return console.log('save gadget', d);
        });
        g = gadgets.enter().append('g').call(gadgetDrag).attr({
          "class": 'gadget'
        });
        g.append('rect').each(function(d) {
          return d3.select(this).attr({
            "class": 'outline',
            x: 0.5 - d.hw,
            y: 0.5 - d.hh,
            width: 2 * d.hw,
            height: 2 * d.hh
          });
        }).style({
          fill: function(d) {
            return d.def.shade;
          }
        });
        g.append('text').text(function(d) {
          return d.title;
        }).attr({
          "class": 'title',
          y: function(d) {
            return 12 - d.hh;
          }
        });
        g.append('text').text(function(d) {
          return d.def.name;
        }).attr({
          "class": 'type',
          y: function(d) {
            return -4 + d.hh;
          }
        });
        pins = gadgets.selectAll('rect .pin').data(function(d) {
          return d.def.pins;
        });
        p = pins.enter();
        p.append('circle').attr({
          "class": 'pin',
          cx: (function(d) {
            return d.x + .5;
          }),
          cy: (function(d) {
            return d.y + .5;
          }),
          r: 3
        }).on('mousedown', function(d) {
          return console.log('c1', d);
        });
        p.append('text').text(function(d) {
          return d.name;
        }).attr({
          "class": function(d) {
            return d.dir;
          },
          x: function(d) {
            if (d.dir === 'in') {
              return d.x + 7;
            } else {
              return d.x - 7;
            }
          },
          y: function(d) {
            return d.y + 5;
          }
        });
        wires.enter().insert('path', 'g').attr({
          "class": 'wire',
          d: diag
        });
        return gadgets.attr({
          transform: function(d) {
            return "translate(" + d.x + "," + d.y + ")";
          }
        });
      }
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSxxRkFBQTs7QUFBQSxFQUFBLEVBQUEsR0FBSyxPQUFPLENBQUMsTUFBUixDQUFlLE9BQWYsQ0FBTCxDQUFBOztBQUFBLEVBRUEsVUFBQSxHQUNFO0FBQUEsSUFBQSxJQUFBLEVBQ0U7QUFBQSxNQUFBLEtBQUEsRUFBTyxHQUFQO0FBQUEsTUFDQSxLQUFBLEVBQU8sT0FEUDtBQUFBLE1BRUEsSUFBQSxFQUFNO1FBQ0o7QUFBQSxVQUFFLElBQUEsRUFBTSxLQUFSO0FBQUEsVUFBZSxHQUFBLEVBQUssS0FBcEI7U0FESTtPQUZOO0tBREY7QUFBQSxJQU1BLElBQUEsRUFDRTtBQUFBLE1BQUEsSUFBQSxFQUFNLG1CQUFOO0FBQUEsTUFDQSxLQUFBLEVBQU8sR0FEUDtBQUFBLE1BRUEsSUFBQSxFQUFNO1FBQ0o7QUFBQSxVQUFFLElBQUEsRUFBTSxJQUFSO0FBQUEsVUFBYyxHQUFBLEVBQUssSUFBbkI7U0FESSxFQUVKO0FBQUEsVUFBRSxJQUFBLEVBQU0sS0FBUjtBQUFBLFVBQWUsR0FBQSxFQUFLLEtBQXBCO1NBRkk7T0FGTjtLQVBGO0FBQUEsSUFhQSxPQUFBLEVBQ0U7QUFBQSxNQUFBLEtBQUEsRUFBTyxHQUFQO0FBQUEsTUFDQSxLQUFBLEVBQU8sV0FEUDtBQUFBLE1BRUEsSUFBQSxFQUFNO1FBQ0o7QUFBQSxVQUFFLElBQUEsRUFBTSxJQUFSO0FBQUEsVUFBYyxHQUFBLEVBQUssSUFBbkI7U0FESSxFQUVKO0FBQUEsVUFBRSxJQUFBLEVBQU0sS0FBUjtBQUFBLFVBQWUsR0FBQSxFQUFLLElBQXBCO1NBRkk7T0FGTjtLQWRGO0dBSEYsQ0FBQTs7QUF5QkEsT0FBQSxlQUFBO3NCQUFBO0FBQ0UsSUFBQSxDQUFDLENBQUMsU0FBRixDQUFDLENBQUMsT0FBUyxFQUFYLENBQUE7QUFBQSxJQUNBLEdBQUEsR0FBTSxD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QU8sQ0FBQyxDQUFDLElBQVQ7VUFBQSxDQUFQO0FBQUEsVUFDQSxDQUFBLEVBQUcsU0FBQyxDQUFELEdBQUE7QUFBTyxZQUFBLElBQUcsQ0FBQyxDQUFDLEdBQUYsS0FBUyxJQUFaO3FCQUFzQixDQUFDLENBQUMsQ0FBRixHQUFNLEVBQTVCO2FBQUEsTUFBQTtxQkFBbUMsQ0FBQyxDQUFDLENBQUYsR0FBTSxFQUF6QzthQUFQO1VBQUEsQ0FESDtBQUFBLFVBRUEsQ0FBQSxFQUFHLFNBQUMsQ0FBRCxHQUFBO21CQUFPLENBQUMsQ0FBQyxDQUFGLEdBQU0sRUFBYjtVQUFBLENBRkg7U0FGSixDQXBFQSxDQUFBO0FBQUEsUUEwRUEsS0FBSyxDQUFDLEtBQU4sQ0FBQSxDQUFhLENBQUMsTUFBZCxDQUFxQixNQUFyQixFQUE2QixHQUE3QixDQUNFLENBQUMsSUFESCxDQUNRO0FBQUEsVUFBQSxPQUFBLEVBQU8sTUFBUDtBQUFBLFVBQWUsQ0FBQSxFQUFHLElBQWxCO1NBRFIsQ0ExRUEsQ0FBQTtlQTZFQSxPQUFPLENBQUMsSUFBUixDQUFhO0FBQUEsVUFBQSxTQUFBLEVBQVcsU0FBQyxDQUFELEdBQUE7bUJBQVEsWUFBQSxHQUFXLENBQUMsQ0FBQyxDQUFiLEdBQWdCLEdBQWhCLEdBQWtCLENBQUMsQ0FBQyxDQUFwQixHQUF1QixJQUEvQjtVQUFBLENBQVg7U0FBYixFQTlFSTtNQUFBLENBTE47TUFENEI7RUFBQSxDQUE5QixDQTlDQSxDQUFBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJuZyA9IGFuZ3VsYXIubW9kdWxlICdteUFwcCdcblxuZ2FkZ2V0RGVmcyA9XG4gIEZlZWQ6XG4gICAgd2lkdGg6IDIwMFxuICAgIHNoYWRlOiAnd2hpdGUnXG4gICAgcGluczogW1xuICAgICAgeyBuYW1lOiAnT3V0JywgZGlyOiAnb3V0JyB9XG4gICAgXVxuICBQaXBlOlxuICAgIG5hbWU6ICdDZWNpIGVzdCB1bmUgcGlwZSdcbiAgICB3aWR0aDogMTYwXG4gICAgcGluczogW1xuICAgICAgeyBuYW1lOiAnSW4nLCBkaXI6ICdpbicgfVxuICAgICAgeyBuYW1lOiAnT3V0JywgZGlyOiAnb3V0JyB9XG4gICAgXVxuICBQcmludGVyOlxuICAgIHdpZHRoOiAxMjBcbiAgICBzaGFkZTogJ2xpZ2h0Ymx1ZSdcbiAgICBwaW5zOiBbXG4gICAgICB7IG5hbWU6ICdJbicsIGRpcjogJ2luJyB9XG4gICAgICB7IG5hbWU6ICdJbjInLCBkaXI6ICdpbicgfVxuICAgIF1cblxuIyBwcmUtY2FsY3VsYXRlIHNpemVzIGFuZCByZWxhdGl2ZSBwaW4gY29vcmRpbmF0ZXNcbmZvciBuLCBkIG9mIGdhZGdldERlZnNcbiAgZC5uYW1lIG9yPSBuXG4gIGlucyA9IDBcbiAgZm9yIHAgaW4gZC5waW5zXG4gICAgcC54ID0gZC53aWR0aCAvIDJcbiAgICBpZiBwLmRpciBpcyAnaW4nXG4gICAgICBwLnggPSAtcC54XG4gICAgICArK2luc1xuICBvdXRzID0gZC5waW5zLmxlbmd0aCAtIGluc1xuICBzdGVwID0gMTZcbiAgeUluID0gLSAoaW5zIC0gMSkgKiBzdGVwIC8gMlxuICB5T3V0ID0gLSAob3V0cyAtIDEpICogc3RlcCAvIDJcbiAgZm9yIHAgaW4gZC5waW5zXG4gICAgaWYgcC5kaXIgaXMgJ2luJ1xuICAgICAgcC55ID0geUluXG4gICAgICB5SW4gKz0gc3RlcFxuICAgIGVsc2VcbiAgICAgIHAueSA9IHlPdXRcbiAgICAgIHlPdXQgKz0gc3RlcFxuICBkLmhlaWdodCA9IDMwICsgc3RlcCAqIChpZiBpbnMgPiBvdXRzIHRoZW4gaW5zIGVsc2Ugb3V0cylcblxubmcuZGlyZWN0aXZlICdjaXJjdWl0RWRpdG9yJywgLT5cbiAgcmVzdHJpY3Q6ICdFJ1xuICBcbiAgc2NvcGU6XG4gICAgZGF0YTogJz0nXG4gICAgXG4gIGxpbms6IChzY29wZSwgZWxlbSwgYXR0cikgLT5cbiAgICBzdmcgPSBkMy5zZWxlY3QoZWxlbVswXSkuYXBwZW5kICdzdmcnXG4gICAgICAuYXR0ciBoZWlnaHQ6IFwiNzAlXCJcblxuICAgIGZpbmRQaW4gPSAobmFtZSkgLT5cbiAgICAgIFtnaWQscG5hbWVdID0gbmFtZS5zcGxpdCAnLidcbiAgICAgIGZvciBnIGluIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgICBpZiBnaWQgaXMgZy5pZFxuICAgICAgICAgIGZvciBwIGluIGcuZGVmLnBpbnNcbiAgICAgICAgICAgIGlmIHBuYW1lIGlzIHAubmFtZVxuICAgICAgICAgICAgICAjIHJldmVyc2VzIHggYW5kIHkgYW5kIHVzZXMgcHJvamVjdGlvbiB0byBnZXQgaG9yaXpvbnRhbCBzcGxpbmVzXG4gICAgICAgICAgICAgIHJldHVybiB5OiBnLnggKyBwLnggKyAuNSwgeDogZy55ICsgcC55ICsgLjUsIGc6IGcsIHA6IHBcblxuICAgIGZvciBkIGluIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgZC5kZWYgPSBnYWRnZXREZWZzW2QudHlwZV1cbiAgICAgIGQuaHcgPSBkLmRlZi53aWR0aCAvIDJcbiAgICAgIGQuaGggPSBkLmRlZi5oZWlnaHQgLyAyXG5cbiAgICBmb3IgZCBpbiBzY29wZS5kYXRhLndpcmVzXG4gICAgICBkLnNvdXJjZSA9IGZpbmRQaW4gZC5mcm9tXG4gICAgICBkLnRhcmdldCA9IGZpbmRQaW4gZC50b1xuXG4gICAgZ2FkZ2V0cyA9IHN2Zy5zZWxlY3RBbGwoJy5nYWRnZXQnKS5kYXRhKHNjb3BlLmRhdGEuZ2FkZ2V0cylcbiAgICB3aXJlcyA9IHN2Zy5zZWxlY3RBbGwoJy53aXJlJykuZGF0YShzY29wZS5kYXRhLndpcmVzKVxuXG4gICAgZGlhZyA9IGQzLnN2Zy5kaWFnb25hbCgpXG4gICAgICAucHJvamVjdGlvbiAoZCkgLT4gW2QueSwgZC54XSAjIHVuZG8gdGhlIHgveSByZXZlcnNhbCBmcm9tIGZpbmRQaW5cbiAgICBcbiAgICBnYWRnZXREcmFnID0gZDMuYmVoYXZpb3IuZHJhZygpXG4gICAgICAub3JpZ2luIE9iamVjdFxuICAgICAgLm9uICdkcmFnc3RhcnQnLCAoZCkgLT5cbiAgICAgICAgQHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQgQCAjIG1vdmUgdG8gZnJvbnRcbiAgICAgIC5vbiAnZHJhZycsIChkKSAtPlxuICAgICAgICBkLnggPSBkMy5ldmVudC54IHwgMCAjIHN0YXkgb24gaW50IGNvb3JkaW5hdGVzXG4gICAgICAgIGQueSA9IGQzLmV2ZW50LnkgfCAwICMgc3RheSBvbiBpbnQgY29vcmRpbmF0ZXNcbiAgICAgICAgZDMuc2VsZWN0KEApLmF0dHJcbiAgICAgICAgICB0cmFuc2Zvcm06IChkKSAtPiBcInRyYW5zbGF0ZSgje2QueH0sI3tkLnl9KVwiXG4gICAgICAgICMgcmVjYWxjdWxhdGUgZW5kcG9pbnRzIGFuZCByZWRyYXcgYWxsIHdpcmVzIGF0dGFjaGVkIHRvIHRoaXMgZ2FkZ2V0XG4gICAgICAgIHdpcmVzLmZpbHRlciAodykgLT4gdy5zb3VyY2UuZyBpcyBkIG9yIHcudGFyZ2V0LmcgaXMgZFxuICAgICAgICAgIC5lYWNoIChkKSAtPlxuICAgICAgICAgICAgZC5zb3VyY2UgPSBmaW5kUGluIGQuZnJvbVxuICAgICAgICAgICAgZC50YXJnZXQgPSBmaW5kUGluIGQudG9cbiAgICAgICAgICAuYXR0ciBkOiBkaWFnXG4gICAgICAub24gJ2RyYWdlbmQnLCAoZCkgLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ3NhdmUgZ2FkZ2V0JywgZCAjIFRPRE86IHNhdmUgdG8gc2VydmVyXG5cbiAgICBnID0gZ2FkZ2V0cy5lbnRlcigpLmFwcGVuZCgnZycpLmNhbGwoZ2FkZ2V0RHJhZylcbiAgICAgIC5hdHRyIGNsYXNzOiAnZ2FkZ2V0J1xuICAgIGcuYXBwZW5kKCdyZWN0JylcbiAgICAgIC5lYWNoIChkKSAtPlxuICAgICAgICBkMy5zZWxlY3QoQCkuYXR0clxuICAgICAgICAgIGNsYXNzOiAnb3V0bGluZSdcbiAgICAgICAgICAjIDFweCBsaW5lcyByZW5kZXIgc2hhcnBseSB3aGVuIG9uIGEgMC41cHggb2Zmc2V0XG4gICAgICAgICAgeDogMC41IC0gZC5od1xuICAgICAgICAgIHk6IDAuNSAtIGQuaGhcbiAgICAgICAgICB3aWR0aDogMiAqIGQuaHdcbiAgICAgICAgICBoZWlnaHQ6IDIgKiBkLmhoXG4gICAgICAuc3R5bGUgZmlsbDogKGQpIC0+IGQuZGVmLnNoYWRlXG4gICAgZy5hcHBlbmQoJ3RleHQnKS50ZXh0IChkKSAtPiBkLnRpdGxlXG4gICAgICAuYXR0ciBjbGFzczogJ3RpdGxlJywgeTogKGQpIC0+IDEyIC0gZC5oaFxuICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC5kZWYubmFtZVxuICAgICAgLmF0dHIgY2xhc3M6ICd0eXBlJywgeTogKGQpIC0+IC00ICsgZC5oaFxuICAgICAgICBcbiAgICBwaW5zID0gZ2FkZ2V0cy5zZWxlY3RBbGwoJ3JlY3QgLnBpbicpLmRhdGEgKGQpIC0+IGQuZGVmLnBpbnNcbiAgICBwID0gcGlucy5lbnRlcigpXG4gICAgcC5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAuYXR0ciBjbGFzczogJ3BpbicsIGN4OiAoKGQpIC0+IGQueCsuNSksIGN5OiAoKGQpIC0+IGQueSsuNSksIHI6IDNcbiAgICAgIC5vbiAnbW91c2Vkb3duJywgKGQpIC0+XG4gICAgICAgIGNvbnNvbGUubG9nICdjMScsIGRcbiAgICBwLmFwcGVuZCgndGV4dCcpLnRleHQgKGQpIC0+IGQubmFtZVxuICAgICAgLmF0dHJcbiAgICAgICAgY2xhc3M6IChkKSAtPiBkLmRpclxuICAgICAgICB4OiAoZCkgLT4gaWYgZC5kaXIgaXMgJ2luJyB0aGVuIGQueCArIDcgZWxzZSBkLnggLSA3XG4gICAgICAgIHk6IChkKSAtPiBkLnkgKyA1XG5cbiAgICB3aXJlcy5lbnRlcigpLmluc2VydCgncGF0aCcsICdnJykgIyB1c2VzIGluc2VydCB0byBtb3ZlIHRvIGJhY2sgcmlnaHQgYXdheVxuICAgICAgLmF0dHIgY2xhc3M6ICd3aXJlJywgZDogZGlhZ1xuXG4gICAgZ2FkZ2V0cy5hdHRyIHRyYW5zZm9ybTogKGQpIC0+IFwidHJhbnNsYXRlKCN7ZC54fSwje2QueX0pXCJcbiJdfQ==
