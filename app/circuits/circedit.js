(function() {
  var gadgetTypes, ng;

  ng = angular.module('myApp');

  gadgetTypes = {
    Pipe: {
      width: 80,
      height: 60,
      shade: 'lightyellow',
      pins: [
        {
          name: 'In',
          type: 'i',
          x: -40,
          y: 0
        }, {
          name: 'Out',
          type: 'o',
          x: 40,
          y: 0
        }
      ]
    },
    Printer: {
      width: 120,
      height: 40,
      shade: 'lightblue',
      pins: [
        {
          name: 'In',
          type: 'i',
          x: -60,
          y: 0
        }
      ]
    }
  };

  ng.directive('circuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        data: '='
      },
      link: function(scope, elem, attr) {
        var d, diag, findPin, g, gadgetDrag, gadgets, pins, svg, wires, _, _ref, _ref1;
        svg = d3.select(elem[0]).append('svg').attr({
          height: "75%"
        });
        findPin = function(name) {
          var g, gid, p, pname, _i, _j, _len, _len1, _ref, _ref1, _ref2;
          _ref = name.split('.'), gid = _ref[0], pname = _ref[1];
          _ref1 = scope.data.gadgets;
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            g = _ref1[_i];
            if (gid === g.id) {
              _ref2 = g.gt.pins;
              for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
                p = _ref2[_j];
                if (pname === p.name) {
                  return {
                    y: g.x + p.x + .5,
                    x: g.y + p.y + .5,
                    g: g,
                    p: p
                  };
                }
              }
            }
          }
        };
        _ref = scope.data.gadgets;
        for (_ in _ref) {
          d = _ref[_];
          d.gt = gadgetTypes[d.type];
          d.hw = d.gt.width / 2;
          d.hh = d.gt.height / 2;
        }
        _ref1 = scope.data.wires;
        for (_ in _ref1) {
          d = _ref1[_];
          d.source = findPin(d.from);
          d.target = findPin(d.to);
        }
        gadgets = svg.selectAll('.gadget').data(scope.data.gadgets);
        wires = svg.selectAll('.wire').data(scope.data.wires);
        diag = d3.svg.diagonal().projection(function(d) {
          return [d.y, d.x];
        });
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          return this.parentNode.appendChild(this);
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
          return wires.filter(function(w) {
            return w.source.g === d || w.target.g === d;
          }).each(function(d) {
            d.source = findPin(d.from);
            return d.target = findPin(d.to);
          }).attr({
            d: diag
          });
        }).on('dragend', function(d) {
          return console.log('save gadget', d);
        });
        g = gadgets.enter().append('g').call(gadgetDrag).attr({
          "class": 'gadget'
        });
        g.append('rect').each(function(d) {
          return d3.select(this).attr({
            "class": 'outline',
            x: 0.5 - d.hw,
            y: 0.5 - d.hh,
            width: 2 * d.hw,
            height: 2 * d.hh
          });
        }).style({
          fill: function(d) {
            return d.gt.shade;
          }
        });
        g.append('text').text(function(d) {
          return d.title;
        }).attr({
          "class": 'title',
          y: function(d) {
            return 12 - d.hh;
          }
        });
        g.append('text').text(function(d) {
          return d.type;
        }).attr({
          "class": 'type',
          y: function(d) {
            return -4 + d.hh;
          }
        });
        pins = gadgets.selectAll('rect .pin').data(function(d) {
          return d.gt.pins;
        });
        pins.enter().append('circle').attr({
          "class": 'pin',
          cx: (function(d) {
            return d.x + .5;
          }),
          cy: (function(d) {
            return d.y + .5;
          }),
          r: 3
        }).on('mousedown', function(d) {
          return console.log('c1', d);
        });
        wires.enter().insert('path', 'g').attr({
          "class": 'wire',
          d: diag
        });
        return gadgets.attr({
          transform: function(d) {
            return "translate(" + d.x + "," + d.y + ")";
          }
        });
      }
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSxlQUFBOztBQUFBLEVBQUEsRUFBQSxHQUFLLE9BQU8sQ0FBQyxNQUFSLENBQWUsT0FBZixDQUFMLENBQUE7O0FBQUEsRUFFQSxXQUFBLEdBQ0U7QUFBQSxJQUFBLElBQUEsRUFDRTtBQUFBLE1BQUEsS0FBQSxFQUFPLEVBQVA7QUFBQSxNQUNBLE1BQUEsRUFBUSxFQURSO0FBQUEsTUFFQSxLQUFBLEVBQU8sYUFGUDtBQUFBLE1BR0EsSUFBQSxFQUFNO1FBQ0o7QUFBQSxVQUFFLElBQUEsRUFBSyxJQUFQO0FBQUEsVUFBYSxJQUFBLEVBQUssR0FBbEI7QUFBQSxVQUF1QixDQUFBLEVBQUcsQ0FBQSxFQUExQjtBQUFBLFVBQStCLENBQUEsRUFBRyxDQUFsQztTQURJLEVBRUo7QUFBQSxVQUFFLElBQUEsRUFBSyxLQUFQO0FBQUEsVUFBYyxJQUFBLEVBQUssR0FBbkI7QUFBQSxVQUF3QixDQUFBLEVBQUcsRUFBM0I7QUFBQSxVQUErQixDQUFBLEVBQUcsQ0FBbEM7U0FGSTtPQUhOO0tBREY7QUFBQSxJQVFBLE9BQUEsRUFDRTtBQUFBLE1BQUEsS0FBQSxFQUFPLEdBQVA7QUFBQSxNQUNBLE1BQUEsRUFBUSxFQURSO0FBQUEsTUFFQSxLQUFBLEVBQU8sV0FGUDtBQUFBLE1BR0EsSUFBQSxFQUFNO1FBQ0o7QUFBQSxVQUFFLElBQUEsRUFBSyxJQUFQO0FBQUEsVUFBYSxJQUFBLEVBQUssR0FBbEI7QUFBQSxVQUF1QixDQUFBLEVBQUcsQ0FBQSxFQUExQjtBQUFBLFVBQStCLENBQUEsRUFBRyxDQUFsQztTQURJO09BSE47S0FURjtHQUhGLENBQUE7O0FBQUEsRUFtQkEsRUFBRSxDQUFDLFNBQUgsQ0FBYSxlQUFiLEVBQThCLFNBQUEsR0FBQTtXQUM1QjtBQUFBLE1BQUEsUUFBQSxFQUFVLEdBQVY7QUFBQSxNQUVBLEtB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QVcsQ0FBQyxDQUFDLENBQWIsR0FBZ0IsR0FBaEIsR0FBa0IsQ0FBQyxDQUFDLENBQXBCLEdBQXVCLElBQS9CO1VBQUEsQ0FBWDtTQUFiLEVBeEVJO01BQUEsQ0FMTjtNQUQ0QjtFQUFBLENBQTlCLENBbkJBLENBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIm5nID0gYW5ndWxhci5tb2R1bGUgJ215QXBwJ1xuXG5nYWRnZXRUeXBlcyA9XG4gIFBpcGU6XG4gICAgd2lkdGg6IDgwXG4gICAgaGVpZ2h0OiA2MFxuICAgIHNoYWRlOiAnbGlnaHR5ZWxsb3cnXG4gICAgcGluczogW1xuICAgICAgeyBuYW1lOidJbicsIHR5cGU6J2knLCB4OiAtNDAsIHk6IDAgfVxuICAgICAgeyBuYW1lOidPdXQnLCB0eXBlOidvJywgeDogNDAsIHk6IDAgfVxuICAgIF1cbiAgUHJpbnRlcjpcbiAgICB3aWR0aDogMTIwXG4gICAgaGVpZ2h0OiA0MFxuICAgIHNoYWRlOiAnbGlnaHRibHVlJ1xuICAgIHBpbnM6IFtcbiAgICAgIHsgbmFtZTonSW4nLCB0eXBlOidpJywgeDogLTYwLCB5OiAwIH1cbiAgICBdXG5cbm5nLmRpcmVjdGl2ZSAnY2lyY3VpdEVkaXRvcicsIC0+XG4gIHJlc3RyaWN0OiAnRSdcbiAgXG4gIHNjb3BlOlxuICAgIGRhdGE6ICc9J1xuICAgIFxuICBsaW5rOiAoc2NvcGUsIGVsZW0sIGF0dHIpIC0+XG4gICAgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZCAnc3ZnJ1xuICAgICAgLmF0dHIgaGVpZ2h0OiBcIjc1JVwiXG5cbiAgICBmaW5kUGluID0gKG5hbWUpIC0+XG4gICAgICBbZ2lkLHBuYW1lXSA9IG5hbWUuc3BsaXQgJy4nXG4gICAgICBmb3IgZyBpbiBzY29wZS5kYXRhLmdhZGdldHNcbiAgICAgICAgaWYgZ2lkIGlzIGcuaWRcbiAgICAgICAgICBmb3IgcCBpbiBnLmd0LnBpbnNcbiAgICAgICAgICAgIGlmIHBuYW1lIGlzIHAubmFtZVxuICAgICAgICAgICAgICAjIHJldmVyc2VzIHggYW5kIHkgYW5kIHVzZXMgcHJvamVjdGlvbiB0byBnZXQgaG9yaXpvbnRhbCBzcGxpbmVzXG4gICAgICAgICAgICAgIHJldHVybiB5OiBnLnggKyBwLnggKyAuNSwgeDogZy55ICsgcC55ICsgLjUsIGc6IGcsIHA6IHBcblxuICAgIGZvciBfLCBkIG9mIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgZC5ndCA9IGdhZGdldFR5cGVzW2QudHlwZV1cbiAgICAgIGQuaHcgPSBkLmd0LndpZHRoIC8gMlxuICAgICAgZC5oaCA9IGQuZ3QuaGVpZ2h0IC8gMlxuXG4gICAgZm9yIF8sIGQgb2Ygc2NvcGUuZGF0YS53aXJlc1xuICAgICAgZC5zb3VyY2UgPSBmaW5kUGluIGQuZnJvbVxuICAgICAgZC50YXJnZXQgPSBmaW5kUGluIGQudG9cblxuICAgIGdhZGdldHMgPSBzdmcuc2VsZWN0QWxsKCcuZ2FkZ2V0JykuZGF0YShzY29wZS5kYXRhLmdhZGdldHMpXG4gICAgd2lyZXMgPSBzdmcuc2VsZWN0QWxsKCcud2lyZScpLmRhdGEoc2NvcGUuZGF0YS53aXJlcylcblxuICAgIGRpYWcgPSBkMy5zdmcuZGlhZ29uYWwoKVxuICAgICAgLnByb2plY3Rpb24gKGQpIC0+IFtkLnksIGQueF0gIyB1bmRvIHRoZSB4L3kgcmV2ZXJzYWwgZnJvbSBmaW5kUGluXG4gICAgXG4gICAgZ2FkZ2V0RHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgLm9yaWdpbiBPYmplY3RcbiAgICAgIC5vbiAnZHJhZ3N0YXJ0JywgKGQpIC0+XG4gICAgICAgIEBwYXJlbnROb2RlLmFwcGVuZENoaWxkIEAgIyBtb3ZlIHRvIGZyb250XG4gICAgICAub24gJ2RyYWcnLCAoZCkgLT5cbiAgICAgICAgZC54ID0gZDMuZXZlbnQueCB8IDAgIyBzdGF5IG9uIGludCBjb29yZGluYXRlc1xuICAgICAgICBkLnkgPSBkMy5ldmVudC55IHwgMCAjIHN0YXkgb24gaW50IGNvb3JkaW5hdGVzXG4gICAgICAgIGQzLnNlbGVjdChAKS5hdHRyXG4gICAgICAgICAgdHJhbnNmb3JtOiAoZCkgLT4gXCJ0cmFuc2xhdGUoI3tkLnh9LCN7ZC55fSlcIlxuICAgICAgICAjIHJlY2FsY3VsYXRlIGVuZHBvaW50cyBhbmQgcmVkcmF3IGFsbCB3aXJlcyBhdHRhY2hlZCB0byB0aGlzIGdhZGdldFxuICAgICAgICB3aXJlcy5maWx0ZXIgKHcpIC0+IHcuc291cmNlLmcgaXMgZCBvciB3LnRhcmdldC5nIGlzIGRcbiAgICAgICAgICAuZWFjaCAoZCkgLT5cbiAgICAgICAgICAgIGQuc291cmNlID0gZmluZFBpbiBkLmZyb21cbiAgICAgICAgICAgIGQudGFyZ2V0ID0gZmluZFBpbiBkLnRvXG4gICAgICAgICAgLmF0dHIgZDogZGlhZ1xuICAgICAgLm9uICdkcmFnZW5kJywgKGQpIC0+XG4gICAgICAgIGNvbnNvbGUubG9nICdzYXZlIGdhZGdldCcsIGQgIyBUT0RPOiBzYXZlIHRvIHNlcnZlclxuXG4gICAgZyA9IGdhZGdldHMuZW50ZXIoKS5hcHBlbmQoJ2cnKS5jYWxsKGdhZGdldERyYWcpXG4gICAgICAuYXR0ciBjbGFzczogJ2dhZGdldCdcbiAgICBnLmFwcGVuZCgncmVjdCcpXG4gICAgICAuZWFjaCAoZCkgLT5cbiAgICAgICAgZDMuc2VsZWN0KEApLmF0dHJcbiAgICAgICAgICBjbGFzczogJ291dGxpbmUnXG4gICAgICAgICAgIyAxcHggbGluZXMgcmVuZGVyIHNoYXJwbHkgd2hlbiBvbiBhIDAuNXB4IG9mZnNldFxuICAgICAgICAgIHg6IDAuNSAtIGQuaHdcbiAgICAgICAgICB5OiAwLjUgLSBkLmhoXG4gICAgICAgICAgd2lkdGg6IDIgKiBkLmh3XG4gICAgICAgICAgaGVpZ2h0OiAyICogZC5oaFxuICAgICAgLnN0eWxlIGZpbGw6IChkKSAtPiBkLmd0LnNoYWRlXG4gICAgZy5hcHBlbmQoJ3RleHQnKS50ZXh0IChkKSAtPiBkLnRpdGxlXG4gICAgICAuYXR0ciBjbGFzczogJ3RpdGxlJywgeTogKGQpIC0+IDEyIC0gZC5oaFxuICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC50eXBlXG4gICAgICAuYXR0ciBjbGFzczogJ3R5cGUnLCB5OiAoZCkgLT4gLTQgKyBkLmhoXG4gICAgICAgIFxuICAgIHBpbnMgPSBnYWRnZXRzLnNlbGVjdEFsbCgncmVjdCAucGluJykuZGF0YSAoZCkgLT4gZC5ndC5waW5zXG4gICAgcGlucy5lbnRlcigpLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgIC5hdHRyIGNsYXNzOiAncGluJywgY3g6ICgoZCkgLT4gZC54Ky41KSwgY3k6ICgoZCkgLT4gZC55Ky41KSwgcjogM1xuICAgICAgLm9uICdtb3VzZWRvd24nLCAoZCkgLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ2MxJywgZFxuXG4gICAgd2lyZXMuZW50ZXIoKS5pbnNlcnQoJ3BhdGgnLCAnZycpICMgdXNlcyBpbnNlcnQgdG8gbW92ZSB0byBiYWNrIHJpZ2h0IGF3YXlcbiAgICAgIC5hdHRyIGNsYXNzOiAnd2lyZScsIGQ6IGRpYWdcblxuICAgIGdhZGdldHMuYXR0ciB0cmFuc2Zvcm06IChkKSAtPiBcInRyYW5zbGF0ZSgje2QueH0sI3tkLnl9KVwiXG4iXX0=
