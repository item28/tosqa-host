(function() {
  var gadgetTypes, ng;

  ng = angular.module('myApp');

  gadgetTypes = {
    Pipe: {
      width: 80,
      height: 60,
      shade: 'lightyellow',
      pins: [
        {
          name: 'In',
          type: 'i',
          x: -40,
          y: 0
        }, {
          name: 'Out',
          type: 'o',
          x: 40,
          y: 0
        }
      ]
    },
    Printer: {
      width: 120,
      height: 40,
      shade: 'lightblue',
      pins: [
        {
          name: 'In',
          type: 'i',
          x: -60,
          y: 0
        }, {
          name: 'Out',
          type: 'o',
          x: 60,
          y: 0
        }
      ]
    }
  };

  ng.directive('circuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        data: '='
      },
      link: function(scope, elem, attr) {
        var diag, findPin, g, gadgetDrag, gadgets, pins, svg, wireDrag, wires;
        svg = d3.select(elem[0]).append('svg').attr({
          width: 900,
          height: 400
        });
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          return this.parentNode.appendChild(this);
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          return d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
        }).on('dragend', function(d) {
          return console.log('save gadget', d);
        });
        diag = d3.svg.diagonal();
        wireDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          console.log('wireDrag', d);
          this.parentNode.appendChild(this);
          return d3.event.sourceEvent.stopPropagation();
        }).on('drag', function(d) {
          d.x = d3.event.x;
          d.y = d3.event.y;
          d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
          return svg.selectAll('.wire').attr({
            d: diag
          });
        }).on('dragend', function(d) {
          return console.log('save wire', d);
        });
        gadgets = svg.selectAll('.gadget').data(scope.data.gadgets);
        g = gadgets.enter().append('g').call(gadgetDrag).attr({
          "class": 'gadget'
        }).each(function(d) {
          d.gt = gadgetTypes[d.type];
          d.hw = d.gt.width / 2;
          return d.hh = d.gt.height / 2;
        });
        g.append('rect').each(function(d) {
          return d3.select(this).attr({
            x: 0.5 - d.hw,
            y: 0.5 - d.hh,
            width: 2 * d.hw,
            height: 2 * d.hh
          });
        }).style({
          fill: function(d) {
            return d.gt.shade;
          }
        });
        g.append('text').text(function(d) {
          return d.title;
        }).attr({
          "class": 'title',
          y: function(d) {
            return 12 - d.hh;
          }
        });
        g.append('text').text(function(d) {
          return d.type;
        }).attr({
          "class": 'type',
          y: function(d) {
            return -4 + d.hh;
          }
        });
        pins = gadgets.selectAll('rect .pin').data(function(d) {
          return d.gt.pins;
        });
        pins.enter().append('circle').attr({
          "class": 'pin',
          cx: (function(d) {
            return d.x;
          }),
          cy: (function(d) {
            return d.y;
          }),
          r: 3
        }).on('mousedown', function(d) {
          return console.log('c1', d);
        });
        findPin = function(name) {
          var gid, p, pname, _i, _j, _len, _len1, _ref, _ref1, _ref2;
          _ref = name.split('.'), gid = _ref[0], pname = _ref[1];
          _ref1 = scope.data.gadgets;
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            g = _ref1[_i];
            if (gid === g.id) {
              _ref2 = g.gt.pins;
              for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
                p = _ref2[_j];
                if (pname === p.name) {
                  return {
                    x: g.x + p.x,
                    y: g.y + p.y,
                    g: g,
                    p: p
                  };
                }
              }
            }
          }
        };
        diag.source(function(d) {
          return findPin(d.from);
        });
        diag.target(function(d) {
          return findPin(d.to);
        });
        wires = svg.selectAll('.wire').data(scope.data.wires);
        wires.enter().append('path').attr({
          "class": 'wire',
          d: diag
        });
        wires.exit().remove();
        return gadgets.attr({
          transform: function(d) {
            return "translate(" + d.x + "," + d.y + ")";
          }
        });
      }
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSxlQUFBOztBQUFBLEVBQUEsRUFBQSxHQUFLLE9BQU8sQ0FBQyxNQUFSLENBQWUsT0FBZixDQUFMLENBQUE7O0FBQUEsRUFFQSxXQUFBLEdBQ0U7QUFBQSxJQUFBLElBQUEsRUFDRTtBQUFBLE1BQUEsS0FBQSxFQUFPLEVBQVA7QUFBQSxNQUNBLE1BQUEsRUFBUSxFQURSO0FBQUEsTUFFQSxLQUFBLEVBQU8sYUFGUDtBQUFBLE1BR0EsSUFBQSxFQUFNO1FBQ0o7QUFBQSxVQUFFLElBQUEsRUFBSyxJQUFQO0FBQUEsVUFBYSxJQUFBLEVBQUssR0FBbEI7QUFBQSxVQUF1QixDQUFBLEVBQUcsQ0FBQSxFQUExQjtBQUFBLFVBQStCLENBQUEsRUFBRyxDQUFsQztTQURJLEVBRUo7QUFBQSxVQUFFLElBQUEsRUFBSyxLQUFQO0FBQUEsVUFBYyxJQUFBLEVBQUssR0FBbkI7QUFBQSxVQUF3QixDQUFBLEVBQUcsRUFBM0I7QUFBQSxVQUErQixDQUFBLEVBQUcsQ0FBbEM7U0FGSTtPQUhOO0tBREY7QUFBQSxJQVFBLE9BQUEsRUFDRTtBQUFBLE1BQUEsS0FBQSxFQUFPLEdBQVA7QUFBQSxNQUNBLE1BQUEsRUFBUSxFQURSO0FBQUEsTUFFQSxLQUFBLEVBQU8sV0FGUDtBQUFBLE1BR0EsSUFBQSxFQUFNO1FBQ0o7QUFBQSxVQUFFLElBQUEsRUFBSyxJQUFQO0FBQUEsVUFBYSxJQUFBLEVBQUssR0FBbEI7QUFBQSxVQUF1QixDQUFBLEVBQUcsQ0FBQSxFQUExQjtBQUFBLFVBQStCLENBQUEsRUFBRyxDQUFsQztTQURJLEVBRUo7QUFBQSxVQUFFLElBQUEsRUFBSyxLQUFQO0FBQUEsVUFBYyxJQUFBLEVBQUssR0FBbkI7QUFBQSxVQUF3QixDQUFBLEVBQUcsRUFBM0I7QUFBQSxVQUErQixDQUFBLEVBQUcsQ0FBbEM7U0FGSTtP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QUFDLENBQUQsR0FBQTtpQkFBTyxPQUFBLENBQVEsQ0FBQyxDQUFDLElBQVYsRUFBUDtRQUFBLENBQVosQ0F4RUEsQ0FBQTtBQUFBLFFBeUVBLElBQUksQ0FBQyxNQUFMLENBQVksU0FBQyxDQUFELEdBQUE7aUJBQU8sT0FBQSxDQUFRLENBQUMsQ0FBQyxFQUFWLEVBQVA7UUFBQSxDQUFaLENBekVBLENBQUE7QUFBQSxRQTJFQSxLQUFBLEdBQVEsR0FBRyxDQUFDLFNBQUosQ0FBYyxPQUFkLENBQXNCLENBQUMsSUFBdkIsQ0FBNEIsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUF2QyxDQTNFUixDQUFBO0FBQUEsUUE0RUEsS0FBSyxDQUFDLEtBQU4sQ0FBQSxDQUFhLENBQUMsTUFBZCxDQUFxQixNQUFyQixDQUNFLENBQUMsSUFESCxDQUNRO0FBQUEsVUFBQSxPQUFBLEVBQU8sTUFBUDtBQUFBLFVBQWUsQ0FBQSxFQUFHLElBQWxCO1NBRFIsQ0E1RUEsQ0FBQTtBQUFBLFFBOEVBLEtBQUssQ0FBQyxJQUFOLENBQUEsQ0FBWSxDQUFDLE1BQWIsQ0FBQSxDQTlFQSxDQUFBO2VBZ0ZBLE9BQU8sQ0FBQyxJQUFSLENBQ0U7QUFBQSxVQUFBLFNBQUEsRUFBVyxTQUFDLENBQUQsR0FBQTttQkFBUSxZQUFBLEdBQVcsQ0FBQyxDQUFDLENBQWIsR0FBZ0IsR0FBaEIsR0FBa0IsQ0FBQyxDQUFDLENBQXBCLEdBQXVCLElBQS9CO1VBQUEsQ0FBWDtTQURGLEVBakZJO01BQUEsQ0FMTjtNQUQ0QjtFQUFBLENBQTlCLENBcEJBLENBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIm5nID0gYW5ndWxhci5tb2R1bGUgJ215QXBwJ1xuXG5nYWRnZXRUeXBlcyA9XG4gIFBpcGU6XG4gICAgd2lkdGg6IDgwXG4gICAgaGVpZ2h0OiA2MFxuICAgIHNoYWRlOiAnbGlnaHR5ZWxsb3cnXG4gICAgcGluczogW1xuICAgICAgeyBuYW1lOidJbicsIHR5cGU6J2knLCB4OiAtNDAsIHk6IDAgfVxuICAgICAgeyBuYW1lOidPdXQnLCB0eXBlOidvJywgeDogNDAsIHk6IDAgfVxuICAgIF1cbiAgUHJpbnRlcjpcbiAgICB3aWR0aDogMTIwXG4gICAgaGVpZ2h0OiA0MFxuICAgIHNoYWRlOiAnbGlnaHRibHVlJ1xuICAgIHBpbnM6IFtcbiAgICAgIHsgbmFtZTonSW4nLCB0eXBlOidpJywgeDogLTYwLCB5OiAwIH1cbiAgICAgIHsgbmFtZTonT3V0JywgdHlwZTonbycsIHg6IDYwLCB5OiAwIH1cbiAgICBdXG5cbm5nLmRpcmVjdGl2ZSAnY2lyY3VpdEVkaXRvcicsIC0+XG4gIHJlc3RyaWN0OiAnRSdcbiAgXG4gIHNjb3BlOlxuICAgIGRhdGE6ICc9J1xuICAgIFxuICBsaW5rOiAoc2NvcGUsIGVsZW0sIGF0dHIpIC0+XG4gICAgc3ZnID0gZDMuc2VsZWN0KGVsZW1bMF0pLmFwcGVuZCAnc3ZnJ1xuICAgICAgLmF0dHIgd2lkdGg6IDkwMCwgaGVpZ2h0OiA0MDBcblxuICAgIGdhZGdldERyYWcgPSBkMy5iZWhhdmlvci5kcmFnKClcbiAgICAgIC5vcmlnaW4gT2JqZWN0XG4gICAgICAub24gJ2RyYWdzdGFydCcsIChkKSAtPlxuICAgICAgICBAcGFyZW50Tm9kZS5hcHBlbmRDaGlsZCBAICMgbW92ZSB0byBmcm9udFxuICAgICAgLm9uICdkcmFnJywgKGQpIC0+XG4gICAgICAgIGQueCA9IGQzLmV2ZW50LnggfCAwICMgc3RheSBvbiBpbnQgY29vcmRpbmF0ZXNcbiAgICAgICAgZC55ID0gZDMuZXZlbnQueSB8IDAgIyBzdGF5IG9uIGludCBjb29yZGluYXRlc1xuICAgICAgICBkMy5zZWxlY3QoQCkuYXR0clxuICAgICAgICAgIHRyYW5zZm9ybTogKGQpIC0+IFwidHJhbnNsYXRlKCN7ZC54fSwje2QueX0pXCJcbiAgICAgIC5vbiAnZHJhZ2VuZCcsIChkKSAtPlxuICAgICAgICBjb25zb2xlLmxvZyAnc2F2ZSBnYWRnZXQnLCBkICMgVE9ETzogc2F2ZSB0byBzZXJ2ZXJcblxuICAgIGRpYWcgPSBkMy5zdmcuZGlhZ29uYWwoKVxuICAgIFxuICAgIHdpcmVEcmFnID0gZDMuYmVoYXZpb3IuZHJhZygpXG4gICAgICAub3JpZ2luIE9iamVjdFxuICAgICAgLm9uICdkcmFnc3RhcnQnLCAoZCkgLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ3dpcmVEcmFnJywgZFxuICAgICAgICBAcGFyZW50Tm9kZS5hcHBlbmRDaGlsZCBAICMgbW92ZSB0byBmcm9udFxuICAgICAgICBkMy5ldmVudC5zb3VyY2VFdmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgLm9uICdkcmFnJywgKGQpIC0+XG4gICAgICAgIGQueCA9IGQzLmV2ZW50LnhcbiAgICAgICAgZC55ID0gZDMuZXZlbnQueVxuICAgICAgICBkMy5zZWxlY3QoQCkuYXR0clxuICAgICAgICAgIHRyYW5zZm9ybTogKGQpIC0+IFwidHJhbnNsYXRlKCN7ZC54fSwje2QueX0pXCJcbiAgICAgICAgc3ZnLnNlbGVjdEFsbCgnLndpcmUnKS5hdHRyIGQ6IGRpYWdcbiAgICAgIC5vbiAnZHJhZ2VuZCcsIChkKSAtPlxuICAgICAgICBjb25zb2xlLmxvZyAnc2F2ZSB3aXJlJywgZCAjIFRPRE86IHNhdmUgdG8gc2VydmVyXG5cbiAgICBnYWRnZXRzID0gc3ZnLnNlbGVjdEFsbCgnLmdhZGdldCcpLmRhdGEoc2NvcGUuZGF0YS5nYWRnZXRzKVxuICBcbiAgICBnID0gZ2FkZ2V0cy5lbnRlcigpLmFwcGVuZCgnZycpLmNhbGwoZ2FkZ2V0RHJhZylcbiAgICAgIC5hdHRyIGNsYXNzOiAnZ2FkZ2V0J1xuICAgICAgLmVhY2ggKGQpIC0+XG4gICAgICAgIGQuZ3QgPSBnYWRnZXRUeXBlc1tkLnR5cGVdXG4gICAgICAgIGQuaHcgPSBkLmd0LndpZHRoIC8gMlxuICAgICAgICBkLmhoID0gZC5ndC5oZWlnaHQgLyAyXG4gICAgZy5hcHBlbmQoJ3JlY3QnKVxuICAgICAgLmVhY2ggKGQpIC0+XG4gICAgICAgIGQzLnNlbGVjdChAKS5hdHRyXG4gICAgICAgICAgIyAxcHggbGluZXMgcmVuZGVyIHNoYXJwbHkgd2hlbiBvbiBhIDAuNXB4IG9mZnNldFxuICAgICAgICAgIHg6IDAuNSAtIGQuaHdcbiAgICAgICAgICB5OiAwLjUgLSBkLmhoXG4gICAgICAgICAgd2lkdGg6IDIgKiBkLmh3XG4gICAgICAgICAgaGVpZ2h0OiAyICogZC5oaFxuICAgICAgLnN0eWxlXG4gICAgICAgIGZpbGw6IChkKSAtPiBkLmd0LnNoYWRlXG4gICAgZy5hcHBlbmQoJ3RleHQnKVxuICAgICAgLnRleHQgKGQpIC0+IGQudGl0bGVcbiAgICAgIC5hdHRyIGNsYXNzOiAndGl0bGUnLCB5OiAoZCkgLT4gMTIgLSBkLmhoXG4gICAgZy5hcHBlbmQoJ3RleHQnKVxuICAgICAgLnRleHQgKGQpIC0+IGQudHlwZVxuICAgICAgLmF0dHIgY2xhc3M6ICd0eXBlJywgeTogKGQpIC0+IC00ICsgZC5oaFxuICAgICAgICBcbiAgICBwaW5zID0gZ2FkZ2V0cy5zZWxlY3RBbGwoJ3JlY3QgLnBpbicpLmRhdGEgKGQpIC0+IGQuZ3QucGluc1xuICAgIHBpbnMuZW50ZXIoKS5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAuYXR0ciBjbGFzczogJ3BpbicsIGN4OiAoKGQpIC0+IGQueCksIGN5OiAoKGQpIC0+IGQueSksIHI6IDNcbiAgICAgIC5vbiAnbW91c2Vkb3duJywgKGQpIC0+XG4gICAgICAgIGNvbnNvbGUubG9nICdjMScsIGRcblxuICAgIGZpbmRQaW4gPSAobmFtZSkgLT5cbiAgICAgIFtnaWQscG5hbWVdID0gbmFtZS5zcGxpdCAnLidcbiAgICAgIGZvciBnIGluIHNjb3BlLmRhdGEuZ2FkZ2V0c1xuICAgICAgICBpZiBnaWQgaXMgZy5pZFxuICAgICAgICAgIGZvciBwIGluIGcuZ3QucGluc1xuICAgICAgICAgICAgaWYgcG5hbWUgaXMgcC5uYW1lXG4gICAgICAgICAgICAgICMgY29uc29sZS5sb2cgJ2dwJywgbmFtZSwgZywgcFxuICAgICAgICAgICAgICByZXR1cm4geDogZy54ICsgcC54LCB5OiBnLnkgKyBwLnksIGc6IGcsIHA6IHBcblxuICAgIGRpYWcuc291cmNlIChkKSAtPiBmaW5kUGluIGQuZnJvbVxuICAgIGRpYWcudGFyZ2V0IChkKSAtPiBmaW5kUGluIGQudG9cbiAgICAgIFxuICAgIHdpcmVzID0gc3ZnLnNlbGVjdEFsbCgnLndpcmUnKS5kYXRhKHNjb3BlLmRhdGEud2lyZXMpXG4gICAgd2lyZXMuZW50ZXIoKS5hcHBlbmQoJ3BhdGgnKVxuICAgICAgLmF0dHIgY2xhc3M6ICd3aXJlJywgZDogZGlhZ1xuICAgIHdpcmVzLmV4aXQoKS5yZW1vdmUoKVxuXG4gICAgZ2FkZ2V0cy5hdHRyXG4gICAgICB0cmFuc2Zvcm06IChkKSAtPiBcInRyYW5zbGF0ZSgje2QueH0sI3tkLnl9KVwiXG4iXX0=
